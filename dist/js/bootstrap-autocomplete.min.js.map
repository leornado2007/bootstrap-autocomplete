{"version":3,"sources":["js/bootstrap-autocomplete.js"],"names":["$","DEF_OPTS","cls","placeHolder","emptyListTip","searchMode","ignoreCase","fitWdith","dropUp","filtSame","badgeCls","dblclick4Edit","inputSearchDelay","forceSelect","minChar","multiple","mode","selectAllBtnTxt","revselectBtnTxt","hideBadge","disableSelectedItemsInfoDragAnmiate","debounceFn","delay","fn","atBegin","debounce","mockDebounceTimeout","lastTimeoutId","now","Date","getTime","clearTimeout","setTimeout","isIE","navigator","userAgent","indexOf","KEY_CODES","TPLS","inputDelegateContainerTpl","containerTpl","inputTpl","dropdownTpl","dropdownTopBarTpl","placeholderTpl","clearBtnTpl","emptyDropDownItemTpl","dropdownItemTpl","badgeTpl","CLS","MODE","selectOption","getCssNum","el","css","Number","replace","ohtml","e","append","html","setCaretPosition","oField","document","selection","createRange","moveStart","value","length","selectionStart","stopEvent","preventDefault","stopPropagation","isString","val","PlaceHolder","ac","placeholderEl","this","params","tpls","prependTo","text","refresh","selectedItems","hide","show","Badge","badge","on","badgeEl","currentTarget","closest","closeBadge","closePanel","isSelectOptionMode","isReadonly","item","data","after","input","remove","removeSelected","isInSearchMode","n","name","c","code","getText4BadgeEdit","call","editingItem","close","updateTextValue","resize","closeEl","find","badgeMarginL","badgeMarginR","maxWidth","padL","padR","innerWidth","emptyWidth","outerWidth","children","each","findSelectedBadgeEl","foundBadgeEl","itemName","itemCode","badgeItem","badgeItemName","badgeItemCode","opts","needFireOnDeSelect","needFireOnChange","innerOnRemoveSelected","isOpen","itemEl","panel","findItemEl","removeClass","blur","placeholder","fireBadgeRemoved","needFireBadgeRemoved","innerFireBadgeRemoved","getLastBadge","badges","size","getClosestBadge","mouseX","mouseY","closestBadgeEl","isLineMatched","pos","position","left","top","bottom","outerHeight","addBadge","specialData","ei","eiCode","eiName","valCode","valName","searchInData","optGroup","customNameHtml","hn","htmlName","badgeRender","itemUseHtml","attr","addClass","doAdd","isSingleMode","findSelectedItem","before","addSelected","fire","needFireOnSelect","innerOnAddSelected","SelectedItemsInfo","startX","startScrollLeft","maxScrollLeft","startDragTime","selectedItemsInfoEl","selectedItemsTextEl","startDrag","isDragging","lastDragStopTime","dragAnimateInterval","stopDragAnimate","clearInterval","mouseupFn","timeDelta","animateScrollLeft","scrollLeft","stopX","pageX","xDelta","Math","abs","direction","speed","animateStartTime","pw","cw","setInterval","t","s","log","undefined","mousemoveFn","newScrollLeft","mousemove","mouseup","mousedown","mousewheel","delta","originalEvent","wheelDelta","detail","floor","destroy","off","isStopDragLately","refreshItems","itemNames","i","push","join","maxW","width","Input","loadTimeout","compositionFlag","inputCt","appendTo","inputSizer","inputEl","loadDataOnInput","destoried","empty","loadData","from","then","isFocused","open","render","focus","updateSizer","isHideBadge","openOnFocus","getValue","fireOnFocus","preventBlur","relatedTarget","beforeMoveVal","confirmValue","fromBlur","fireOnBlur","keydown","specialKey","keyCode","getSelectedItemEl","isSelected","hasVal","caretPos","oSel","getCaretPosition","textLen","moveToLR","moveSelect","prevBadge","prev","nextBadge","next","relocate","keyup","compositionstart","compositionend","isLeft","moveToBadge","lastBadge","isEsc","added","clear","fireBlur","getSearchText","DropdownPanelMenubar","menuBarEl","needBatchFireSelectItems","needBatchFireDeSelectItems","oldSelectedItems","slice","$itemEl","fireOnSelect","fireOnDeSelect","fireOnChange","DropdownPanel","menuBar","panelEl","emptyItemEl","scrollTop","innerHeight","scrollHeight","foundItemEl","checkedItemEls","boundItem","boundItemName","boundItemCode","isUp","moveToItem","selItem","itemCls","skipMultiSel","hideOtherSelected4Multiple","hasClass","items","scrollToSelected","selectedItem","height","searchText","hasOptGroup","lastGroupEl","matched","isMultiMode","lastGroupChildCount","selectableItemCount","toLowerCase","selectable","itemRender","selectedItemMap","fireOnPanelResize","inputPosLeft","removeData","AutoComplete","originEl","def","extend","initialized","readonly","htmlOverHandler","resized4htmlOver","is","htmlClickHandler","target","autocomplete","parents","htmlResizeHandler","elOverHandler","resized4elOver","addValue","onSetFinish","noop","changeFired","clearValue","fireInit","fireOnInit","Array","formatedItems","loadDataItems","tmpData","always","lastSearchData","needCheckRemote","toCheckCount","checkedItemCount","showAllItemsWhenFirstFocus","setValue","showAllWhenSingleForceSelectFocus","click","mouseover","window","selectedItemsInfo","oldItems","newItems","allItemsSame","oldItem","oldItemCode","oldItemName","newItem","newItemCode","newItemName","disableResizeContainer","resizeContainer","containerEl","trigger","fireOnClose","inputGroupEl","isInitialized","fireOnPen","closeTime","clearData","splice","setReadonly","findIndex","isItemMatched","regex","RegExp","str","escapeRegex","test","result","selCode","selName","isFromStr","findItem","dataItem","dataCode","dataName","defered","Deferred","loadedItems","resolve","reject","promise","loadDataSeq","loadSeq","_loadSeq","nLoadSeq","isNaN","lastGroupItem","inputDelegateCtEl","isUnderInputGroup","isOriginInputEl","parent","insertAfter","bsAcCtEl","resizeHeightCls","offsetX","offsetY","bsAutoComplete","args","arguments","$this","split","splitChar","apply","prototype","jQuery"],"mappings":"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","file":"bootstrap-autocomplete.min.js","sourcesContent":["(function ($) {\n  'use strict';\n\n  // DEF_OPTS\n  var DEF_OPTS = {\n    cls                                : '',\n    placeHolder                        : '请选择',\n    emptyListTip                       : '未找到匹配的数据项',\n    searchMode                         : 'code name',\n    ignoreCase                         : true,\n    fitWdith                           : true,\n    dropUp                             : false,\n    filtSame                           : false,\n    badgeCls                           : '',\n    dblclick4Edit                      : false,\n    inputSearchDelay                   : 200,\n    forceSelect                        : false,\n    minChar                            : 1,\n    multiple                           : true,\n    mode                               : '',\n    selectAllBtnTxt                    : '全选',\n    revselectBtnTxt                    : '反选',\n    hideBadge                          : false,\n    disableSelectedItemsInfoDragAnmiate: false,\n    debounceFn                         : function (delay, fn, atBegin) {\n      if ($.debounce) return $.debounce(delay, atBegin, fn);\n      else {\n        var mockDebounceTimeout = -1, lastTimeoutId = -1;\n        return function () {\n          var now = +new Date().getTime();\n          if (mockDebounceTimeout < 0 || (now - mockDebounceTimeout) > delay) {\n            mockDebounceTimeout = now;\n\n            if (lastTimeoutId > 0) {\n              clearTimeout(lastTimeoutId);\n              lastTimeoutId = -1;\n            }\n\n            lastTimeoutId = setTimeout(function () {\n              lastTimeoutId = -1;\n              mockDebounceTimeout = -1;\n              fn();\n            }, delay);\n          }\n        }\n      }\n    }\n  };\n\n  var isIE = navigator.userAgent.indexOf('Trident') > -1;\n\n  // KEY_CODES\n  var KEY_CODES = {\n    ENTER: 13, TAB: 9, LEFT: 37, UP: 38, RIGHT: 39, DOWN: 40, ESC: 27, BACK: 8, DELETE: 46\n  };\n\n  // TPLS\n  var TPLS = {\n    inputDelegateContainerTpl: '<div class=\"input-delegate-ct\"></div>',\n    containerTpl             : '<div class=\"btn-group bootstrap-autocomplete form-control\">\\\n        <div class=\"selected-items-info\"><div class=\"selected-items-text\"></div></div>\\\n      </div>',\n    inputTpl                 : '<div class=\"delegate-input\">\\\n        <input type=\"text\" class=\"input-delegate\">\\\n        <span class=\"input-delegate-sizer\">W</span>\\\n      </div>',\n    dropdownTpl              : '<ul class=\"dropdown-menu bs-autocomplete-menu\"></ul>',\n    dropdownTopBarTpl        : '<div class=\"bs-autocomplete-menu-bar\"><a class=\"btn btn-default selrev-btn\">反选</a><a class=\"btn btn-default selall-btn\">全选</a></div>',\n    placeholderTpl           : '<div class=\"bs-autocomplete-placeholder\"></div>',\n    clearBtnTpl              : '<span class=\"bsautocomplete-icon-cross bsautocomplete-font icon-jiaochacross78\"></span>',\n    emptyDropDownItemTpl     : '<li class=\"bs-autocomplete-empty-item\"></li>',\n    dropdownItemTpl          : '<li>\\\n        <a href=\"javascript:\">\\\n          <span class=\"text\"></span>\\\n          <span class=\"item-status-icon glyphicon glyphicon-ok\"></span>\\\n        </a>\\\n      </li>',\n    badgeTpl                 : '<span class=\"label label-primary\">\\\n        <a href=\"javascript:\" class=\"badge-text\"></a>\\\n        <a href=\"javascript:\" class=\"badge-close\">x</a>\\\n      </span>'\n  };\n\n  // CLS\n  var CLS = {\n    badgeCt           : 'bs-autocomplete-badge',\n    badgeHide         : 'bs-autocomplete-badge-hide',\n    dropdownItem      : 'bs-autocomplete-item', // 分组optGroup === true项不会添加这个样式\n    multiSelected     : 'multiple-selected',\n    multiHideSel      : 'multiple-hide-selected',\n    itemSelected      : 'selected', // 进作为光标移动当前菜单项高亮用，不作为已选中项样式\n    itemChecked       : 'item-checked', // 已选中菜单项样式\n    clearBtnClass     : 'bs-autocomplete-clear-btn',\n    inputClearBtnClass: 'bs-autocomplete-input-clear-btn',\n    hasInputVal       : 'has-input-val',\n    emptyList         : 'empty-list',\n    modePrefix        : 'bs-autocomplete-mode-',\n    selectedItemsGrab : 'items-text-grabbing'\n  };\n\n  var MODE = {\n    selectOption: 'selectOption',\n  };\n\n  // escapeRegex\n  var escapeRegex = function (str) {\n    if (typeof str !== 'string') return str;\n    var matchOperatorsRe = /[|\\\\{}()[\\]^$+*?.]/g;\n    return str.replace(matchOperatorsRe, '\\\\$&');\n  };\n\n  // getInnerSize\n  var getInnerWidth = function (el) {\n    var padL = getCssNum(el, 'padding-left'), padR = getCssNum(el, 'padding-right');\n    return el.innerWidth() - padL - padR;\n  };\n\n  // getOuterWidth\n  var getOuterWidth = function (el) {\n    return el.outerWidth() + getCssNum(el, 'margin-left') + getCssNum(el, 'margin-right');\n  };\n\n  // getCaretPosition\n  var getCaretPosition = function (oField) {\n    var caretPos = 0;\n    if (document.selection) {// IE\n      var oSel = document.selection.createRange();\n      oSel.moveStart(\"character\", 0 - oField.value.length);\n      caretPos = oSel.text.length;\n    } else if (oField.selectionStart || oField.selectionStart == \"0\") { // Firefox\n      caretPos = oField.selectionStart;\n    }\n    return caretPos;\n  };\n\n  // getCssNum\n  var getCssNum = function (el, css) {\n    return Number(el.css(css).replace('px', ''));\n  };\n\n  // getOuterHtml\n  var ohtml = function (e) {\n    return $('<div></div>').append(e).html();\n  };\n\n  // setCaretPosition\n  var setCaretPosition = function (oField) {\n    if (document.selection) {// IE\n      var oSel = document.selection.createRange();\n      oSel.moveStart(\"character\", oField.value.length);\n    } else { // Firefox\n      oField.selectionStart = oField.value.length;\n    }\n  };\n\n  // stopEvent\n  var stopEvent = function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  // isString\n  var isString = function (val) {\n    return typeof val === typeof '';\n  };\n\n  // PlaceHolder\n  var PlaceHolder = function (ac) {\n    var placeholder = this, placeholderEl = placeholder.el = $(ac.params.tpls.placeholderTpl).prependTo(ac.el);\n    placeholderEl.text(ac.params.placeHolder);\n\n    placeholder.refresh = function () {\n      if (ac.selectedItems.length > 0) placeholderEl.hide();\n      else placeholderEl.show();\n    };\n  };\n\n  // Badge\n  var Badge = function (ac) {\n    var badge = this;\n\n    // 从父元素一次性注册事件，提高性能\n    $(ac.el)\n      .on('click', '.' + CLS.badgeCt, function (e) {\n        stopEvent(e);\n      })\n\n      // close handler\n      .on('click', '.badge-close', function (e) {\n        var badgeEl = $(e.currentTarget).closest('.' + CLS.badgeCt);\n        badge.closeBadge(badgeEl, {closePanel: !ac.isSelectOptionMode()});\n        stopEvent(e);\n      })\n\n      // text handler\n      .on(ac.params.dblclick4Edit ? 'dblclick' : 'click', '.badge-text', function (e) {\n          if (ac.isReadonly()) return;\n\n          var badgeEl = $(e.currentTarget).closest('.' + CLS.badgeCt);\n          var item = badgeEl.data('bsAutoCompleteItem');\n          if (!item) return;\n\n          badgeEl.after(ac.input.el).remove();\n          ac.removeSelected(item);\n\n          var text = ac.isInSearchMode('name') ? item.n || item.name : item.c || item.code;\n          if (ac.params.getText4BadgeEdit) text = ac.params.getText4BadgeEdit.call(ac, item, text);\n          ac.editingItem = {item: item, text: text};\n          ac.close();\n          ac.input.updateTextValue(text);\n          stopEvent(e);\n        }\n      );\n\n    // resize\n    badge.resize = function (el) {\n      if (el) {\n        var closeEl = el.find('.badge-close');\n        var badgeMarginL = getCssNum(el, 'margin-left'), badgeMarginR = getCssNum(el, 'margin-right');\n        var maxWidth = getInnerWidth(ac.el) - ac.input.emptyWidth - badgeMarginL - badgeMarginR - closeEl.outerWidth() - 2;\n        el.find('.badge-text').css('max-width', maxWidth + 'px');\n      } else {\n        ac.el.children('.' + CLS.badgeCt).each(function () {\n          badge.resize($(this));\n        });\n      }\n    };\n\n    // findSelectedBadgeEl\n    badge.findSelectedBadgeEl = function (item) {\n      if (!item) return;\n\n      var foundBadgeEl, codeMatched, nameMatched;\n      var itemName = item.n || item.name, itemCode = item.c || item.code;\n\n      // var editingItem = ac.editingItem && ac.editingItem.item;\n      // if (editingItem === item)\n      // if (!!editingItem) {\n      //   var badgeItemName = editingItem.n || editingItem.name,\n      //     badgeItemCode = editingItem.c || editingItem.code;\n      //\n      // }\n\n      ac.el.children('.' + CLS.badgeCt).each(function () {\n        var badgeEl = $(this);\n        var badgeItem = badgeEl.data('bsAutoCompleteItem');\n        if (!badgeItem) return;\n\n        var badgeItemName = badgeItem.n || badgeItem.name, badgeItemCode = badgeItem.c || badgeItem.code;\n        var isCodeMatch = badgeItemCode === itemCode, isNameMatch = badgeItemName === itemName;\n        if (badgeItem === item) {\n          foundBadgeEl = badgeEl;\n          return false;\n        } else if (isCodeMatch && isNameMatch) {\n          codeMatched = nameMatched = true;\n          foundBadgeEl = badgeEl;\n        }\n      });\n\n      return foundBadgeEl;\n    };\n\n    // closeBadge\n    badge.closeBadge = function (badgeEl, opts) {\n      opts = opts || {};\n\n      if (ac.isReadonly()) return;\n      var item = badgeEl.data('bsAutoCompleteItem');\n      badgeEl.remove();\n\n      ac.removeSelected(item, {\n        needFireOnDeSelect   : opts.needFireOnDeSelect,\n        needFireOnChange     : opts.needFireOnChange,\n        innerOnRemoveSelected: opts.innerOnRemoveSelected,\n      });\n\n      if (ac.isOpen()) {\n        var itemEl = opts.itemEl || ac.panel.findItemEl(item);\n        if (itemEl) itemEl.removeClass(CLS.itemChecked);\n\n        if (opts.closePanel !== false) {\n          if (ac.selectedItems.length <= 0) ac.input.blur();\n          ac.close();\n        }\n      }\n\n      ac.placeholder.refresh();\n      ac.fireBadgeRemoved({\n        needFireBadgeRemoved : opts.needFireBadgeRemoved,\n        innerFireBadgeRemoved: opts.innerFireBadgeRemoved,\n        item                 : item,\n        badgeEl              : badgeEl\n      });\n    };\n\n    // getLastBadge\n    badge.getLastBadge = function () {\n      var badges = ac.el.children('.' + CLS.badgeCt);\n      if (badges.size() > 0) return $(badges[badges.size() - 1]);\n    };\n\n    // getClosestBadge\n    badge.getClosestBadge = function (mouseX, mouseY) {\n      var closestBadgeEl, isLineMatched;\n      ac.el.children('.' + CLS.badgeCt).each(function () {\n        var badgeEl = $(this), pos = badgeEl.position();\n        var left = pos.left, top = pos.top, bottom = top + badgeEl.outerHeight(),\n          right = pos.left + badgeEl.outerWidth();\n        if (mouseY >= top && mouseY <= bottom) {\n          isLineMatched = true;\n          if (mouseX <= left) {\n            closestBadgeEl = badgeEl;\n            return false;\n          }\n        } else if (isLineMatched) {// matched last line last badge\n          closestBadgeEl = badgeEl;\n          return false;\n        }\n      });\n      return closestBadgeEl;\n    };\n\n    // addBadge\n    badge.addBadge = function (val, opts) {\n      opts = opts || {};\n      var specialData = opts.specialData;\n      var item;\n\n      /*if (!isString(val) && item && item !== val) {\n        var valCode = val.c || val.code, valName = val.n || val.name;\n        var itemCode = item.c || item.code, itemName = item.n || item.name;\n        if (valCode !== itemCode || valName !== itemName) item = val;\n      }*/\n\n      if (!val) {\n        delete ac.editingItem;\n        return;\n      }\n\n      if (ac.editingItem) {\n        if (val === ac.editingItem.item) item = val;\n        else if (isString(val)) {\n          if (ac.editingItem.text === val) item = ac.editingItem.item;\n        } else {\n          var ei = ac.editingItem.item, eiCode = ei.c || ei.code, eiName = ei.n || ei.name;\n          var valCode = val.c || val.code, valName = val.n || val.name;\n          if (valCode === eiCode && valName === eiName) item = val;\n        }\n      }\n\n      if (!item) {\n        if (isString(val)) {\n          item = ac.searchInData(val, specialData);\n          if (!item && !ac.params.forceSelect) item = {c: val, n: val};\n        } else if (ac.params.forceSelect) {\n          item = ac.searchInData(val, specialData);\n        } else {\n          item = val;\n        }\n      }\n\n      if (!item) {\n        delete ac.editingItem;\n        return;\n      }\n\n      delete ac.editingItem;\n\n      if (item.optGroup === true) return false;\n\n      var badgeEl, itemName = item.n || item.name, customNameHtml = item.hn || item.htmlName;\n      if (ac.params.badgeRender) badgeEl = ac.params.badgeRender.call(ac, item);\n      else {\n        badgeEl = $(ac.params.tpls.badgeTpl);\n        var text = badgeEl.find('.badge-text');\n        if (ac.params.itemUseHtml) text.append(ohtml($(customNameHtml || itemName)));\n        else text.text(itemName);\n        text.attr('title', itemName);\n      }\n\n      badgeEl\n        .data('bsAutoCompleteItem', item)\n        .addClass(CLS.badgeCt + ' ' + ac.params.badgeCls);\n\n      var doAdd = false;\n      if (ac.params.filtSame && ac.selectedItems.length > 0 && !ac.isSingleMode()) {\n        var hasSame = ac.findSelectedItem(item) >= 0;\n        if (hasSame) return true;\n        else doAdd = true;\n      } else doAdd = true;\n\n      if (doAdd) {\n        if (ac.isSingleMode()) ac.el.children('.' + CLS.badgeCt).remove();\n        ac.input.el.before(badgeEl);\n        ac.addSelected(item, {\n          fire              : !specialData,\n          needFireOnSelect  : opts.needFireOnSelect,\n          needFireOnChange  : opts.needFireOnChange,\n          innerOnAddSelected: opts.innerOnAddSelected,\n          itemEl            : opts.itemEl,\n        });\n        badge.resize(badgeEl);\n        if (ac.isSingleMode()) ac.input.updateTextValue(itemName, false);\n        ac.placeholder.refresh();\n      }\n      return doAdd;\n    };\n\n    if (ac.isSingleMode()) ac.el.addClass('single-badge');\n  };\n\n  // SelectedItemsInfo\n  var SelectedItemsInfo = function (ac) {\n    var selectedItemsInfo = this;\n\n    var selectedItemsInfoEl = ac.el.children('.selected-items-info');\n    var selectedItemsTextEl = selectedItemsInfoEl.children('.selected-items-text');\n\n    // TODO\n    var startDrag = false, isDragging = false;\n    var startX, startScrollLeft, maxScrollLeft, startDragTime;\n    var lastDragStopTime = -1;\n    var dragAnimateInterval = -1;\n\n    var stopDragAnimate = function () {\n      if (dragAnimateInterval >= 0) clearInterval(dragAnimateInterval);\n      dragAnimateInterval = -1;\n    };\n\n    var mouseupFn = function (e) {\n      startDrag = false;\n      if (!isDragging) return;\n\n      lastDragStopTime = new Date().getTime();\n      var timeDelta = new Date().getTime() - startDragTime;\n      if (timeDelta < 200 && timeDelta > 0 && ac.params.disableSelectedItemsInfoDragAnmiate !== true) {\n        var animateScrollLeft = selectedItemsInfoEl.scrollLeft();\n        var stopX = e.pageX, xDelta = Math.abs(stopX - startX);\n        var direction = stopX < startX ? 1 : -1;\n        var speed = 10 * xDelta / (timeDelta / 1000); // 加速度\n        var animateStartTime = lastDragStopTime;\n        var pw = selectedItemsInfoEl.innerWidth(), cw = selectedItemsTextEl.outerWidth();\n\n        dragAnimateInterval = setInterval(function () {\n          if (speed < 1)\n            return stopDragAnimate();\n\n          var now = new Date().getTime();\n          var t = (now - animateStartTime) / 1000;\n          var s = 1 / 2 * speed * t * t; // s = (1/2)at²\n          speed *= -Math.log(t + 1) + 1; // 递减加速度 y=-log(x+1)+1\n          animateScrollLeft += s * direction;\n\n          selectedItemsInfoEl.scrollLeft(animateScrollLeft);\n\n          if (animateScrollLeft <= 0 || cw > pw && animateScrollLeft >= cw - pw)\n            return stopDragAnimate();\n        }, 100);\n      }\n\n      isDragging = false;\n      startX = startScrollLeft = startDragTime = undefined;\n      selectedItemsInfoEl.removeClass(CLS.selectedItemsGrab);\n      stopEvent(e);\n    };\n\n    var mousemoveFn = function (e) {\n      if (!startDrag) return;\n\n      var xDelta = e.pageX - startX;\n      if (Math.abs(xDelta) > 30) {\n        isDragging = true;\n        selectedItemsInfoEl.addClass(CLS.selectedItemsGrab);\n      }\n      if (!isDragging) return;\n\n      var newScrollLeft = startScrollLeft - xDelta;\n      if (newScrollLeft <= 0) newScrollLeft = 0;\n      else if (newScrollLeft >= maxScrollLeft) newScrollLeft = maxScrollLeft;\n      selectedItemsInfoEl.scrollLeft(newScrollLeft);\n      stopEvent(e);\n    };\n\n    $(document).on({\n      mousemove: mousemoveFn,\n      mouseup  : mouseupFn\n    });\n\n    selectedItemsTextEl.on({\n      mousedown : function (e) {\n        var pw = selectedItemsInfoEl.innerWidth(), cw = selectedItemsTextEl.outerWidth();\n        stopDragAnimate();\n\n        if (!startDrag && cw > pw) {\n          startDrag = true;\n          maxScrollLeft = cw - pw;\n          startX = e.pageX;\n          startScrollLeft = selectedItemsInfoEl.scrollLeft();\n          startDragTime = new Date().getTime();\n        }\n      },\n      mousewheel: function (e) {\n        stopEvent(e);\n\n        var pw = selectedItemsInfoEl.innerWidth(), cw = selectedItemsTextEl.outerWidth();\n        var scrollLeft = selectedItemsInfoEl.scrollLeft();\n        var delta = (e.originalEvent.wheelDelta && e.originalEvent.wheelDelta ||\n          e.originalEvent.detail && e.originalEvent.detail) > 0 ? -1 : 1;\n        var newScrollLeft = scrollLeft + Math.floor(delta * pw * 0.8);\n\n        if (newScrollLeft <= 0) newScrollLeft = 0;\n        else if (cw > pw && newScrollLeft >= cw - pw) newScrollLeft = cw - pw;\n\n        selectedItemsInfoEl.scrollLeft(newScrollLeft);\n      },\n    });\n\n    selectedItemsInfo.destroy = function () {\n      $(document).off({\n        mousemove: mousemoveFn,\n        mouseup  : mouseupFn\n      });\n    }\n\n    selectedItemsInfo.isStopDragLately = function () {\n      return new Date().getTime() - lastDragStopTime <= 100;\n    };\n\n    selectedItemsInfo.refreshItems = function () {\n      var selectedItems = ac.selectedItems || [];\n      var itemNames = [];\n      $.each(selectedItems, function (i, item) {\n        itemNames.push(item.n || item.name);\n      });\n\n      var text = itemNames.join(',');\n      var maxW = ac.el.width() - 5;\n      if (maxW > 0) selectedItemsInfoEl.css('max-width', maxW);\n      selectedItemsTextEl.text(text).attr('title', text);\n      ac.placeholder.refresh();\n    };\n\n  }\n\n  // Input\n  var Input = function (ac) {\n    var input = this, inputCt = input.el = $(ac.params.tpls.inputTpl).appendTo(ac.el);\n    var inputSizer = inputCt.children('.input-delegate-sizer');\n\n    var loadTimeout, compositionFlag;\n    var inputEl = inputCt.children(':text');\n\n    var loadDataOnInput = ac.params.debounceFn(ac.params.inputSearchDelay, function () {\n      if (ac.destoried) return;\n\n      if (inputEl.val().length < ac.params.minChar) {\n        ac.close();\n        ac.panel.el.empty();\n        return;\n      }\n\n      ac.loadData({from: 'keydown'}).then(function () {\n        if (!ac.input.isFocused) return;\n        ac.open();\n        ac.panel.render();\n      });\n    }, true);\n\n    inputEl.on({\n      'focus'           : function (e) {\n        if (ac.isReadonly()) {\n          inputEl.blur();\n          stopEvent(e);\n          return;\n        }\n\n        input.isFocused = true;\n        input.updateSizer();\n        if (!ac.isHideBadge()) ac.placeholder.el.hide();\n        ac.el.addClass('focus');\n        if (ac.params.minChar <= 0 || inputEl.val().length >= ac.params.minChar) ac.openOnFocus();\n        if (ac.isSingleMode() && ac.getValue().length > 0) {\n          setCaretPosition(inputEl[0]);\n          ac.editingItem = {item: ac.getValue()[0], text: inputEl.val()};\n        }\n        ac.fireOnFocus();\n      },\n      'blur'            : function (e) {\n        if (!input.isFocused) return;\n        input.isFocused = false;\n        ac.el.removeClass('focus');\n\n        var preventBlur = false;\n        if (ac.isSelectOptionMode()) { // 下拉框模式，阻止点击关闭badge时失去焦点\n          var relatedTarget = e.relatedTarget;\n          if (relatedTarget) {\n            var blurByCloseBadgeEl = $(relatedTarget).closest('.badge-close');\n            if (blurByCloseBadgeEl.length > 0)\n              preventBlur = true;\n          }\n        }\n\n        if (!preventBlur && inputEl.val() && !input.beforeMoveVal || !inputEl.val() && ac.isSingleMode())\n          input.confirmValue(false, {fromBlur: true});\n        ac.placeholder.refresh();\n\n        if (!preventBlur) {\n          ac.close();\n          ac.fireOnBlur();\n        }\n      },\n      'keydown'         : function (e) {\n        if (ac.isReadonly()) return;\n\n        input.updateSizer();\n\n        var specialKey = false;\n        switch (e.keyCode) {\n          case KEY_CODES.ENTER:\n            // 防止用户输入自定义字符串后回车，此时自定义字符串的字典加载请求还在debounce或者异步请求中\n            // 回车操作后应该关闭组件面板，但因为上述异步行为可能导致面板再次展示出来\n            if (loadTimeout) {\n              clearTimeout(loadTimeout);\n              loadTimeout = undefined;\n            }\n\n            var itemEl = ac.panel.getSelectedItemEl();\n            var item = itemEl.data('bsAutoCompleteItem');\n\n            if (item) {\n              // var itemName = item.n || item.name, itemCode = item.c || item.code;\n              // if (ac.isInSearchMode('name') && itemName) inputEl.val(itemName);\n              // else if (itemCode) inputEl.val(itemCode);\n\n              var badgeEl = ac.isSelected(item) && ac.badge.findSelectedBadgeEl(item);\n              if (!!badgeEl) ac.badge.closeBadge(badgeEl, {closePanel: !ac.isSelectOptionMode(), itemEl: itemEl});\n              else ac.badge.addBadge(item, {itemEl: itemEl});\n            }\n\n            if (!ac.isSelectOptionMode()) input.blur();\n            else if (!item && inputEl.val() && !input.beforeMoveVal || !inputEl.val() && ac.isSingleMode()) {\n              input.confirmValue(false, {fromBlur: false});\n            }\n\n            stopEvent(e);\n            specialKey = true;\n            break;\n          case KEY_CODES.ESC:\n            input.confirmValue(true);\n            specialKey = true;\n            break;\n          case KEY_CODES.TAB:\n            var hasVal = !!inputEl.val();\n            input.confirmValue();\n            if (hasVal && !ac.isSingleMode()) {\n              inputEl.focus();\n              stopEvent(e);\n            }\n            specialKey = true;\n            break;\n          case KEY_CODES.LEFT:\n          case KEY_CODES.RIGHT:\n            var caretPos = getCaretPosition(inputEl[0]), textLen = inputEl.val().length;\n            if (e.keyCode === KEY_CODES.LEFT && caretPos === 0) {\n              input.moveToLR(true);\n              stopEvent(e);\n            } else if (e.keyCode === KEY_CODES.RIGHT && caretPos === textLen) {\n              input.moveToLR(false);\n              stopEvent(e);\n            }\n            specialKey = true;\n            break;\n          case KEY_CODES.UP:\n          case KEY_CODES.DOWN:\n            ac.panel.moveSelect(e.keyCode === KEY_CODES.UP);\n            stopEvent(e);\n            specialKey = true;\n            break;\n          case KEY_CODES.BACK:\n            if (!inputEl.val()) {\n              var prevBadge = inputCt.prev('.' + CLS.badgeCt);\n              if (prevBadge.size() > 0) {\n                ac.badge.closeBadge(prevBadge);\n                stopEvent(e);\n                specialKey = true;\n              }\n            }\n            break;\n          case KEY_CODES.DELETE:\n            if (!inputEl.val()) {\n              var nextBadge = inputCt.next('.' + CLS.badgeCt);\n              if (nextBadge.size() > 0) {\n                ac.badge.closeBadge(nextBadge);\n                stopEvent(e);\n                specialKey = true;\n              }\n            }\n            break;\n          default:\n            ac.panel.relocate();\n        }\n\n        if (!specialKey) {\n          if (loadTimeout) clearTimeout(loadTimeout);\n          loadTimeout = setTimeout(function () { // 由于是监听keydown事件，而最后实际输入的字符要keyup之后才能拿到，所以设置个延迟\n            loadTimeout = undefined;\n            if (!compositionFlag) loadDataOnInput();\n          }, 200);\n        }\n      },\n      'keyup'           : function (e) {\n        if (ac.isReadonly()) return;\n        input.updateSizer();\n        var text = inputEl.val();\n        if (!!text) inputCt.addClass(CLS.hasInputVal);\n        else inputCt.removeClass(CLS.hasInputVal);\n      },\n      'compositionstart': function () { // 输入法，录入开始\n        compositionFlag = true;\n      },\n      'compositionend'  : function () { // 输入法，输入结束\n        compositionFlag = false;\n        loadDataOnInput(); //在input之后执行 所以需要手动调用一次\n      },\n    });\n\n    // moveToLR\n    input.moveToLR = function (isLeft) {\n      if (ac.isSingleMode()) return;\n\n      var badge = isLeft ? inputCt.prev('.' + CLS.badgeCt + ' ') : inputCt.next('.' + CLS.badgeCt);\n      if (badge) {\n        input.beforeMoveVal = inputEl.val();\n        isLeft ? badge.before(inputCt) : badge.after(inputCt);\n        inputEl.val(input.beforeMoveVal);\n        input.focus();\n        delete input.beforeMoveVal;\n      }\n    };\n\n    // moveToBadge\n    input.moveToBadge = function (badge) {\n      if (ac.isSingleMode()) return;\n\n      if (badge) badge.before(input.el);\n      else {\n        var lastBadge = ac.badge.getLastBadge();\n        if (lastBadge) lastBadge.after(input.el);\n      }\n    };\n\n    // updateSizer\n    input.updateSizer = function () {\n      inputSizer.text(inputEl.val() + 'WW');\n    };\n\n    // updateTextValue\n    input.updateTextValue = function (text, focus) {\n      inputEl.val(text);\n      if (!input.isFocused && focus !== false) input.focus();\n      input.updateSizer();\n      if (isIE && focus !== false) setCaretPosition(inputEl[0]);\n    };\n\n    // confirmValue\n    input.confirmValue = function (isEsc, opts) {\n      opts = opts || {};\n      var added;\n\n      if (isEsc) {\n        if (ac.editingItem) added = ac.badge.addBadge(ac.editingItem.item);\n      } else added = ac.badge.addBadge(inputEl.val());\n\n      //if (isIE && ac.isSingleMode() && fromBlur) {\n      //  ac.close();\n      //  return;\n      //}\n\n      if (ac.isSingleMode()) {\n        if (!added) {\n          if (ac.selectedItems.length > 0) ac.removeSelected(ac.selectedItems[0]);\n          if (inputEl.val()) input.clear();\n        }\n        if (!opts.fromBlur) inputEl.blur();\n        ac.close();\n      } else if (inputEl.val()) {\n        input.clear();\n      }\n    };\n\n    // blur\n    input.blur = function () {\n      if (!input.isFocused) return;\n      inputEl.blur();\n    };\n\n    // clear\n    input.clear = function (fireBlur) {\n      inputEl.val('');\n      if (fireBlur === false) ac.placeholder.refresh();\n      else inputEl.blur();\n      inputSizer.text('W');\n      inputCt.removeClass(CLS.hasInputVal);\n    };\n\n    // getSearchText\n    input.getSearchText = function () {\n      return inputEl.val();\n    };\n\n    // focus\n    input.focus = function () {\n      if (input.isFocused) return;\n      inputEl.focus();\n    };\n\n    inputSizer.text('WW');\n    input.emptyWidth = getOuterWidth(inputCt);\n    inputSizer.text('W');\n\n    // hideBadge模式下，搜索框清理按钮\n    if (ac.isHideBadge()) {\n      $(ac.params.tpls.clearBtnTpl)\n        .addClass(CLS.inputClearBtnClass)\n        .appendTo(inputCt)\n        .on('mousedown', function (e) {\n          if (ac.isReadonly()) return;\n\n          ac.input.clear(false);\n          ac.loadData().then(function () {\n            ac.panel.render();\n          });\n          stopEvent(e);\n        });\n    }\n  };\n\n  // DropdownPanelMenubar\n  var DropdownPanelMenubar = function (ac, panel) {\n    var menuBar = this;\n    var menuBarEl = menuBar.el = $(ac.params.tpls.dropdownTopBarTpl);\n\n    $(panel.el)\n      .on('mousedown', '.selrev-btn', function (e) {\n        var needBatchFireSelectItems = [], needBatchFireDeSelectItems = [];\n        var oldSelectedItems = ac.selectedItems.slice();\n\n        panel.el.children('.' + CLS.dropdownItem).each(function (i, itemEl) {\n          var $itemEl = $(itemEl);\n          var item = $itemEl.data('bsAutoCompleteItem');\n          if (!item) return;\n\n          var badgeEl = ac.isSelected(item) && ac.badge.findSelectedBadgeEl(item);\n          if (!!badgeEl) {\n            ac.badge.closeBadge(badgeEl, {\n              closePanel           : !ac.isSelectOptionMode(),\n              itemEl               : $itemEl,\n              needFireOnDeSelect   : false,\n              needFireOnChange     : false,\n              needFireBadgeRemoved : false,\n              innerOnRemoveSelected: function (item) {\n                needBatchFireDeSelectItems.push(item);\n              },\n            });\n          } else {\n            ac.badge.addBadge(item, {\n              itemEl            : $itemEl,\n              needFireOnSelect  : false,\n              needFireOnChange  : false,\n              innerOnAddSelected: function (item) {\n                needBatchFireSelectItems.push(item);\n              }\n            });\n          }\n        });\n\n        if (needBatchFireSelectItems.length > 0)\n          ac.fireOnSelect(needBatchFireSelectItems, ac.getValue());\n        if (needBatchFireDeSelectItems.length > 0)\n          ac.fireOnDeSelect(needBatchFireDeSelectItems, ac.getValue());\n        if (needBatchFireSelectItems.length > 0 || needBatchFireDeSelectItems.length > 0)\n          ac.fireOnChange(oldSelectedItems, ac.getValue());\n\n        // 由下拉菜单自动联动删除的badge不触发badge删除事件\n\n        stopEvent(e);\n      })\n      .on('mousedown', '.selall-btn', function (e) {\n        var needBatchFireSelectItems = [];\n        var oldSelectedItems = ac.selectedItems.slice();\n\n        panel.el.children('.' + CLS.dropdownItem).each(function (i, itemEl) {\n          var $itemEl = $(itemEl);\n          var item = $itemEl.data('bsAutoCompleteItem');\n          if (!item) return;\n\n          var badgeEl = ac.isSelected(item) && ac.badge.findSelectedBadgeEl(item);\n          if (!badgeEl) {\n            ac.badge.addBadge(item, {\n              itemEl            : $itemEl,\n              needFireOnSelect  : false,\n              needFireOnChange  : false,\n              innerOnAddSelected: function (item) {\n                needBatchFireSelectItems.push(item);\n              }\n            });\n          }\n        });\n\n        if (needBatchFireSelectItems.length > 0) {\n          ac.fireOnSelect(needBatchFireSelectItems, ac.getValue());\n          ac.fireOnChange(oldSelectedItems, ac.getValue());\n        }\n\n        stopEvent(e);\n      });\n\n    menuBarEl.find('.selrev-btn').text(ac.params.revselectBtnTxt);\n    menuBarEl.find('.selall-btn').text(ac.params.selectAllBtnTxt);\n  };\n\n  // DropdownPanel\n  var DropdownPanel = function (ac) {\n    var panel = this, panelEl = panel.el = $(ac.params.tpls.dropdownTpl).appendTo(ac.el);\n    var emptyItemEl = $(ac.params.tpls.emptyDropDownItemTpl).text(ac.params.emptyListTip);\n\n    // 从父元素一次性注册事件，提高性能\n    $(panel.el).on('mousedown', '.' + CLS.dropdownItem, function (e) {\n      if (ac.isReadonly()) return;\n\n      var itemEl = $(e.currentTarget);\n      var item = itemEl.data('bsAutoCompleteItem');\n      if (!item) return;\n\n      if (item.optGroup) {\n        stopEvent(e);\n        return;\n      }\n\n      var doAdd = true;\n      if (!ac.isSelectOptionMode()) {\n        if (isIE) ac.input.blur();\n        ac.input.clear();\n      } else {\n        if (ac.editingItem && ac.editingItem.item === item) {\n          delete ac.editingItem;\n          ac.removeSelected(item);\n\n          if (ac.selectedItems.length <= 0) ac.input.blur();\n          ac.placeholder.refresh();\n          // 由下拉菜单自动联动删除的badge不触发badge删除事件\n          /*ac.fireBadgeRemoved({\n            item   : item,\n            badgeEl: badgeEl\n          });*/\n\n          doAdd = false;\n        }\n\n        var badgeEl = ac.badge.findSelectedBadgeEl(item);\n        if (!!badgeEl) {\n          ac.badge.closeBadge(badgeEl, {closePanel: false, itemEl: itemEl});\n          doAdd = false;\n        }\n      }\n\n      if (doAdd) ac.badge.addBadge(item, {itemEl: itemEl});\n\n      stopEvent(e);\n    });\n\n    // TODO\n    var menuBar;\n    if (ac.isSelectOptionMode()) {\n      menuBar = new DropdownPanelMenubar(ac, panel);\n    }\n\n    panelEl.on('mousewheel', function (e) {\n      if (e.currentTarget !== panelEl[0]) return;\n\n      var scrollTop = panelEl.scrollTop();\n      var innerHeight = panelEl.innerHeight();\n      var scrollHeight = panelEl[0].scrollHeight;\n      var delta = (e.originalEvent.wheelDelta && (e.originalEvent.wheelDelta > 0 ? 1 : -1)) ||\n        (e.originalEvent.detail && (e.originalEvent.detail > 0 ? -1 : 1));\n\n      if (scrollTop <= 0 && delta > 0 || // 到达顶部\n        scrollTop + innerHeight >= scrollHeight - 1 && delta < 0) { // 到达底部\n        stopEvent(e);\n      }\n    });\n\n    // findItemEl\n    panel.findItemEl = function (item) {\n      if (!item) return;\n\n      var foundItemEl;\n      var itemName = item.n || item.name, itemCode = item.c || item.code\n      var checkedItemEls = panelEl.children('li.' + CLS.dropdownItem + '.' + CLS.itemChecked);\n      $.each(checkedItemEls, function (i, itemEl) {\n        var $itemEl = $(itemEl);\n        var boundItem = $itemEl.data('bsAutoCompleteItem');\n        if (!boundItem) return;\n\n        if (boundItem === item) {\n          foundItemEl = $itemEl;\n          return false\n        }\n\n        var boundItemName = boundItem.n || boundItem.name, boundItemCode = boundItem.c || boundItem.code;\n        if (boundItemName === itemName && boundItemCode === itemCode) {\n          foundItemEl = $itemEl;\n        }\n      });\n      return foundItemEl;\n    };\n\n    // moveSelect\n    panel.moveSelect = function (isUp) {\n      var selItem = panelEl.children('li.' + CLS.dropdownItem + '.' + CLS.itemSelected), moveToItem,\n        itemCls = '.' + CLS.dropdownItem;\n      var skipMultiSel = !ac.isSingleMode() && ac.params.hideOtherSelected4Multiple;\n      if (skipMultiSel) itemCls += ':not(.' + CLS.multiHideSel + ')';\n      if (selItem.size() > 0) {\n        moveToItem = isUp ? selItem.prev() : selItem.next();\n\n        while (moveToItem.size() > 0) {\n          if (moveToItem.hasClass(CLS.dropdownItem) && (!skipMultiSel || !moveToItem.hasClass(CLS.multiHideSel)))\n            break;\n          moveToItem = isUp ? moveToItem.prev() : moveToItem.next();\n        }\n\n        if (moveToItem.size() <= 0) {\n          var items = panelEl.children(itemCls);\n          if (items.size() > 0) moveToItem = isUp ? $(items[items.size() - 1]) : $(items[0]);\n        }\n      } else {\n        var items = panelEl.children(itemCls);\n        if (items.size() > 0) moveToItem = isUp ? $(items[items.size() - 1]) : $(items[0]);\n      }\n\n      if (moveToItem && moveToItem.length > 0) {\n        selItem.removeClass(CLS.itemSelected);\n        moveToItem.addClass(CLS.itemSelected);\n        panel.scrollToSelected(moveToItem);\n      }\n    };\n\n    // scrollToSelected\n    panel.scrollToSelected = function (selectedItem) {\n      selectedItem = selectedItem || panelEl.children('li.' + CLS.dropdownItem + '.' + CLS.itemSelected);\n      if (selectedItem.size() > 0) {\n        var scrollTop = panelEl.scrollTop(), top = selectedItem.position().top + scrollTop;\n        top = top - (panelEl.height() - selectedItem.height()) / 2;\n        panelEl.scrollTop(top);\n      }\n    };\n\n    // getSelectedItemEl\n    panel.getSelectedItemEl = function () {\n      return panelEl.children('li.' + CLS.dropdownItem + '.' + CLS.itemSelected);\n    };\n\n    // render\n    panel.render = function () {\n      var data = ac.data || [], searchText = ac.input.getSearchText();\n      panelEl.empty();\n      panelEl.scrollTop();\n\n      var ei = ac.editingItem && ac.editingItem.item || {}, eiCode = ei.c || ei.code, eiName = ei.n || ei.name;\n      if (data.length > 0) {\n        var matched = false, hasOptGroup;\n        var isMultiMode = !ac.isSingleMode(), hideOtherSelected4Multiple = ac.params.hideOtherSelected4Multiple;\n        var lastGroupEl, lastGroupChildCount = 0, selectableItemCount = 0;\n\n        panelEl.removeClass(CLS.emptyList);\n        if (ac.isSelectOptionMode()) {\n          panelEl.append(menuBar.el);\n          ac.el.addClass(CLS.modePrefix + MODE.selectOption.toLowerCase());\n        } else {\n          ac.el.removeClass(CLS.modePrefix + MODE.selectOption.toLowerCase());\n        }\n\n        $.each(data, function (i, item) {\n          var itemEl, itemName = item.n || item.name, itemCode = item.c || item.code,\n            customNameHtml = item.hn || item.htmlName, selectable = true;\n          if (ac.params.itemRender) itemEl = ac.params.itemRender.call(ac, item, searchText);\n          else {\n            itemEl = $(ac.params.tpls.dropdownItemTpl);\n            var text = itemEl.find('.text');\n            if (ac.params.itemUseHtml) text.append(ohtml($(customNameHtml || itemName)));\n            else text.text(itemName);\n          }\n\n          var selectedItem = ac.selectedItemMap[itemCode];\n          var itemChecked = selectedItem && (\n            selectedItem === item ||\n            (selectedItem.c || selectedItem.code) === itemCode &&\n            (selectedItem.n || selectedItem.name) === itemName);\n\n          if (itemChecked) {\n            itemEl.addClass(CLS.itemChecked);\n            if (isMultiMode) {\n              itemEl.addClass(CLS.multiSelected);\n              if (hideOtherSelected4Multiple) {\n                selectable = false;\n                itemEl.addClass(CLS.multiHideSel);\n              }\n            }\n          } else {\n            itemEl.removeClass(CLS.itemChecked);\n          }\n\n          if (item.optGroup === true) {\n            selectable = false;\n            itemEl.addClass('bs-autocomplete-group');\n            if (!hasOptGroup) {\n              hasOptGroup = true;\n              panelEl.addClass('bs-autocomplete-grouped');\n            }\n\n            if (lastGroupEl && lastGroupChildCount <= 0)\n              lastGroupEl.addClass('bs-autocomplete-group-hide');\n\n            lastGroupEl = itemEl;\n            lastGroupChildCount = 0;\n          } else {\n            if (lastGroupEl && selectable) lastGroupChildCount++;\n            if (selectable) selectableItemCount++;\n            itemEl.addClass(CLS.dropdownItem);\n          }\n          if (item.cls) itemEl.addClass(item.cls);\n\n          itemEl\n            .appendTo(panelEl)\n            .data('bsAutoCompleteItem', item)\n            .attr('title', itemName);\n\n          if (!matched && searchText) {\n            if (ac.editingItem && ac.editingItem.text == searchText) {\n              if (eiCode == itemCode && eiName == itemName)\n                matched = true;\n            }\n            if (ac.isInSearchMode('name') && searchText == itemName) {\n              matched = true;\n            } else if (ac.isInSearchMode('code') && searchText == itemCode) {\n              matched = true;\n            }\n            if (matched) itemEl.addClass(CLS.itemSelected);\n          }\n        });\n\n        if (lastGroupEl && lastGroupChildCount <= 0)\n          lastGroupEl.addClass('bs-autocomplete-group-hide');\n\n        if (selectableItemCount <= 0) {\n          panelEl.addClass('no-selectable-items');\n        } else {\n          panelEl.removeClass('no-selectable-items');\n        }\n      } else {\n        panelEl.addClass(CLS.emptyList).append(emptyItemEl);\n        if (!ac.isSelectOptionMode()) ac.close();\n      }\n    };\n\n    // resize\n    panel.resize = function () {\n      var width = ac.el.outerWidth();\n      panelEl.css('max-width', width);\n      if (ac.isSelectOptionMode()) panelEl.width(width);\n      if (ac.isHideBadge()) {\n        ac.input.el.width(width).css('max-width', width);\n      }\n      ac.fireOnPanelResize(ac);\n    };\n\n    // relocate\n    panel.relocate = function () {\n      var inputPosLeft = ac.input.el.position().left;\n      if (ac.isSingleMode() || ac.isSelectOptionMode()) inputPosLeft = 0;\n      panelEl.css('left', inputPosLeft + 'px');\n    };\n\n    // close\n    panel.close = function () {\n      panelEl.children('.' + CLS.dropdownItem)\n        .removeClass(CLS.itemSelected)\n        .removeClass(CLS.itemChecked);\n    };\n\n    // destroy\n    panel.destroy = function () {\n      panelEl.children().each(function () {\n        $(this).removeData('bsAutoCompleteItem');\n      });\n      panelEl.remove();\n    };\n  };\n\n  // AutoComplete\n  var AutoComplete = function (params, originEl) {\n    var ac = this;\n    params = $.extend(true, {tpls: TPLS}, params || {});\n    for (var def in DEF_OPTS) if (typeof params[def] === 'undefined') params[def] = DEF_OPTS[def];\n    ac.params = params, ac.initialized = false, ac.selectedItems = [], ac.selectedItemMap = {}, ac.readonly = false;\n\n    // htmlOverHandler\n    var htmlOverHandler = function () {\n      if (!ac.resized4htmlOver) {\n        if (ac.el.is(':visible')) ac.resize();\n        $('html').off('mouseover', htmlOverHandler);\n        ac.resized4htmlOver = true;\n      }\n    };\n\n    // htmlClickHandler\n    var htmlClickHandler = function (e) {\n      if (!ac.el.hasClass('open')) return;\n      if ($(e.target).hasClass('bootstrap-autocomplete')) return;\n\n      var autocomplete = $(e.target).parents('.bootstrap-autocomplete');\n      if (autocomplete.size() == 0) ac.close();\n      else if (autocomplete[0] != ac.el[0]) ac.close();\n    };\n\n    // htmlResizeHandler\n    var resizeTimeout;\n    var htmlResizeHandler = function (e) {\n      if (resizeTimeout) clearTimeout(resizeTimeout);\n      setTimeout(function () {\n        ac.panel.resize();\n      }, 100);\n    };\n\n    // elOverHandler\n    var elOverHandler = function () {\n      if (!ac.resized4elOver) {\n        if (ac.el.is(':visible')) ac.resize();\n        ac.el.off('mouseover', elOverHandler);\n        ac.resized4elOver = true;\n      }\n    };\n\n    // addValue\n    ac.addValue = function (items, opts) {\n      opts = $.extend({onSetFinish: $.noop}, opts || {});\n\n      var oldSelectedItems = ac.getValue(), changeFired;\n      if (opts.clear) ac.clearValue(false);\n      if (!items) {\n        opts.fireInit ? ac.fireOnInit() : changeFired = ac.fireOnChange(oldSelectedItems, ac.getValue());\n        opts.onSetFinish.call(ac, changeFired);\n        return;\n      }\n\n      if (!(items instanceof Array)) {\n        if (isString(items)) items = [{c: items, n: items}];\n        else items = [items];\n      } else if (items.length <= 0) {\n        return;\n      } else {\n        var formatedItems = [];\n        $.each(items, function (i, item) {\n          if (isString(item)) formatedItems.push({c: item, n: item});\n          else formatedItems.push(item);\n        });\n        items = formatedItems;\n      }\n\n      if (ac.params.forceSelect && ac.params.loadDataItems) {\n        ac.loadDataItems(items).then(function (tmpData) {\n          $.each(items, function (i, item) {\n            ac.badge.addBadge(item, {specialData: tmpData});\n          });\n        }).always(function () {\n          opts.fireInit ? ac.fireOnInit() : changeFired = ac.fireOnChange(oldSelectedItems, ac.getValue());\n          opts.onSetFinish.call(ac, changeFired);\n        });\n      } else {\n        var lastSearchData = ac.data, needCheckRemote = ac.params.forceSelect && ac.params.loadData && true;\n        var toCheckCount = items.length, checkedItemCount = 0;\n        if (items.length > 0 && !needCheckRemote) ac.data = (ac.params.data || []).slice();\n        $.each(items, function (i, item) {\n          if (needCheckRemote) {\n            if (ac.searchInData(item, lastSearchData)) {\n              ac.badge.addBadge(item);\n              checkedItemCount++;\n            } else {\n              var itemCode = item.c || item.code, itemName = item.n || item.name;\n              var searchMode = ac.isInSearchMode('name') ? 'name' : 'code';\n              var searchText = searchMode == 'code' ? itemCode : itemName, tmpData = [];\n              ac.loadData({\n                searchText                : searchText,\n                specialData               : tmpData,\n                showAllItemsWhenFirstFocus: false,\n                searchMode                : searchMode,\n                from                      : 'addValue'\n              }).then(function (tmpData) {\n                lastSearchData = tmpData;\n                ac.badge.addBadge(item, {specialData: tmpData});\n              }).always(function () {\n                if (++checkedItemCount == toCheckCount) {\n                  opts.fireInit ? ac.fireOnInit() : changeFired = ac.fireOnChange(oldSelectedItems, ac.getValue());\n                  opts.onSetFinish.call(ac, changeFired);\n                }\n              });\n            }\n          } else ac.badge.addBadge(item);\n        });\n        if (!needCheckRemote) {\n          opts.fireInit ? ac.fireOnInit() : changeFired = ac.fireOnChange(oldSelectedItems, ac.getValue());\n          opts.onSetFinish.call(ac, changeFired);\n        }\n      }\n    };\n\n    // setValue\n    ac.setValue = function (items, opts) {\n      opts = $.extend(opts || {}, {clear: true});\n      ac.addValue(items, opts);\n    };\n\n    // openOnFocus\n    ac.openOnFocus = function () {\n      var showAllItemsWhenFirstFocus = ac.params.showAllWhenSingleForceSelectFocus && ac.params.forceSelect && ac.isSingleMode();\n      ac.loadData({showAllItemsWhenFirstFocus: showAllItemsWhenFirstFocus, from: 'openOnFocus'}).then(function () {\n        ac.open();\n        ac.panel.render();\n      });\n    };\n\n    // isInSearchMode\n    ac.isInSearchMode = function (mode) {\n      return ac.params.searchMode.indexOf(mode) >= 0;\n    };\n\n    // resize\n    ac.resize = function () {\n      ac.badge.resize();\n    };\n\n    // destroy\n    ac.destroy = function () {\n      ac.destoried = true;\n      ac.panel.destroy();\n      $('html').off({'click': htmlClickHandler, 'mouseover': htmlOverHandler});\n      $(window).off('resize', htmlResizeHandler);\n      ac.params.el.removeData(\"bsAutoComplete\");\n      ac.el.remove();\n      if (ac.selectedItemsInfo) ac.selectedItemsInfo.destroy();\n    };\n\n    // fireOnChange\n    ac.fireOnChange = function (oldItems, newItems) {\n      var fire = true;\n      if (oldItems != newItems && oldItems.length == newItems.length) {\n        var allItemsSame = true;\n        $.each(oldItems, function (i, oldItem) {\n          var oldItemCode = oldItem.code || oldItem.c, oldItemName = oldItem.name || oldItem.n;\n          var newItem = newItems[i], newItemCode = newItem.code || newItem.c, newItemName = newItem.name || newItem.n;\n          if (oldItemCode != newItemCode || oldItemName != newItemName) {\n            allItemsSame = false;\n            return false;\n          }\n        });\n        if (allItemsSame) fire = false;\n      }\n      if (fire) {\n        if (ac.params.disableResizeContainer !== false && ac.resizeContainer)\n          setTimeout(function () { ac.containerEl.height(ac.el.outerHeight()); }, 0);\n        ac.params.el.trigger('bs.autocomplete.change', [oldItems, newItems]);\n      }\n      return fire;\n    };\n\n    // fireOnPanelResize\n    ac.fireOnPanelResize = function () {\n      ac.params.el.trigger('bs.autocomplete.panel.resize', [ac]);\n    };\n\n    // fireOnSelect\n    ac.fireOnSelect = function (item, items) {\n      ac.params.el.trigger('bs.autocomplete.select', [item, items]);\n    };\n\n    // fireOnClose\n    ac.fireOnClose = function () {\n      if (ac.inputGroupEl) ac.inputGroupEl.removeClass('open');\n      ac.params.el.trigger('bs.autocomplete.close');\n    };\n\n    // fireOnInit\n    ac.fireOnInit = function () {\n      if (ac.isInitialized) return;\n\n      ac.isInitialized = true;\n      ac.params.el.trigger('bs.autocomplete.inited');\n    };\n\n    // fireOnFocus\n    ac.fireOnFocus = function () {\n      if (ac.inputGroupEl) ac.inputGroupEl.addClass('focus');\n      ac.params.el.trigger('bs.autocomplete.focus');\n    };\n\n    // fireOnPen\n    ac.fireOnPen = function () {\n      if (ac.inputGroupEl) ac.inputGroupEl.addClass('open');\n      ac.params.el.trigger('bs.autocomplete.open');\n    };\n\n    // fireBadgeRemoved\n    ac.fireBadgeRemoved = function (opts) {\n      opts = opts || {};\n      if (opts.innerFireBadgeRemoved) opts.innerFireBadgeRemoved();\n      if (opts.needFireBadgeRemoved !== false)\n        ac.params.el.trigger('bs.autocomplete.badge.removed', [opts.item, opts.badgeEl]);\n    };\n\n    // fireOnBlur\n    ac.fireOnBlur = function () {\n      if (ac.inputGroupEl) ac.inputGroupEl.removeClass('focus');\n      ac.params.el.trigger('bs.autocomplete.blur');\n    };\n\n    // fireOnDeSelect\n    ac.fireOnDeSelect = function (item, items) {\n      ac.params.el.trigger('bs.autocomplete.deselect', [item, items]);\n    };\n\n    // isSingleMode\n    ac.isSingleMode = function () {\n      return !ac.params.multiple;\n    };\n\n    // isHideBadge\n    ac.isHideBadge = function () {\n      return ac.params.hideBadge && ac.isSelectOptionMode();\n    };\n\n    // isSelectOptionMode\n    ac.isSelectOptionMode = function () {\n      return ac.params.mode === MODE.selectOption && !ac.isSingleMode();\n    };\n\n    // close\n    ac.close = function () {\n      ac.el.removeClass('open');\n      ac.panel.close();\n      ac.fireOnClose();\n      ac.closeTime = new Date().getTime();\n    };\n\n    // open\n    ac.open = function () {\n      if (ac.readonly) return;\n      ac.panel.resize();\n      ac.panel.relocate();\n      ac.el.addClass('open');\n      ac.fireOnPen();\n    };\n\n    // isOpen\n    ac.isOpen = function () {\n      return ac.el.hasClass('open');\n    };\n\n    // getValue\n    ac.getValue = function () {\n      return ac.selectedItems.slice();\n    };\n\n    // clearData\n    ac.clearData = function () {\n      ac.data.splice(0, ac.data.length);\n    };\n\n    // clearValue\n    ac.clearValue = function (fire) {\n      if (ac.isSingleMode()) ac.input.clear(fire);\n\n      var oldSelectedItems = ac.getValue();\n      ac.selectedItems.splice(0, ac.selectedItems.length);\n      ac.selectedItemMap = {};\n      ac.el.children('.' + CLS.badgeCt).remove();\n      ac.el.removeClass(CLS.itemSelected);\n      if (ac.selectedItemsInfo) ac.selectedItemsInfo.refreshItems();\n      ac.placeholder.refresh();\n      if (fire !== false) {\n        ac.params.el.trigger('bs.autocomplete.clear');\n        ac.fireOnChange(oldSelectedItems, ac.getValue());\n      }\n    };\n\n    // setReadonly\n    ac.setReadonly = function (readonly) {\n      readonly = readonly !== false;\n      ac.readonly = readonly;\n      if (readonly) ac.el.addClass('readonly');\n      else ac.el.removeClass('readonly');\n    };\n\n    // isReadonly\n    ac.isReadonly = function () {\n      return ac.readonly;\n    };\n\n    // addSelected\n    ac.addSelected = function (item, opts) {\n      opts = opts || {};\n      var oldSelectedItems = ac.selectedItems.slice();\n\n      if (ac.isSingleMode()) {\n        ac.selectedItems.splice(0, ac.selectedItems.length);\n        ac.selectedItemMap = {};\n      }\n\n      ac.selectedItems.push(item);\n      ac.selectedItemMap[item.c || item.code] = item;\n      if (ac.selectedItems.length > 0) ac.el.addClass(CLS.itemSelected);\n\n      if (ac.isOpen()) {\n        var itemEl = opts.itemEl || ac.panel.findItemEl(item);\n        if (itemEl) itemEl.addClass(CLS.itemChecked);\n      }\n\n      if (ac.selectedItemsInfo) ac.selectedItemsInfo.refreshItems();\n\n      if (opts.innerOnAddSelected) opts.innerOnAddSelected(item, oldSelectedItems, ac.getValue());\n      if (opts.fire !== false) {\n        if (opts.needFireOnSelect !== false) ac.fireOnSelect(item, ac.getValue());\n        if (opts.needFireOnChange !== false) ac.fireOnChange(oldSelectedItems, ac.getValue());\n      }\n    };\n\n    // isSelected\n    ac.isSelected = function (item) {\n      return item && ac.selectedItemMap[item.c || item.code];\n    };\n\n    // removeSelected\n    ac.removeSelected = function (item, opts) {\n      opts = opts || {};\n\n      var findIndex = ac.findSelectedItem(item);\n      if (findIndex >= 0) {\n        var oldSelectedItems = ac.selectedItems.slice();\n        ac.selectedItems.splice(findIndex, 1);\n        delete ac.selectedItemMap[item.c || item.code];\n        if (ac.selectedItems.length <= 0) ac.el.removeClass(CLS.itemSelected);\n\n        if (ac.selectedItemsInfo) ac.selectedItemsInfo.refreshItems();\n\n        if (opts.innerOnRemoveSelected) opts.innerOnRemoveSelected(item, oldSelectedItems, ac.getValue());\n        if (opts.fire !== false) {\n          if (opts.needFireOnDeSelect !== false) ac.fireOnDeSelect(item, ac.getValue());\n          if (opts.needFireOnChange !== false) ac.fireOnChange(oldSelectedItems, ac.getValue());\n        }\n      }\n    };\n\n    // isItemMatched\n    ac.isItemMatched = function (searchText, item) {\n      var regex = new RegExp(escapeRegex(searchText), ac.params.ignoreCase ? 'i' : undefined);\n      var matched = false;\n      if (ac.isInSearchMode('name')) matched = regex.test(item.n || item.name);\n      if (!matched && ac.isInSearchMode('code')) matched = regex.test(item.c || item.code);\n      return matched;\n    };\n\n    // findSelectedItem\n    ac.findSelectedItem = function (item) {\n      var result = -1, itemCode = item.c || item.code, itemName = item.n || item.name;\n      $.each(ac.selectedItems, function (i, selItem) {\n        var selCode = selItem.c || selItem.code, selName = selItem.n || selItem.name;\n        if (selCode === itemCode && selName === itemName) {\n          result = i;\n          return false;\n        }\n      });\n      return result;\n    };\n\n    // searchInData\n    ac.searchInData = function (item, data) {\n      var isFromStr = isString(item);\n      if (isFromStr) item = {c: item, n: item};\n      var findItem, itemCode = item.c || item.code, itemName = item.n || item.name, data = data || ac.data;\n\n      $.each(data, function (i, dataItem) {\n        var dataCode = dataItem.c || dataItem.code, dataName = dataItem.n || dataItem.name;\n        if (isFromStr) {\n          if (ac.isInSearchMode('name') && dataName == itemName || ac.isInSearchMode('code') && dataCode == itemCode) {\n            findItem = dataItem;\n            return false;\n          }\n        } else {\n          if (dataName == itemName && dataCode == itemCode) {\n            findItem = dataItem;\n            return false;\n          }\n        }\n      });\n      return findItem;\n    };\n\n    // loadDataItems\n    ac.loadDataItems = function (items) {\n      var defered = $.Deferred();\n      var loadedItems = [];\n\n      ac.params.loadDataItems.call(ac, items, function (data) {\n        if (data) {\n          $.each(data, function (i, item) {\n            if (isString(item)) item = {c: item, n: item};\n            loadedItems.push(item);\n          });\n          defered.resolve(loadedItems);\n        } else defered.reject();\n      });\n\n      return defered.promise();\n    };\n\n    // loadData\n    ac.loadDataSeq = 0;\n    ac.loadData = function (opts) {\n      var loadSeq = ac.loadDataSeq++;\n      opts = opts || {};\n      opts.searchText = opts.showAllItemsWhenFirstFocus ? '' : (opts.searchText || ac.input.getSearchText());\n      var defered = $.Deferred();\n\n      opts.specialData = opts.specialData || ac.data;\n      opts.specialData.splice(0, opts.specialData.length);\n      if (ac.params.loadData) {\n        ac.params.loadData.call(ac, opts.searchText, function (data, _loadSeq) {\n          // 通过seq跳过队列前端的异步响应\n          var nLoadSeq = Number(_loadSeq);\n          if (!isNaN(_loadSeq) && (_loadSeq + '' === nLoadSeq + '') && _loadSeq !== ac.loadDataSeq - 1) return;\n\n          if (data) {\n            opts.specialData.splice(0, opts.specialData.length);\n            $.each(data, function (i, item) {\n              if (isString(item)) item = {c: item, n: item};\n              opts.specialData.push(item);\n            });\n            defered.resolve(opts.specialData);\n          } else defered.reject();\n        }, opts.searchMode, opts.from, loadSeq);\n      } else {\n        var data = ac.params.data || [], lastGroupItem;\n        $.each(data, function (i, item) {\n          if (isString(item)) item = {c: item, n: item};\n          if (item.optGroup === true) {\n            lastGroupItem = item;\n            return;\n          }\n          if (opts.searchText && !ac.isItemMatched(opts.searchText, item)) return;\n          if (lastGroupItem) {\n            opts.specialData.push(lastGroupItem);\n            lastGroupItem = undefined;\n          }\n          opts.specialData.push(item);\n        });\n        defered.resolve(opts.specialData);\n      }\n      return defered.promise();\n    };\n\n    ac.data = [], ac.el = $(ac.params.tpls.containerTpl).addClass(ac.params.cls);\n\n    // 解决在 input-group 中的样式问题\n    var inputGroupEl = ac.inputGroupEl = params.el.closest('.input-group'),\n      isUnderInputGroup = ac.isUnderInputGroup = inputGroupEl.size() > 0;\n\n    var isOriginInputEl = params.el.is(':input');\n    if (isOriginInputEl && !ac.params.replace) ac.params.replace = true;\n\n    // 原始元素为 input 时且父元素为 input-group 时放入代理容器\n    var inputDelegateCtEl;\n    if (isOriginInputEl && params.el.parent().hasClass('input-group')) {\n      inputDelegateCtEl = ac.inputDelegateCtEl = $(ac.params.tpls.inputDelegateContainerTpl)\n        .addClass('form-control');\n      inputDelegateCtEl.insertAfter(params.el);\n      params.el.appendTo(inputDelegateCtEl);\n    }\n\n    if (ac.params.fitWdith !== false) ac.el.addClass('fit-width');\n    if (ac.params.dropUp) ac.el.addClass('dropup');\n    if (ac.params.replace) {\n      ac.el.insertAfter(params.el);\n      params.el.hide();\n    } else {\n      if (inputDelegateCtEl) {\n        ac.el.appendTo(inputDelegateCtEl);\n      } else {\n        if (isUnderInputGroup) params.el.addClass('form-control');\n        ac.el.appendTo(params.el);\n      }\n    }\n\n    var bsAcCtEl = ac.containerEl = ac.el.parent(), resizeHeightCls = 'bs-ac-ct-resize';\n    if (isUnderInputGroup && bsAcCtEl.hasClass('form-control')) bsAcCtEl.addClass(resizeHeightCls);\n    ac.resizeContainer = bsAcCtEl.hasClass(resizeHeightCls);\n\n    ac.input = new Input(ac);\n    ac.panel = new DropdownPanel(ac);\n    ac.badge = new Badge(ac);\n    ac.placeholder = new PlaceHolder(ac);\n    if (ac.params.data) {\n      $.each(ac.params.data, function (i, item) {\n        if (isString(item)) ac.data.push({c: item, n: item});\n        else ac.data.push(item);\n      });\n      ac.params.data = ac.data.slice();\n    }\n\n    { // clear btn\n      $(ac.params.tpls.clearBtnTpl)[ac.isHideBadge() ? 'prependTo' : 'appendTo'](ac.el)\n        .addClass(CLS.clearBtnClass)\n        .on('click', function (e) {\n          if (ac.isReadonly()) return;\n\n          ac.clearValue();\n          stopEvent(e);\n        });\n    }\n\n    if (ac.params.readonly) ac.setReadonly(true);\n\n    ac.el.on({\n      mousedown: function (e) {\n        if (ac.isReadonly()) return;\n\n        if (e.target == ac.el[0]) {\n          var badge = ac.badge.getClosestBadge(e.offsetX, e.offsetY);\n          ac.input.moveToBadge(badge);\n          if (ac.input.isFocused) stopEvent(e);\n          //ac.input.focus();\n        }\n      },\n      click    : function (e) {\n        if (ac.isReadonly()) return;\n\n        if (ac.selectedItemsInfo && ac.selectedItemsInfo.isStopDragLately()) return;\n        if (ac.isHideBadge()) ac.el.addClass('focus');\n        ac.input.focus();\n        if (ac.input.isFocused) stopEvent(e);\n      },\n      mouseover: elOverHandler\n    });\n\n    if (ac.isHideBadge()) {\n      ac.el.addClass(CLS.badgeHide);\n      ac.selectedItemsInfo = new SelectedItemsInfo(ac);\n    } else {\n      ac.el.removeClass(CLS.badgeHide);\n    }\n\n    originEl.data(\"bsAutoComplete\", this);\n    if (ac.params.value) ac.setValue(ac.params.value, {fireInit: true});\n    else ac.fireOnInit();\n\n    $('html').on({'click': htmlClickHandler, 'mouseover': htmlOverHandler});\n    $(window).on('resize', htmlResizeHandler);\n  };\n\n  $.fn.bsAutoComplete = function (params) {\n    var args = arguments;\n    return this.each(function () {\n      if (!this) return;\n      var $this = $(this);\n\n      var bsAutoComplete = $this.data(\"bsAutoComplete\");\n      if (!bsAutoComplete && params != 'destroy') {\n        params = $.extend({\n          el: $this, value: $this.val() ? $this.val().split(params.splitChar || ' ') : ''\n        }, params);\n        bsAutoComplete = new AutoComplete(params, $this);\n      }\n      if (bsAutoComplete && isString(params))\n        bsAutoComplete[params].apply(bsAutoComplete, Array.prototype.slice.call(args, 1));\n    });\n  }\n\n})(jQuery);\n"]}