!function(C){"use strict";var f={cls:"",placeHolder:"请选择",emptyListTip:"未找到匹配的数据项",searchMode:"code name",ignoreCase:!0,fitWdith:!0,dropUp:!1,filtSame:!1,badgeCls:"",dblclick4Edit:!1,inputSearchDelay:200,forceSelect:!1,minChar:1,multiple:!0,mode:"",selectAllBtnTxt:"全选",revselectBtnTxt:"反选",hideBadge:!1,disableSelectedItemsInfoDragAnmiate:!1,debounceFn:function(t,a,e){if(C.debounce)return C.debounce(t,e,a);var n=-1,l=-1;return function(){var e=+(new Date).getTime();(n<0||t<e-n)&&(n=e,0<l&&(clearTimeout(l),l=-1),l=setTimeout(function(){n=l=-1,a()},t))}}},i=-1<navigator.userAgent.indexOf("Trident"),v=13,b=9,I=37,S=38,O=39,T=40,D=27,M=8,x=46,g={inputDelegateContainerTpl:'<div class="input-delegate-ct"></div>',containerTpl:'<div class="btn-group bootstrap-autocomplete form-control">        <div class="selected-items-info"><div class="selected-items-text"></div></div>      </div>',inputTpl:'<div class="delegate-input">        <input type="text" class="input-delegate">        <span class="input-delegate-sizer">W</span>      </div>',dropdownTpl:'<ul class="dropdown-menu bs-autocomplete-menu"></ul>',dropdownTopBarTpl:'<div class="bs-autocomplete-menu-bar"><a class="btn btn-default selrev-btn">反选</a><a class="btn btn-default selall-btn">全选</a></div>',placeholderTpl:'<div class="bs-autocomplete-placeholder"></div>',clearBtnTpl:'<span class="bsautocomplete-icon-cross bsautocomplete-font icon-jiaochacross78"></span>',emptyDropDownItemTpl:'<li class="bs-autocomplete-empty-item"></li>',dropdownItemTpl:'<li>        <a href="javascript:">          <span class="text"></span>          <span class="item-status-icon glyphicon glyphicon-ok"></span>        </a>      </li>',badgeTpl:'<span class="label label-primary">        <a href="javascript:" class="badge-text"></a>        <a href="javascript:" class="badge-close">x</a>      </span>'},B="bs-autocomplete-badge",h="bs-autocomplete-badge-hide",y="bs-autocomplete-item",w="multiple-selected",F="multiple-hide-selected",E="selected",z="item-checked",V="bs-autocomplete-clear-btn",a="bs-autocomplete-input-clear-btn",n="has-input-val",l="empty-list",r="bs-autocomplete-mode-",R="items-text-grabbing",A={selectOption:"selectOption"},o=function(e,t){return Number(e.css(t).replace("px",""))},k=function(e){return C("<div></div>").append(e).html()},s=function(e){document.selection?document.selection.createRange().moveStart("character",e.value.length):e.selectionStart=e.value.length},W=function(e){e.preventDefault(),e.stopPropagation()},L=function(e){return"string"==typeof e},H=function(e){var t=this.el=C(e.params.tpls.placeholderTpl).prependTo(e.el);t.text(e.params.placeHolder),this.refresh=function(){0<e.selectedItems.length?t.hide():t.show()}},G=function(f){var g=this;C(f.el).on("click","."+B,function(e){W(e)}).on("click",".badge-close",function(e){var t=C(e.currentTarget).closest("."+B);g.closeBadge(t,{closePanel:!f.isSelectOptionMode()}),W(e)}).on(f.params.dblclick4Edit?"dblclick":"click",".badge-text",function(e){if(!f.isReadonly()){var t=C(e.currentTarget).closest("."+B),a=t.data("bsAutoCompleteItem");if(a){t.after(f.input.el).remove(),f.removeSelected(a);var n=f.isInSearchMode("name")?a.n||a.name:a.c||a.code;f.params.getText4BadgeEdit&&(n=f.params.getText4BadgeEdit.call(f,a,n)),f.editingItem={item:a,text:n},f.close(),f.input.updateTextValue(n),W(e)}}}),g.resize=function(e){if(e){var t=e.find(".badge-close"),a=o(e,"margin-left"),n=o(e,"margin-right"),l=(i=f.el,s=o(i,"padding-left"),r=o(i,"padding-right"),i.innerWidth()-s-r-f.input.emptyWidth-a-n-t.outerWidth()-2);e.find(".badge-text").css("max-width",l+"px")}else f.el.children("."+B).each(function(){g.resize(C(this))});var i,s,r},g.findSelectedBadgeEl=function(l){if(l){var i,s=l.n||l.name,r=l.c||l.code;return f.el.children("."+B).each(function(){var e=C(this),t=e.data("bsAutoCompleteItem");if(t){var a=t.n||t.name,n=t.c||t.code;if(t===l)return i=e,!1;n===r&&a===s&&(!0,i=e)}}),i}},g.closeBadge=function(e,t){if(t=t||{},!f.isReadonly()){var a=e.data("bsAutoCompleteItem");if(e.remove(),f.removeSelected(a,{needFireOnDeSelect:t.needFireOnDeSelect,needFireOnChange:t.needFireOnChange,innerOnRemoveSelected:t.innerOnRemoveSelected}),f.isOpen()){var n=t.itemEl||f.panel.findItemEl(a);n&&n.removeClass(z),!1!==t.closePanel&&(f.selectedItems.length<=0&&f.input.blur(),f.close())}f.placeholder.refresh(),f.fireBadgeRemoved({needFireBadgeRemoved:t.needFireBadgeRemoved,innerFireBadgeRemoved:t.innerFireBadgeRemoved,item:a,badgeEl:e})}},g.getLastBadge=function(){var e=f.el.children("."+B);if(0<e.size())return C(e[e.size()-1])},g.getClosestBadge=function(i,s){var r,o;return f.el.children("."+B).each(function(){var e=C(this),t=e.position(),a=t.left,n=t.top,l=n+e.outerHeight();t.left,e.outerWidth();if(n<=s&&s<=l){if(o=!0,i<=a)return r=e,!1}else if(o)return r=e,!1}),r},g.addBadge=function(e,t){var a,n=(t=t||{}).specialData;if(e){if(f.editingItem)if(e===f.editingItem.item)a=e;else if(L(e))f.editingItem.text===e&&(a=f.editingItem.item);else{var l=f.editingItem.item,i=l.c||l.code,s=l.n||l.name,r=e.c||e.code,o=e.n||e.name;r===i&&o===s&&(a=e)}if(a||(L(e)?(a=f.searchInData(e,n))||f.params.forceSelect||(a={c:e,n:e}):a=f.params.forceSelect?f.searchInData(e,n):e),a){if(delete f.editingItem,!0===a.optGroup)return!1;var d,c=a.n||a.name,u=a.hn||a.htmlName;if(f.params.badgeRender)d=f.params.badgeRender.call(f,a);else{var p=(d=C(f.params.tpls.badgeTpl)).find(".badge-text");f.params.itemUseHtml?p.append(k(C(u||c))):p.text(c),p.attr("title",c)}d.data("bsAutoCompleteItem",a).addClass(B+" "+f.params.badgeCls);var m=!1;if(f.params.filtSame&&0<f.selectedItems.length&&!f.isSingleMode()){if(0<=f.findSelectedItem(a))return!0;m=!0}else m=!0;return m&&(f.isSingleMode()&&f.el.children("."+B).remove(),f.input.el.before(d),f.addSelected(a,{fire:!n,needFireOnSelect:t.needFireOnSelect,needFireOnChange:t.needFireOnChange,innerOnAddSelected:t.innerOnAddSelected,itemEl:t.itemEl}),g.resize(d),f.isSingleMode()&&f.input.updateTextValue(c,!1),f.placeholder.refresh()),m}delete f.editingItem}else delete f.editingItem},f.isSingleMode()&&f.el.addClass("single-badge")},P=function(c){var u,p,n,m,f=c.el.children(".selected-items-info"),g=f.children(".selected-items-text"),h=!1,v=!1,b=-1,I=-1,S=function(){0<=I&&clearInterval(I),I=-1},e=function(e){if(h=!1,v){b=(new Date).getTime();var t=(new Date).getTime()-m;if(t<200&&0<t&&!0!==c.params.disableSelectedItemsInfoDragAnmiate){var a=f.scrollLeft(),n=e.pageX,l=Math.abs(n-u),i=n<u?1:-1,s=10*l/(t/1e3),r=b,o=f.innerWidth(),d=g.outerWidth();I=setInterval(function(){if(s<1)return S();var e=((new Date).getTime()-r)/1e3,t=.5*s*e*e;return s*=1-Math.log(e+1),a+=t*i,f.scrollLeft(a),a<=0||o<d&&d-o<=a?S():void 0},100)}v=!1,u=p=m=undefined,f.removeClass(R),W(e)}},t=function(e){if(h){var t=e.pageX-u;if(30<Math.abs(t)&&(v=!0,f.addClass(R)),v){var a=p-t;a<=0?a=0:n<=a&&(a=n),f.scrollLeft(a),W(e)}}};C(document).on({mousemove:t,mouseup:e}),g.on({mousedown:function(e){var t=f.innerWidth(),a=g.outerWidth();S(),!h&&t<a&&(h=!0,n=a-t,u=e.pageX,p=f.scrollLeft(),m=(new Date).getTime())},mousewheel:function(e){W(e);var t=f.innerWidth(),a=g.outerWidth(),n=f.scrollLeft(),l=0<(e.originalEvent.wheelDelta&&e.originalEvent.wheelDelta||e.originalEvent.detail&&e.originalEvent.detail)?-1:1,i=n+Math.floor(l*t*.8);i<=0?i=0:t<a&&a-t<=i&&(i=a-t),f.scrollLeft(i)}}),this.destroy=function(){C(document).off({mousemove:t,mouseup:e})},this.isStopDragLately=function(){return(new Date).getTime()-b<=100},this.refreshItems=function(){var e=c.selectedItems||[],a=[];C.each(e,function(e,t){a.push(t.n||t.name)});var t=a.join(","),n=c.el.width()-5;0<n&&f.css("max-width",n),g.text(t).attr("title",t),c.placeholder.refresh()}},j=function(c){var u,p,e,m=this,f=m.el=C(c.params.tpls.inputTpl).appendTo(c.el),t=f.children(".input-delegate-sizer"),g=f.children(":text"),h=c.params.debounceFn(c.params.inputSearchDelay,function(){if(!c.destoried)return g.val().length<c.params.minChar?(c.close(),void c.panel.el.empty()):void c.loadData({from:"keydown"}).then(function(){c.input.isFocused&&(c.open(),c.panel.render())})},!0);g.on({focus:function(e){if(c.isReadonly())return g.blur(),void W(e);m.isFocused=!0,m.updateSizer(),c.isHideBadge()||c.placeholder.el.hide(),c.el.addClass("focus"),(c.params.minChar<=0||g.val().length>=c.params.minChar)&&c.openOnFocus(),c.isSingleMode()&&0<c.getValue().length&&(s(g[0]),c.editingItem={item:c.getValue()[0],text:g.val()}),c.fireOnFocus()},blur:function(e){if(m.isFocused){m.isFocused=!1,c.el.removeClass("focus");var t=!1;if(c.isSelectOptionMode()){var a=e.relatedTarget;if(a)0<C(a).closest(".badge-close").length&&(t=!0)}(!t&&g.val()&&!m.beforeMoveVal||!g.val()&&c.isSingleMode())&&m.confirmValue(!1,{fromBlur:!0}),c.placeholder.refresh(),t||(c.close(),c.fireOnBlur())}},keydown:function(e){if(!c.isReadonly()){m.updateSizer();var t=!1;switch(e.keyCode){case v:u&&(clearTimeout(u),u=undefined);var a=c.panel.getSelectedItemEl(),n=a.data("bsAutoCompleteItem");if(n){var l=c.isSelected(n)&&c.badge.findSelectedBadgeEl(n);l?c.badge.closeBadge(l,{closePanel:!c.isSelectOptionMode(),itemEl:a}):c.badge.addBadge(n,{itemEl:a})}c.isSelectOptionMode()?(!n&&g.val()&&!m.beforeMoveVal||!g.val()&&c.isSingleMode())&&m.confirmValue(!1,{fromBlur:!1}):m.blur(),W(e),t=!0;break;case D:m.confirmValue(!0),t=!0;break;case b:var i=!!g.val();m.confirmValue(),i&&!c.isSingleMode()&&(g.focus(),W(e)),t=!0;break;case I:case O:var s=function(e){var t=0;if(document.selection){var a=document.selection.createRange();a.moveStart("character",0-e.value.length),t=a.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}(g[0]),r=g.val().length;e.keyCode===I&&0===s?(m.moveToLR(!0),W(e)):e.keyCode===O&&s===r&&(m.moveToLR(!1),W(e)),t=!0;break;case S:case T:c.panel.moveSelect(e.keyCode===S),W(e),t=!0;break;case M:if(!g.val()){var o=f.prev("."+B);0<o.size()&&(c.badge.closeBadge(o),W(e),t=!0)}break;case x:if(!g.val()){var d=f.next("."+B);0<d.size()&&(c.badge.closeBadge(d),W(e),t=!0)}break;default:c.panel.relocate()}t||(u&&clearTimeout(u),u=setTimeout(function(){u=undefined,p||h()},200))}},keyup:function(e){c.isReadonly()||(m.updateSizer(),g.val()?f.addClass(n):f.removeClass(n))},compositionstart:function(){p=!0},compositionend:function(){p=!1,h()}}),m.moveToLR=function(e){if(!c.isSingleMode()){var t=e?f.prev("."+B+" "):f.next("."+B);t&&(m.beforeMoveVal=g.val(),e?t.before(f):t.after(f),g.val(m.beforeMoveVal),m.focus(),delete m.beforeMoveVal)}},m.moveToBadge=function(e){if(!c.isSingleMode())if(e)e.before(m.el);else{var t=c.badge.getLastBadge();t&&t.after(m.el)}},m.updateSizer=function(){t.text(g.val()+"WW")},m.updateTextValue=function(e,t){g.val(e),m.isFocused||!1===t||m.focus(),m.updateSizer(),i&&!1!==t&&s(g[0])},m.confirmValue=function(e,t){var a;t=t||{},e?c.editingItem&&(a=c.badge.addBadge(c.editingItem.item)):a=c.badge.addBadge(g.val()),c.isSingleMode()?(a||(0<c.selectedItems.length&&c.removeSelected(c.selectedItems[0]),g.val()&&m.clear()),t.fromBlur||g.blur(),c.close()):g.val()&&m.clear()},m.blur=function(){m.isFocused&&g.blur()},m.clear=function(e){g.val(""),!1===e?c.placeholder.refresh():g.blur(),t.text("W"),f.removeClass(n)},m.getSearchText=function(){return g.val()},m.focus=function(){m.isFocused||g.focus()},t.text("WW"),m.emptyWidth=(e=f).outerWidth()+o(e,"margin-left")+o(e,"margin-right"),t.text("W"),c.isHideBadge()&&C(c.params.tpls.clearBtnTpl).addClass(a).appendTo(f).on("mousedown",function(e){c.isReadonly()||(c.input.clear(!1),c.loadData().then(function(){c.panel.render()}),W(e))})},e=function(r,a){var e=this.el=C(r.params.tpls.dropdownTopBarTpl);C(a.el).on("mousedown",".selrev-btn",function(e){var i=[],s=[],t=r.selectedItems.slice();a.el.children("."+y).each(function(e,t){var a=C(t),n=a.data("bsAutoCompleteItem");if(n){var l=r.isSelected(n)&&r.badge.findSelectedBadgeEl(n);l?r.badge.closeBadge(l,{closePanel:!r.isSelectOptionMode(),itemEl:a,needFireOnDeSelect:!1,needFireOnChange:!1,needFireBadgeRemoved:!1,innerOnRemoveSelected:function(e){s.push(e)}}):r.badge.addBadge(n,{itemEl:a,needFireOnSelect:!1,needFireOnChange:!1,innerOnAddSelected:function(e){i.push(e)}})}}),0<i.length&&r.fireOnSelect(i,r.getValue()),0<s.length&&r.fireOnDeSelect(s,r.getValue()),(0<i.length||0<s.length)&&r.fireOnChange(t,r.getValue()),W(e)}).on("mousedown",".selall-btn",function(e){var l=[],t=r.selectedItems.slice();a.el.children("."+y).each(function(e,t){var a=C(t),n=a.data("bsAutoCompleteItem");n&&(r.isSelected(n)&&r.badge.findSelectedBadgeEl(n)||r.badge.addBadge(n,{itemEl:a,needFireOnSelect:!1,needFireOnChange:!1,innerOnAddSelected:function(e){l.push(e)}}))}),0<l.length&&(r.fireOnSelect(l,r.getValue()),r.fireOnChange(t,r.getValue())),W(e)}),e.find(".selrev-btn").text(r.params.revselectBtnTxt),e.find(".selall-btn").text(r.params.selectAllBtnTxt)},N=function(I){var a,s=this,S=s.el=C(I.params.tpls.dropdownTpl).appendTo(I.el),n=C(I.params.tpls.emptyDropDownItemTpl).text(I.params.emptyListTip);C(s.el).on("mousedown","."+y,function(e){if(!I.isReadonly()){var t=C(e.currentTarget),a=t.data("bsAutoCompleteItem");if(a)if(a.optGroup)W(e);else{var n=!0;if(I.isSelectOptionMode()){I.editingItem&&I.editingItem.item===a&&(delete I.editingItem,I.removeSelected(a),I.selectedItems.length<=0&&I.input.blur(),I.placeholder.refresh(),n=!1);var l=I.badge.findSelectedBadgeEl(a);l&&(I.badge.closeBadge(l,{closePanel:!1,itemEl:t}),n=!1)}else i&&I.input.blur(),I.input.clear();n&&I.badge.addBadge(a,{itemEl:t}),W(e)}}}),I.isSelectOptionMode()&&(a=new e(I,s)),S.on("mousewheel",function(e){if(e.currentTarget===S[0]){var t=S.scrollTop(),a=S.innerHeight(),n=S[0].scrollHeight,l=e.originalEvent.wheelDelta&&(0<e.originalEvent.wheelDelta?1:-1)||e.originalEvent.detail&&(0<e.originalEvent.detail?-1:1);(t<=0&&0<l||n-1<=t+a&&l<0)&&W(e)}}),s.findItemEl=function(s){if(s){var r,o=s.n||s.name,d=s.c||s.code,e=S.children("li."+y+"."+z);return C.each(e,function(e,t){var a=C(t),n=a.data("bsAutoCompleteItem");if(n){if(n===s)return r=a,!1;var l=n.n||n.name,i=n.c||n.code;l===o&&i===d&&(r=a)}}),r}},s.moveSelect=function(e){var t,a=S.children("li."+y+"."+E),n="."+y,l=!I.isSingleMode()&&I.params.hideOtherSelected4Multiple;if(l&&(n+=":not(."+F+")"),0<a.size()){for(t=e?a.prev():a.next();0<t.size()&&(!t.hasClass(y)||l&&t.hasClass(F));)t=e?t.prev():t.next();if(t.size()<=0)0<(i=S.children(n)).size()&&(t=C(e?i[i.size()-1]:i[0]))}else{var i;0<(i=S.children(n)).size()&&(t=C(e?i[i.size()-1]:i[0]))}t&&0<t.length&&(a.removeClass(E),t.addClass(E),s.scrollToSelected(t))},s.scrollToSelected=function(e){if(0<(e=e||S.children("li."+y+"."+E)).size()){var t=S.scrollTop(),a=e.position().top+t;a-=(S.height()-e.height())/2,S.scrollTop(a)}},s.getSelectedItemEl=function(){return S.children("li."+y+"."+E)},s.render=function(){var e=I.data||[],d=I.input.getSearchText();S.empty(),S.scrollTop();var t=I.editingItem&&I.editingItem.item||{},c=t.c||t.code,u=t.n||t.name;if(0<e.length){var p,m,f=!1,g=!I.isSingleMode(),h=I.params.hideOtherSelected4Multiple,v=0,b=0;S.removeClass(l),I.isSelectOptionMode()?(S.append(a.el),I.el.addClass(r+A.selectOption.toLowerCase())):I.el.removeClass(r+A.selectOption.toLowerCase()),C.each(e,function(e,t){var a,n=t.n||t.name,l=t.c||t.code,i=t.hn||t.htmlName,s=!0;if(I.params.itemRender)a=I.params.itemRender.call(I,t,d);else{var r=(a=C(I.params.tpls.dropdownItemTpl)).find(".text");I.params.itemUseHtml?r.append(k(C(i||n))):r.text(n)}var o=I.selectedItemMap[l];o&&(o===t||(o.c||o.code)===l&&(o.n||o.name)===n)?(a.addClass(z),g&&(a.addClass(w),h&&(s=!1,a.addClass(F)))):a.removeClass(z),!0===t.optGroup?(s=!1,a.addClass("bs-autocomplete-group"),p||(p=!0,S.addClass("bs-autocomplete-grouped")),m&&v<=0&&m.addClass("bs-autocomplete-group-hide"),m=a,v=0):(m&&s&&v++,s&&b++,a.addClass(y)),t.cls&&a.addClass(t.cls),a.appendTo(S).data("bsAutoCompleteItem",t).attr("title",n),!f&&d&&(I.editingItem&&I.editingItem.text==d&&c==l&&u==n&&(f=!0),I.isInSearchMode("name")&&d==n?f=!0:I.isInSearchMode("code")&&d==l&&(f=!0),f&&a.addClass(E))}),m&&v<=0&&m.addClass("bs-autocomplete-group-hide"),b<=0?S.addClass("no-selectable-items"):S.removeClass("no-selectable-items")}else S.addClass(l).append(n),I.isSelectOptionMode()||I.close()},s.resize=function(){var e=I.el.outerWidth();S.css("max-width",e),I.isSelectOptionMode()&&S.width(e),I.isHideBadge()&&I.input.el.width(e).css("max-width",e),I.fireOnPanelResize(I)},s.relocate=function(){var e=I.input.el.position().left;(I.isSingleMode()||I.isSelectOptionMode())&&(e=0),S.css("left",e+"px")},s.close=function(){S.children("."+y).removeClass(E).removeClass(z)},s.destroy=function(){S.children().each(function(){C(this).removeData("bsAutoCompleteItem")}),S.remove()}},d=function(e,t){var m=this;for(var a in e=C.extend(!0,{tpls:g},e||{}),f)"undefined"==typeof e[a]&&(e[a]=f[a]);m.params=e,m.initialized=!1,m.selectedItems=[],m.selectedItemMap={},m.readonly=!1;var n=function(){m.resized4htmlOver||(m.el.is(":visible")&&m.resize(),C("html").off("mouseover",n),m.resized4htmlOver=!0)},l=function(e){if(m.el.hasClass("open")&&!C(e.target).hasClass("bootstrap-autocomplete")){var t=C(e.target).parents(".bootstrap-autocomplete");0==t.size()?m.close():t[0]!=m.el[0]&&m.close()}},i=function(e){setTimeout(function(){m.panel.resize()},100)},s=function(){m.resized4elOver||(m.el.is(":visible")&&m.resize(),m.el.off("mouseover",s),m.resized4elOver=!0)};m.addValue=function(e,s){s=C.extend({onSetFinish:C.noop},s||{});var r,o=m.getValue();if(s.clear&&m.clearValue(!1),!e)return s.fireInit?m.fireOnInit():r=m.fireOnChange(o,m.getValue()),void s.onSetFinish.call(m,r);if(e instanceof Array){if(e.length<=0)return;var a=[];C.each(e,function(e,t){L(t)?a.push({c:t,n:t}):a.push(t)}),e=a}else e=L(e)?[{c:e,n:e}]:[e];if(m.params.forceSelect&&m.params.loadDataItems)m.loadDataItems(e).then(function(a){C.each(e,function(e,t){m.badge.addBadge(t,{specialData:a})})}).always(function(){s.fireInit?m.fireOnInit():r=m.fireOnChange(o,m.getValue()),s.onSetFinish.call(m,r)});else{var d=m.data,c=m.params.forceSelect&&m.params.loadData&&!0,u=e.length,p=0;0<e.length&&!c&&(m.data=(m.params.data||[]).slice()),C.each(e,function(e,t){if(c)if(m.searchInData(t,d))m.badge.addBadge(t),p++;else{var a=t.c||t.code,n=t.n||t.name,l=m.isInSearchMode("name")?"name":"code",i="code"==l?a:n;m.loadData({searchText:i,specialData:[],showAllItemsWhenFirstFocus:!1,searchMode:l,from:"addValue"}).then(function(e){d=e,m.badge.addBadge(t,{specialData:e})}).always(function(){++p==u&&(s.fireInit?m.fireOnInit():r=m.fireOnChange(o,m.getValue()),s.onSetFinish.call(m,r))})}else m.badge.addBadge(t)}),c||(s.fireInit?m.fireOnInit():r=m.fireOnChange(o,m.getValue()),s.onSetFinish.call(m,r))}},m.setValue=function(e,t){t=C.extend(t||{},{clear:!0}),m.addValue(e,t)},m.openOnFocus=function(){var e=m.params.showAllWhenSingleForceSelectFocus&&m.params.forceSelect&&m.isSingleMode();m.loadData({showAllItemsWhenFirstFocus:e,from:"openOnFocus"}).then(function(){m.open(),m.panel.render()})},m.isInSearchMode=function(e){return 0<=m.params.searchMode.indexOf(e)},m.resize=function(){m.badge.resize()},m.destroy=function(){m.destoried=!0,m.panel.destroy(),C("html").off({click:l,mouseover:n}),C(window).off("resize",i),m.params.el.removeData("bsAutoComplete"),m.el.remove(),m.selectedItemsInfo&&m.selectedItemsInfo.destroy()},m.fireOnChange=function(e,r){var t=!0;if(e!=r&&e.length==r.length){var o=!0;C.each(e,function(e,t){var a=t.code||t.c,n=t.name||t.n,l=r[e],i=l.code||l.c,s=l.name||l.n;if(a!=i||n!=s)return o=!1}),o&&(t=!1)}return t&&(!1!==m.params.disableResizeContainer&&m.resizeContainer&&setTimeout(function(){m.containerEl.height(m.el.outerHeight())},0),m.params.el.trigger("bs.autocomplete.change",[e,r])),t},m.fireOnPanelResize=function(){m.params.el.trigger("bs.autocomplete.panel.resize",[m])},m.fireOnSelect=function(e,t){m.params.el.trigger("bs.autocomplete.select",[e,t])},m.fireOnClose=function(){m.inputGroupEl&&m.inputGroupEl.removeClass("open"),m.params.el.trigger("bs.autocomplete.close")},m.fireOnInit=function(){m.isInitialized||(m.isInitialized=!0,m.params.el.trigger("bs.autocomplete.inited"))},m.fireOnFocus=function(){m.inputGroupEl&&m.inputGroupEl.addClass("focus"),m.params.el.trigger("bs.autocomplete.focus")},m.fireOnPen=function(){m.inputGroupEl&&m.inputGroupEl.addClass("open"),m.params.el.trigger("bs.autocomplete.open")},m.fireBadgeRemoved=function(e){(e=e||{}).innerFireBadgeRemoved&&e.innerFireBadgeRemoved(),!1!==e.needFireBadgeRemoved&&m.params.el.trigger("bs.autocomplete.badge.removed",[e.item,e.badgeEl])},m.fireOnBlur=function(){m.inputGroupEl&&m.inputGroupEl.removeClass("focus"),m.params.el.trigger("bs.autocomplete.blur")},m.fireOnDeSelect=function(e,t){m.params.el.trigger("bs.autocomplete.deselect",[e,t])},m.isSingleMode=function(){return!m.params.multiple},m.isHideBadge=function(){return m.params.hideBadge&&m.isSelectOptionMode()},m.isSelectOptionMode=function(){return m.params.mode===A.selectOption&&!m.isSingleMode()},m.close=function(){m.el.removeClass("open"),m.panel.close(),m.fireOnClose(),m.closeTime=(new Date).getTime()},m.open=function(){m.readonly||(m.panel.resize(),m.panel.relocate(),m.el.addClass("open"),m.fireOnPen())},m.isOpen=function(){return m.el.hasClass("open")},m.getValue=function(){return m.selectedItems.slice()},m.clearData=function(){m.data.splice(0,m.data.length)},m.clearValue=function(e){m.isSingleMode()&&m.input.clear(e);var t=m.getValue();m.selectedItems.splice(0,m.selectedItems.length),m.selectedItemMap={},m.el.children("."+B).remove(),m.el.removeClass(E),m.selectedItemsInfo&&m.selectedItemsInfo.refreshItems(),m.placeholder.refresh(),!1!==e&&(m.params.el.trigger("bs.autocomplete.clear"),m.fireOnChange(t,m.getValue()))},m.setReadonly=function(e){e=!1!==e,(m.readonly=e)?m.el.addClass("readonly"):m.el.removeClass("readonly")},m.isReadonly=function(){return m.readonly},m.addSelected=function(e,t){t=t||{};var a=m.selectedItems.slice();if(m.isSingleMode()&&(m.selectedItems.splice(0,m.selectedItems.length),m.selectedItemMap={}),m.selectedItems.push(e),m.selectedItemMap[e.c||e.code]=e,0<m.selectedItems.length&&m.el.addClass(E),m.isOpen()){var n=t.itemEl||m.panel.findItemEl(e);n&&n.addClass(z)}m.selectedItemsInfo&&m.selectedItemsInfo.refreshItems(),t.innerOnAddSelected&&t.innerOnAddSelected(e,a,m.getValue()),!1!==t.fire&&(!1!==t.needFireOnSelect&&m.fireOnSelect(e,m.getValue()),!1!==t.needFireOnChange&&m.fireOnChange(a,m.getValue()))},m.isSelected=function(e){return e&&m.selectedItemMap[e.c||e.code]},m.removeSelected=function(e,t){t=t||{};var a=m.findSelectedItem(e);if(0<=a){var n=m.selectedItems.slice();m.selectedItems.splice(a,1),delete m.selectedItemMap[e.c||e.code],m.selectedItems.length<=0&&m.el.removeClass(E),m.selectedItemsInfo&&m.selectedItemsInfo.refreshItems(),t.innerOnRemoveSelected&&t.innerOnRemoveSelected(e,n,m.getValue()),!1!==t.fire&&(!1!==t.needFireOnDeSelect&&m.fireOnDeSelect(e,m.getValue()),!1!==t.needFireOnChange&&m.fireOnChange(n,m.getValue()))}},m.isItemMatched=function(e,t){var a=new RegExp(function(e){if("string"!=typeof e)return e;return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}(e),m.params.ignoreCase?"i":undefined),n=!1;return m.isInSearchMode("name")&&(n=a.test(t.n||t.name)),!n&&m.isInSearchMode("code")&&(n=a.test(t.c||t.code)),n},m.findSelectedItem=function(e){var l=-1,i=e.c||e.code,s=e.n||e.name;return C.each(m.selectedItems,function(e,t){var a=t.c||t.code,n=t.n||t.name;if(a===i&&n===s)return l=e,!1}),l},m.searchInData=function(e,t){var l=L(e);l&&(e={c:e,n:e});var i,s=e.c||e.code,r=e.n||e.name;t=t||m.data;return C.each(t,function(e,t){var a=t.c||t.code,n=t.n||t.name;if(l){if(m.isInSearchMode("name")&&n==r||m.isInSearchMode("code")&&a==s)return i=t,!1}else if(n==r&&a==s)return i=t,!1}),i},m.loadDataItems=function(e){var t=C.Deferred(),a=[];return m.params.loadDataItems.call(m,e,function(e){e?(C.each(e,function(e,t){L(t)&&(t={c:t,n:t}),a.push(t)}),t.resolve(a)):t.reject()}),t.promise()},m.loadDataSeq=0,m.loadData=function(n){var e=m.loadDataSeq++;(n=n||{}).searchText=n.showAllItemsWhenFirstFocus?"":n.searchText||m.input.getSearchText();var l=C.Deferred();if(n.specialData=n.specialData||m.data,n.specialData.splice(0,n.specialData.length),m.params.loadData)m.params.loadData.call(m,n.searchText,function(e,t){var a=Number(t);(isNaN(t)||t+""!=a+""||t===m.loadDataSeq-1)&&(e?(n.specialData.splice(0,n.specialData.length),C.each(e,function(e,t){L(t)&&(t={c:t,n:t}),n.specialData.push(t)}),l.resolve(n.specialData)):l.reject())},n.searchMode,n.from,e);else{var a,t=m.params.data||[];C.each(t,function(e,t){L(t)&&(t={c:t,n:t}),!0!==t.optGroup?n.searchText&&!m.isItemMatched(n.searchText,t)||(a&&(n.specialData.push(a),a=undefined),n.specialData.push(t)):a=t}),l.resolve(n.specialData)}return l.promise()},m.data=[],m.el=C(m.params.tpls.containerTpl).addClass(m.params.cls);var r,o=m.inputGroupEl=e.el.closest(".input-group"),d=m.isUnderInputGroup=0<o.size(),c=e.el.is(":input");c&&!m.params.replace&&(m.params.replace=!0),c&&e.el.parent().hasClass("input-group")&&((r=m.inputDelegateCtEl=C(m.params.tpls.inputDelegateContainerTpl).addClass("form-control")).insertAfter(e.el),e.el.appendTo(r)),!1!==m.params.fitWdith&&m.el.addClass("fit-width"),m.params.dropUp&&m.el.addClass("dropup"),m.params.replace?(m.el.insertAfter(e.el),e.el.hide()):r?m.el.appendTo(r):(d&&e.el.addClass("form-control"),m.el.appendTo(e.el));var u=m.containerEl=m.el.parent(),p="bs-ac-ct-resize";d&&u.hasClass("form-control")&&u.addClass(p),m.resizeContainer=u.hasClass(p),m.input=new j(m),m.panel=new N(m),m.badge=new G(m),m.placeholder=new H(m),m.params.data&&(C.each(m.params.data,function(e,t){L(t)?m.data.push({c:t,n:t}):m.data.push(t)}),m.params.data=m.data.slice()),C(m.params.tpls.clearBtnTpl)[m.isHideBadge()?"prependTo":"appendTo"](m.el).addClass(V).on("click",function(e){m.isReadonly()||(m.clearValue(),W(e))}),m.params.readonly&&m.setReadonly(!0),m.el.on({mousedown:function(e){if(!m.isReadonly()&&e.target==m.el[0]){var t=m.badge.getClosestBadge(e.offsetX,e.offsetY);m.input.moveToBadge(t),m.input.isFocused&&W(e)}},click:function(e){m.isReadonly()||m.selectedItemsInfo&&m.selectedItemsInfo.isStopDragLately()||(m.isHideBadge()&&m.el.addClass("focus"),m.input.focus(),m.input.isFocused&&W(e))},mouseover:s}),m.isHideBadge()?(m.el.addClass(h),m.selectedItemsInfo=new P(m)):m.el.removeClass(h),t.data("bsAutoComplete",this),m.params.value?m.setValue(m.params.value,{fireInit:!0}):m.fireOnInit(),C("html").on({click:l,mouseover:n}),C(window).on("resize",i)};C.fn.bsAutoComplete=function(a){var n=arguments;return this.each(function(){if(this){var e=C(this),t=e.data("bsAutoComplete");t||"destroy"==a||(a=C.extend({el:e,value:e.val()?e.val().split(a.splitChar||" "):""},a),t=new d(a,e)),t&&L(a)&&t[a].apply(t,Array.prototype.slice.call(n,1))}})}}(jQuery);
//# sourceMappingURL=bootstrap-autocomplete.min.js.map
