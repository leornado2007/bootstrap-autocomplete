!function(g){"use strict";var l={cls:"",placeHolder:"请选择",searchMode:"code name",ignoreCase:!0,fitWdith:!0,dropUp:!1,filtSame:!1,badgeCls:"",dblclick4Edit:!1,inputSearchDelay:200,forceSelect:!1,minChar:1,multiple:!0},u=13,f=9,p=37,m=38,h=39,v=40,b=27,I=8,S=46,r='<div class="btn-group bootstrap-autocomplete form-control"></div>',a='<div class="delegate-input">        <input type="text" class="input-delegate">        <span class="input-delegate-sizer">W</span>      </div>',e='<ul class="dropdown-menu"></ul>',n='<div class="bs-autocomplete-placeholder"></div>',s='<span class="bsautocomplete-icon-cross bsautocomplete-font icon-jiaochacross78"></span>',C='<li>        <a href="javascript:">          <span class="text"></span>        </a>      </li>',y=' <span class="label label-primary">        <a href="javascript:" class="badge-text"></a>        <a href="javascript:" class="badge-close">x</a>      </span>',x="bs-autocomplete-badge",V=function(e,t){return Number(e.css(t).replace("px",""))},M=function(e){return g("<div></div>").append(e).html()},i=function(e){document.selection?document.selection.createRange().moveStart("character",e.value.length):e.selectionStart=e.value.length},z=function(e){e.preventDefault(),e.stopPropagation()},O=function(e){return"string"==typeof e},o=function(e){var t=this.el=g(n).prependTo(e.el);t.text(e.params.placeHolder),this.refresh=function(){0<e.selectedItems.length?t.hide():t.show()}},c=function(p){var m=this;m.resize=function(e){if(e){var t=e.find(".badge-close"),a=V(e,"margin-left"),n=V(e,"margin-right"),i=(l=p.el,r=V(l,"padding-left"),s=V(l,"padding-right"),l.innerWidth()-r-s-p.input.emptyWidth-a-n-t.outerWidth()-2);e.find(".badge-text").css("max-width",i+"px")}else p.el.children("."+x).each(function(){m.resize(g(this))});var l,r,s},m.closeBadge=function(e){e.find(".badge-close").click()},m.getLastBadge=function(){var e=p.el.children("."+x);if(0<e.size())return g(e[e.size()-1])},m.getCloestBadge=function(l,r){var s,o;return p.el.children("."+x).each(function(){var e=g(this),t=e.position(),a=t.left,n=t.top,i=n+e.outerHeight();t.left,e.outerWidth();if(n<=r&&r<=i){if(o=!0,l<=a)return s=e,!1}else if(o)return s=e,!1}),s},m.add=function(e,t){var a=p.panel.getSelectedItem();if(!a){if(!e)return void delete p.editingItem;if(p.editingItem)if(e===p.editingItem.item)a=e;else if(O(e))p.editingItem.text==e&&(a=p.editingItem.item);else{var n=p.editingItem.item,i=n.c||n.code,l=n.n||n.name,r=n.c||n.code,s=n.n||n.name;r==i&&s==l&&(a=e)}var o;if(!a)O(e)?(o=p.searchInData(e,t))||p.params.forceSelect||(a={c:e,n:e}):p.params.forceSelect?(o=p.searchInData(e,t))&&(a=o):a=e;if(!a)return void delete p.editingItem}delete p.editingItem;var c,d=a.n||a.name;if(p.params.badgeRender)c=p.params.badgeRender.call(p,a);else{var u=(c=g(y)).find(".badge-text");p.params.itemUseHtml?u.append(M(g(d))):u.text(d),u.attr("title",d)}c.addClass(x+" "+p.params.badgeCls).click(function(e){z(e)}),c.find(".badge-close").click(function(e){p.isReadonly()||(c.remove(),p.removeSelected(a),p.selectedItems.length<=0&&p.input.blur(),p.close(),p.placeholder.refresh(),z(e))}),c.find(".badge-text")[p.params.dblclick4Edit?"dblclick":"click"](function(e){if(!p.isReadonly()){c.after(p.input.el).remove(),p.removeSelected(a);var t=p.isInSearchMode("name")?a.n||a.name:a.c||a.code;p.params.getText4BadgeEdit&&(t=p.params.getText4BadgeEdit.call(p,a,t)),p.editingItem={item:a,text:t},p.close(),p.input.updateTextValue(t),z(e)}});var f=!1;p.params.filtSame&&0<p.selectedItems.length?0<=p.findSelectedItem(a)||(f=!0):f=!0;return f&&(p.isSingleMode()&&p.el.children("."+x).remove(),p.input.el.before(c),p.addSelected(a,!t),m.resize(c),p.isSingleMode()&&p.input.updateTextValue(d,!1),p.placeholder.refresh()),f},p.isSingleMode()&&p.el.addClass("single-badge")},d=function(s){var e,o=this,c=o.el=g(a).appendTo(s.el),t=c.children(".input-delegate-sizer"),d=c.children(":text").on({focus:function(e){if(s.isReadonly())return d.blur(),void z(e);o.isFocused=!0,o.updateSizer(),s.placeholder.el.hide(),s.el.addClass("focus"),(s.params.minChar<=0||d.val().length>=s.params.minChar)&&s.openOnFocus(),s.isSingleMode()&&0<s.getValue().length&&(i(d[0]),s.editingItem={item:s.getValue()[0],text:d.val()}),s.fireOnFocus()},blur:function(){o.isFocused=!1,s.el.removeClass("focus"),(d.val()&&!o.beforeMoveVal||!d.val()&&s.isSingleMode())&&o.confirmValue(),s.placeholder.refresh(),s.close(),s.fireOnBlur()},keydown:function(e){if(!s.isReadonly()){o.updateSizer();var t=!1;switch(e.keyCode){case u:o.confirmValue(),z(e),t=!0;break;case b:o.confirmValue(!0),t=!0;break;case f:var a=!!d.val();o.confirmValue(),a&&!s.isSingleMode()&&(d.focus(),z(e)),t=!0;break;case p:case h:var n=function(e){var t=0;if(document.selection){var a=document.selection.createRange();a.moveStart("character",0-e.value.length),t=a.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}(d[0]),i=d.val().length;e.keyCode==p&&0==n?(o.moveToLR(!0),z(e)):e.keyCode==h&&n==i&&(o.moveToLR(!1),z(e)),t=!0;break;case m:case v:s.panel.moveSelect(e.keyCode==m),z(e),t=!0;break;case I:if(!d.val()){var l=c.prev("."+x);0<l.size()&&(s.badge.closeBadge(l),z(e),t=!0)}break;case S:if(!d.val()){var r=c.next("."+x);0<r.size()&&(s.badge.closeBadge(r),z(e),t=!0)}break;default:s.panel.relocate()}t||setTimeout(function(){if(d.val().length<s.params.minChar)return s.close(),void s.panel.el.empty();s.loadData().then(function(){s.open(),s.panel.render()})},s.params.inputSearchDelay)}},keyup:function(e){s.isReadonly()||o.updateSizer()}});o.moveToLR=function(e){if(!s.isSingleMode()){var t=e?c.prev("."+x+" "):c.next("."+x);t&&(o.beforeMoveVal=d.val(),e?t.before(c):t.after(c),d.val(o.beforeMoveVal),o.focus(),delete o.beforeMoveVal)}},o.moveToBadge=function(e){if(!s.isSingleMode())if(e)e.before(o.el);else{var t=s.badge.getLastBadge();t&&t.after(o.el)}},o.updateSizer=function(){t.text(d.val()+"WW")},o.updateTextValue=function(e,t){d.val(e),o.isFocused||!1===t||o.focus(),o.updateSizer(),i(d[0])},o.confirmValue=function(e){var t;e?s.editingItem&&(t=s.badge.add(s.editingItem.item)):t=s.badge.add(d.val()),s.isSingleMode()?(t||(0<s.selectedItems.length&&s.removeSelected(s.selectedItems[0]),d.val()&&o.clear()),s.close()):d.val()&&o.clear()},o.blur=function(){o.isFocused&&d.blur()},o.clear=function(e){d.val(""),!1===e?s.placeholder.refresh():d.blur(),t.text("W")},o.getSearchText=function(){return d.val()},o.focus=function(){o.isFocused||d.focus()},t.text("WW"),o.emptyWidth=(e=c).outerWidth()+V(e,"margin-left")+V(e,"margin-right"),t.text("W")},T=function(d){var i=this,u=i.el=g(e).appendTo(d.el);i.moveSelect=function(e){var t,a=u.children("li.selected");if(0<a.size()){if((t=e?a.prev():a.next()).size()<=0){var n=u.children();t=g(e?n[n.size()-1]:n[0])}}else 0<(n=u.children()).size()&&(t=g(e?n[n.size()-1]:n[0]));0<t.length&&(a.removeClass("selected"),t.addClass("selected"),i.scrollToSelected(t))},i.scrollToSelected=function(e){if(0<(e=e||u.children("li.selected")).size()){var t=u.scrollTop(),a=e.position().top+t;a-=(u.height()-e.height())/2,u.scrollTop(a)}},i.getSelectedItem=function(){return u.children("li.selected").data("bsAutoCompleteItem")},i.render=function(){var e=d.data||[],r=d.input.getSearchText();u.empty();var t=d.editingItem&&d.editingItem.item||{},s=t.c||t.code,o=t.n||t.name;if(0<e.length){var c=!1;g.each(e,function(e,t){var a,n=t.n||t.name,i=t.c||t.code;if(d.params.itemRender)d.params.itemRender.call(d,a,t,r);else{var l=(a=g(C)).find(".text");d.params.itemUseHtml?l.append(M(g(n))):l.text(n)}a.addClass("bs-autocomplete-item").data("bsAutoCompleteItem",t).appendTo(u).mousedown(function(e){d.isReadonly()||(d.input.clear(),d.badge.add(t),z(e))}),!c&&r&&(d.editingItem&&d.editingItem.text==r&&s==i&&o==n&&(c=!0),d.isInSearchMode("name")&&r==n?c=!0:d.isInSearchMode("code")&&r==i&&(c=!0),c&&a.addClass("selected"))})}else d.close()},i.resize=function(){u.css("max-width",d.el.width())},i.relocate=function(){var e=d.input.el.position().left;d.isSingleMode()&&(e=0),u.css("left",e+"px")},i.close=function(){u.children().removeClass("selected")},i.destroy=function(){u.children().each(function(){g(this).removeData("bsAutoCompleteItem")}),u.remove()}},k=function(e,t){var u=this;for(var a in e=e||{},l)"undefined"==typeof e[a]&&(e[a]=l[a]);u.params=e,u.initialized=!1,u.selectedItems=[],u.readonly=!1;var n=function(e){if(u.el.hasClass("open")&&!g(e.target).hasClass("bootstrap-autocomplete")){var t=g(e.target).parents(".bootstrap-autocomplete");0==t.size()?u.close():t[0]!=u.el[0]&&u.close()}},i=function(e){setTimeout(function(){u.panel.resize()},100)};u.addValue=function(e,t,l){var r=u.getValue();if(t&&u.clearValue(!1),e){if(e instanceof Array){if(e.length<=0)return;var a=[];g.each(e,function(e,t){O(t)?a.push({c:t,n:t}):a.push(t)}),e=a}else e=O(e)?[{c:e,n:e}]:[e];if(u.params.forceSelect&&u.params.loadDataItems)u.loadDataItems(e).then(function(a){g.each(e,function(e,t){u.badge.add(t,a)}),l?u.fireOnInit():u.fireOnChange(r,u.getValue())},function(){l&&u.fireOnInit()});else{var s=u.data,o=u.params.forceSelect&&u.params.loadData,c=e.length,d=0;0<e.length&&!o&&(u.data=(u.params.data||[]).slice()),g.each(e,function(e,t){if(o)if(u.searchInData(t,s))u.badge.add(t);else{var a=t.c||t.code,n=t.n||t.name,i=u.isInSearchMode("code")?a:n;u.loadData(i,[]).then(function(e){s=e,u.badge.add(t,e)}).always(function(){++d==c&&(l?u.fireOnInit():u.fireOnChange(r,u.getValue()))})}else u.badge.add(t)}),o||(l?u.fireOnInit():u.fireOnChange(r,u.getValue()))}}else l?u.fireOnInit():u.fireOnChange(r,u.getValue())},u.setValue=function(e,t){u.addValue(e,!0,t)},u.openOnFocus=function(){u.loadData().then(function(){u.open(),u.panel.render()})},u.isInSearchMode=function(e){return 0<=u.params.searchMode.indexOf(e)},u.destroy=function(){u.panel.destroy(),g("html").off("click",n),g(window).off("resize",i),u.params.el.removeData("bsAutoComplete"),u.el.remove()},u.selectItem=function(e){},u.fireOnChange=function(e,t){u.params.el.trigger("bs.autocomplete.change",[e,t])},u.fireOnSelect=function(e,t){u.params.el.trigger("bs.autocomplete.select",[e,t])},u.fireOnInit=function(){u.params.el.trigger("bs.autocomplete.init")},u.fireOnFocus=function(){u.params.el.trigger("bs.autocomplete.focus")},u.fireOnBlur=function(){u.params.el.trigger("bs.autocomplete.blur")},u.fireOnDeSelect=function(e,t){u.params.el.trigger("bs.autocomplete.deselect",[e,t])},u.isSingleMode=function(){return!u.params.multiple},u.close=function(){u.el.removeClass("open"),u.panel.close()},u.open=function(){u.readonly||(u.panel.resize(),u.panel.relocate(),u.el.addClass("open"))},u.getValue=function(){return u.selectedItems.slice()},u.clearValue=function(e){if(!u.isReadonly()){u.isSingleMode()&&u.input.clear(e);var t=u.getValue();u.selectedItems.splice(0,u.selectedItems.length),u.el.children("."+x).remove(),u.el.removeClass("selected"),u.placeholder.refresh(),!1!==e&&(u.params.el.trigger("bs.autocomplete.clear"),u.fireOnChange(t,u.getValue()))}},u.setReadonly=function(e){e=!1!==e,(u.readonly=e)?u.el.addClass("readonly"):u.el.removeClass("readonly")},u.isReadonly=function(){return u.readonly},u.addSelected=function(e,t){var a=u.selectedItems.slice();u.isSingleMode()&&u.selectedItems.splice(0,u.selectedItems.length),u.selectedItems.push(e),0<u.selectedItems.length&&u.el.addClass("selected"),!1!==t&&(u.fireOnSelect(e,u.getValue()),u.fireOnChange(a,u.getValue()))},u.removeSelected=function(e){var t=u.findSelectedItem(e);if(0<=t){var a=u.selectedItems.slice();u.selectedItems.splice(t,1),u.selectedItems.length<=0&&u.el.removeClass("selected"),u.fireOnDeSelect(e,u.getValue()),u.fireOnChange(a,u.getValue())}},u.isItemMatched=function(e,t){var a=new RegExp(function(e){if("string"!=typeof e)return e;return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}(e),u.params.ignoreCase?"i":undefined),n=!1;return u.isInSearchMode("name")&&(n=a.test(t.n||t.name)),!n&&u.isInSearchMode("code")&&(n=a.test(t.c||t.code)),n},u.findSelectedItem=function(e){var i=-1,l=e.c||e.code,r=e.n||e.name;return g.each(u.selectedItems,function(e,t){var a=t.c||t.code,n=t.n||t.name;if(a==l&&n==r)return i=e,!1}),i},u.searchInData=function(e,t){var i=O(e);i&&(e={c:e,n:e});var l,r=e.c||e.code,s=e.n||e.name;t=t||u.data;return g.each(t,function(e,t){var a=t.c||t.code,n=t.n||t.name;if(i){if(u.isInSearchMode("name")&&n==s||u.isInSearchMode("code")&&a==r)return l=t,!1}else if(n==s&&a==r)return l=t,!1}),l},u.loadDataItems=function(e){var t=g.Deferred(),a=[];return u.params.loadDataItems.call(u,e,function(e){e?(g.each(e,function(e,t){O(t)&&(t={c:t,n:t}),a.push(t)}),t.resolve(a)):t.reject()}),t.promise()},u.loadData=function(a,n){a=a||u.input.getSearchText();var t=g.Deferred();if((n=n||u.data).splice(0,n.length),u.params.loadData)u.params.loadData.call(u,a,function(e){e?(g.each(e,function(e,t){O(t)&&(t={c:t,n:t}),n.push(t)}),t.resolve(n)):t.reject()});else{var e=u.params.data||[];g.each(e,function(e,t){O(t)&&(t={c:t,n:t}),a&&!u.isItemMatched(a,t)||n.push(t)}),t.resolve(n)}return t.promise()},u.data=[],u.el=g(r).addClass(u.params.cls),!1!==u.params.fitWdith&&u.el.addClass("fit-width"),u.params.dropUp&&u.el.addClass("dropup"),u.params.replace?(u.el.insertAfter(e.el),e.el.hide()):u.el.appendTo(e.el),u.input=new d(u),u.panel=new T(u),u.badge=new c(u),u.placeholder=new o(u),u.params.data&&(g.each(u.params.data,function(e,t){O(t)?u.data.push({c:t,n:t}):u.data.push(t)}),u.params.data=u.data.slice()),g(s).appendTo(u.el).click(function(e){u.isReadonly()||(u.clearValue(),z(e))}),u.params.readonly&&u.setReadonly(!0),u.el.on({mousedown:function(e){if(!u.isReadonly()&&e.target==u.el[0]){var t=u.badge.getCloestBadge(e.offsetX,e.offsetY);u.input.moveToBadge(t),u.input.isFocused&&z(e)}},click:function(e){u.isReadonly()||u.input.focus()}}),t.data("bsAutoComplete",this),u.params.value?u.setValue(u.params.value,!0):u.fireOnInit(),g("html").on("click",n),g(window).on("resize",i)};g.fn.bsAutoComplete=function(a){var n=arguments;return this.each(function(){if(this){var e=g(this),t=e.data("bsAutoComplete");t||(a=g.extend({el:e,value:e.val()?e.val().split(a.splitChar||" "):""},a),t=new k(a,e)),O(a)&&t[a].apply(t,Array.prototype.slice.call(n,1))}})}}(jQuery);
//# sourceMappingURL=bootstrap-autocomplete.min.js.map
