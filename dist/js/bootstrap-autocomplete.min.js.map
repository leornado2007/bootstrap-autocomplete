{"version":3,"sources":["js/bootstrap-autocomplete.js"],"names":["$","DEF_OPTS","cls","placeHolder","emptyListTip","searchMode","ignoreCase","fitWdith","dropUp","filtSame","badgeCls","dblclick4Edit","inputSearchDelay","forceSelect","minChar","multiple","mode","selectAllBtnTxt","revselectBtnTxt","hideBadge","disableSelectedItemsInfoDragAnmiate","debounceFn","delay","fn","atBegin","debounce","mockDebounceTimeout","lastTimeoutId","now","Date","getTime","clearTimeout","setTimeout","isIE","navigator","userAgent","indexOf","KEY_CODES","TPLS","inputDelegateContainerTpl","containerTpl","inputTpl","dropdownTpl","dropdownTopBarTpl","placeholderTpl","clearBtnTpl","emptyDropDownItemTpl","dropdownItemTpl","badgeTpl","CLS","MODE","selectOption","getCssNum","el","css","Number","replace","ohtml","e","append","html","setCaretPosition","oField","document","selection","createRange","moveStart","value","length","selectionStart","stopEvent","preventDefault","stopPropagation","isString","val","PlaceHolder","ac","placeholderEl","this","params","tpls","prependTo","text","refresh","selectedItems","hide","show","Badge","badge","on","badgeEl","currentTarget","closest","closeBadge","closePanel","isSelectOptionMode","isReadonly","item","data","after","input","remove","removeSelected","isInSearchMode","n","name","c","code","getText4BadgeEdit","call","editingItem","close","updateTextValue","resize","closeEl","find","badgeMarginL","badgeMarginR","maxWidth","padL","padR","innerWidth","emptyWidth","outerWidth","children","each","findSelectedBadgeEl","foundBadgeEl","itemName","itemCode","badgeItem","badgeItemName","badgeItemCode","opts","isOpen","itemEl","panel","findItemEl","removeClass","blur","placeholder","fireBadgeRemoved","getLastBadge","badges","size","getClosestBadge","mouseX","mouseY","closestBadgeEl","isLineMatched","pos","position","left","top","bottom","outerHeight","addBadge","speicalData","ei","eiCode","eiName","valCode","valName","searchInData","optGroup","customNameHtml","hn","htmlName","badgeRender","itemUseHtml","attr","addClass","doAdd","isSingleMode","findSelectedItem","before","addSelected","fire","SelectedItemsInfo","startX","startScrollLeft","maxScrollLeft","startDragTime","selectedItemsInfoEl","selectedItemsTextEl","startDrag","isDragging","lastDragStopTime","dragAnimateInterval","stopDragAnimate","clearInterval","mouseupFn","timeDelta","animateScrollLeft","scrollLeft","stopX","pageX","xDelta","Math","abs","direction","speed","animateStartTime","pw","cw","setInterval","t","s","log","undefined","mousemoveFn","newScrollLeft","mousemove","mouseup","mousedown","mousewheel","delta","originalEvent","wheelDelta","detail","floor","destroy","off","isStopDragLately","refreshItems","itemNames","i","push","join","maxW","width","Input","loadTimeout","compositionFlag","inputCt","appendTo","inputSizer","inputEl","loadDataOnInput","destoried","empty","loadData","from","then","isFocused","open","render","focus","updateSizer","isHideBadge","openOnFocus","getValue","fireOnFocus","preventBlur","relatedTarget","beforeMoveVal","confirmValue","fromBlur","fireOnBlur","keydown","specialKey","keyCode","getSelectedItemEl","isSelected","hasVal","caretPos","oSel","getCaretPosition","textLen","moveToLR","moveSelect","prevBadge","prev","nextBadge","next","relocate","keyup","compositionstart","compositionend","isLeft","moveToBadge","lastBadge","isEsc","added","clear","fireBlur","getSearchText","DropdownPanelMenubar","menuBarEl","$itemEl","DropdownPanel","menuBar","panelEl","emptyItemEl","scrollTop","innerHeight","scrollHeight","foundItemEl","checkedItemEls","boundItem","boundItemName","boundItemCode","isUp","moveToItem","selItem","itemCls","skipMultiSel","hideOtherSelected4Multiple","hasClass","items","scrollToSelected","selectedItem","height","searchText","hasOptGroup","lastGroupEl","matched","isMultiMode","lastGroupChildCount","selectableItemCount","toLowerCase","selectable","itemRender","selectedItemMap","fireOnPanelResize","inputPosLeft","removeData","AutoComplete","originEl","def","extend","initialized","readonly","htmlOverHandler","resized4htmlOver","is","htmlClickHandler","target","autocomplete","parents","htmlResizeHandler","elOverHandler","resized4elOver","addValue","onSetFinish","noop","changeFired","oldSelectedItems","clearValue","fireInit","fireOnInit","fireOnChange","Array","formatedItems","loadDataItems","tmpData","specialData","always","lastSearchData","needCheckRemote","toCheckCount","checkedItemCount","slice","showAllItemsWhenFirstFocus","setValue","showAllWhenSingleForceSelectFocus","click","mouseover","window","selectedItemsInfo","oldItems","newItems","allItemsSame","oldItem","oldItemCode","oldItemName","newItem","newItemCode","newItemName","disableResizeContainer","resizeContainer","containerEl","trigger","fireOnSelect","fireOnClose","inputGroupEl","isInitialized","fireOnPen","fireOnDeSelect","closeTime","clearData","splice","setReadonly","findIndex","isItemMatched","regex","RegExp","str","escapeRegex","test","result","selCode","selName","isFromStr","findItem","dataItem","dataCode","dataName","defered","Deferred","loadedItems","resolve","reject","promise","loadDataSeq","loadSeq","_loadSeq","nLoadSeq","isNaN","lastGroupItem","inputDelegateCtEl","isUnderInputGroup","isOriginInputEl","parent","insertAfter","bsAcCtEl","resizeHeightCls","offsetX","offsetY","bsAutoComplete","args","arguments","$this","split","splitChar","apply","prototype","jQuery"],"mappings":"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","file":"bootstrap-autocomplete.min.js","sourcesContent":["(function ($) {\n  'use strict';\n\n  // DEF_OPTS\n  var DEF_OPTS = {\n    cls                                : '',\n    placeHolder                        : '请选择',\n    emptyListTip                       : '未找到匹配的数据项',\n    searchMode                         : 'code name',\n    ignoreCase                         : true,\n    fitWdith                           : true,\n    dropUp                             : false,\n    filtSame                           : false,\n    badgeCls                           : '',\n    dblclick4Edit                      : false,\n    inputSearchDelay                   : 200,\n    forceSelect                        : false,\n    minChar                            : 1,\n    multiple                           : true,\n    mode                               : '',\n    selectAllBtnTxt                    : '全选',\n    revselectBtnTxt                    : '反选',\n    hideBadge                          : false,\n    disableSelectedItemsInfoDragAnmiate: false,\n    debounceFn                         : function (delay, fn, atBegin) {\n      if ($.debounce) return $.debounce(delay, atBegin, fn);\n      else {\n        var mockDebounceTimeout = -1, lastTimeoutId = -1;\n        return function () {\n          var now = +new Date().getTime();\n          if (mockDebounceTimeout < 0 || (now - mockDebounceTimeout) > delay) {\n            mockDebounceTimeout = now;\n\n            if (lastTimeoutId > 0) {\n              clearTimeout(lastTimeoutId);\n              lastTimeoutId = -1;\n            }\n\n            lastTimeoutId = setTimeout(function () {\n              lastTimeoutId = -1;\n              mockDebounceTimeout = -1;\n              fn();\n            }, delay);\n          }\n        }\n      }\n    }\n  };\n\n  var isIE = navigator.userAgent.indexOf('Trident') > -1;\n\n  // KEY_CODES\n  var KEY_CODES = {\n    ENTER: 13, TAB: 9, LEFT: 37, UP: 38, RIGHT: 39, DOWN: 40, ESC: 27, BACK: 8, DELETE: 46\n  };\n\n  // TPLS\n  var TPLS = {\n    inputDelegateContainerTpl: '<div class=\"input-delegate-ct\"></div>',\n    containerTpl             : '<div class=\"btn-group bootstrap-autocomplete form-control\">\\\n        <div class=\"selected-items-info\"><div class=\"selected-items-text\"></div></div>\\\n      </div>',\n    inputTpl                 : '<div class=\"delegate-input\">\\\n        <input type=\"text\" class=\"input-delegate\">\\\n        <span class=\"input-delegate-sizer\">W</span>\\\n      </div>',\n    dropdownTpl              : '<ul class=\"dropdown-menu bs-autocomplete-menu\"></ul>',\n    dropdownTopBarTpl        : '<div class=\"bs-autocomplete-menu-bar\"><a class=\"btn btn-default selrev-btn\">反选</a><a class=\"btn btn-default selall-btn\">全选</a></div>',\n    placeholderTpl           : '<div class=\"bs-autocomplete-placeholder\"></div>',\n    clearBtnTpl              : '<span class=\"bsautocomplete-icon-cross bsautocomplete-font icon-jiaochacross78\"></span>',\n    emptyDropDownItemTpl     : '<li class=\"bs-autocomplete-empty-item\"></li>',\n    dropdownItemTpl          : '<li>\\\n        <a href=\"javascript:\">\\\n          <span class=\"text\"></span>\\\n          <span class=\"item-status-icon glyphicon glyphicon-ok\"></span>\\\n        </a>\\\n      </li>',\n    badgeTpl                 : '<span class=\"label label-primary\">\\\n        <a href=\"javascript:\" class=\"badge-text\"></a>\\\n        <a href=\"javascript:\" class=\"badge-close\">x</a>\\\n      </span>'\n  };\n\n  // CLS\n  var CLS = {\n    badgeCt           : 'bs-autocomplete-badge',\n    badgeHide         : 'bs-autocomplete-badge-hide',\n    dropdownItem      : 'bs-autocomplete-item', // 分组optGroup === true项不会添加这个样式\n    multiSelected     : 'multiple-selected',\n    multiHideSel      : 'multiple-hide-selected',\n    itemSelected      : 'selected', // 进作为光标移动当前菜单项高亮用，不作为已选中项样式\n    itemChecked       : 'item-checked', // 已选中菜单项样式\n    clearBtnClass     : 'bs-autocomplete-clear-btn',\n    inputClearBtnClass: 'bs-autocomplete-input-clear-btn',\n    hasInputVal       : 'has-input-val',\n    emptyList         : 'empty-list',\n    modePrefix        : 'bs-autocomplete-mode-',\n    selectedItemsGrab : 'items-text-grabbing'\n  };\n\n  var MODE = {\n    selectOption: 'selectOption',\n  };\n\n  // escapeRegex\n  var escapeRegex = function (str) {\n    if (typeof str !== 'string') return str;\n    var matchOperatorsRe = /[|\\\\{}()[\\]^$+*?.]/g;\n    return str.replace(matchOperatorsRe, '\\\\$&');\n  };\n\n  // getInnerSize\n  var getInnerWidth = function (el) {\n    var padL = getCssNum(el, 'padding-left'), padR = getCssNum(el, 'padding-right');\n    return el.innerWidth() - padL - padR;\n  };\n\n  // getOuterWidth\n  var getOuterWidth = function (el) {\n    return el.outerWidth() + getCssNum(el, 'margin-left') + getCssNum(el, 'margin-right');\n  };\n\n  // getCaretPosition\n  var getCaretPosition = function (oField) {\n    var caretPos = 0;\n    if (document.selection) {// IE\n      var oSel = document.selection.createRange();\n      oSel.moveStart(\"character\", 0 - oField.value.length);\n      caretPos = oSel.text.length;\n    } else if (oField.selectionStart || oField.selectionStart == \"0\") { // Firefox\n      caretPos = oField.selectionStart;\n    }\n    return caretPos;\n  };\n\n  // getCssNum\n  var getCssNum = function (el, css) {\n    return Number(el.css(css).replace('px', ''));\n  };\n\n  // getOuterHtml\n  var ohtml = function (e) {\n    return $('<div></div>').append(e).html();\n  };\n\n  // setCaretPosition\n  var setCaretPosition = function (oField) {\n    if (document.selection) {// IE\n      var oSel = document.selection.createRange();\n      oSel.moveStart(\"character\", oField.value.length);\n    } else { // Firefox\n      oField.selectionStart = oField.value.length;\n    }\n  };\n\n  // stopEvent\n  var stopEvent = function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  // isString\n  var isString = function (val) {\n    return typeof val === typeof '';\n  };\n\n  // PlaceHolder\n  var PlaceHolder = function (ac) {\n    var placeholder = this, placeholderEl = placeholder.el = $(ac.params.tpls.placeholderTpl).prependTo(ac.el);\n    placeholderEl.text(ac.params.placeHolder);\n\n    placeholder.refresh = function () {\n      if (ac.selectedItems.length > 0) placeholderEl.hide();\n      else placeholderEl.show();\n    };\n  };\n\n  // Badge\n  var Badge = function (ac) {\n    var badge = this;\n\n    // 从父元素一次性注册事件，提高性能\n    $(ac.el)\n      .on('click', '.' + CLS.badgeCt, function (e) {\n        stopEvent(e);\n      })\n\n      // close handler\n      .on('click', '.badge-close', function (e) {\n        var badgeEl = $(e.currentTarget).closest('.' + CLS.badgeCt);\n        badge.closeBadge(badgeEl, {closePanel: !ac.isSelectOptionMode()});\n        stopEvent(e);\n      })\n\n      // text handler\n      .on(ac.params.dblclick4Edit ? 'dblclick' : 'click', '.badge-text', function (e) {\n          if (ac.isReadonly()) return;\n\n          var badgeEl = $(e.currentTarget).closest('.' + CLS.badgeCt);\n          var item = badgeEl.data('bsAutoCompleteItem');\n          if (!item) return;\n\n          badgeEl.after(ac.input.el).remove();\n          ac.removeSelected(item);\n\n          var text = ac.isInSearchMode('name') ? item.n || item.name : item.c || item.code;\n          if (ac.params.getText4BadgeEdit) text = ac.params.getText4BadgeEdit.call(ac, item, text);\n          ac.editingItem = {item: item, text: text};\n          ac.close();\n          ac.input.updateTextValue(text);\n          stopEvent(e);\n        }\n      );\n\n    // resize\n    badge.resize = function (el) {\n      if (el) {\n        var closeEl = el.find('.badge-close');\n        var badgeMarginL = getCssNum(el, 'margin-left'), badgeMarginR = getCssNum(el, 'margin-right');\n        var maxWidth = getInnerWidth(ac.el) - ac.input.emptyWidth - badgeMarginL - badgeMarginR - closeEl.outerWidth() - 2;\n        el.find('.badge-text').css('max-width', maxWidth + 'px');\n      } else {\n        ac.el.children('.' + CLS.badgeCt).each(function () {\n          badge.resize($(this));\n        });\n      }\n    };\n\n    // findSelectedBadgeEl\n    badge.findSelectedBadgeEl = function (item) {\n      if (!item) return;\n\n      var foundBadgeEl, codeMatched, nameMatched;\n      var itemName = item.n || item.name, itemCode = item.c || item.code;\n\n      // var editingItem = ac.editingItem && ac.editingItem.item;\n      // if (editingItem === item)\n      // if (!!editingItem) {\n      //   var badgeItemName = editingItem.n || editingItem.name,\n      //     badgeItemCode = editingItem.c || editingItem.code;\n      //\n      // }\n\n      ac.el.children('.' + CLS.badgeCt).each(function () {\n        var badgeEl = $(this);\n        var badgeItem = badgeEl.data('bsAutoCompleteItem');\n        if (!badgeItem) return;\n\n        var badgeItemName = badgeItem.n || badgeItem.name, badgeItemCode = badgeItem.c || badgeItem.code;\n        var isCodeMatch = badgeItemCode === itemCode, isNameMatch = badgeItemName === itemName;\n        if (badgeItem === item) {\n          foundBadgeEl = badgeEl;\n          return false;\n        } else if (isCodeMatch && isNameMatch) {\n          codeMatched = nameMatched = true;\n          foundBadgeEl = badgeEl;\n        }\n      });\n\n      return foundBadgeEl;\n    };\n\n    // closeBadge\n    badge.closeBadge = function (badgeEl, opts) {\n      opts = opts || {};\n\n      if (ac.isReadonly()) return;\n      var item = badgeEl.data('bsAutoCompleteItem');\n      badgeEl.remove();\n      ac.removeSelected(item);\n\n      if (ac.isOpen()) {\n        var itemEl = opts.itemEl || ac.panel.findItemEl(item);\n        if (itemEl) itemEl.removeClass(CLS.itemChecked);\n\n        if (opts.closePanel !== false) {\n          if (ac.selectedItems.length <= 0) ac.input.blur();\n          ac.close();\n        }\n      }\n\n      ac.placeholder.refresh();\n      ac.fireBadgeRemoved();\n    };\n\n    // getLastBadge\n    badge.getLastBadge = function () {\n      var badges = ac.el.children('.' + CLS.badgeCt);\n      if (badges.size() > 0) return $(badges[badges.size() - 1]);\n    };\n\n    // getClosestBadge\n    badge.getClosestBadge = function (mouseX, mouseY) {\n      var closestBadgeEl, isLineMatched;\n      ac.el.children('.' + CLS.badgeCt).each(function () {\n        var badgeEl = $(this), pos = badgeEl.position();\n        var left = pos.left, top = pos.top, bottom = top + badgeEl.outerHeight(),\n          right = pos.left + badgeEl.outerWidth();\n        if (mouseY >= top && mouseY <= bottom) {\n          isLineMatched = true;\n          if (mouseX <= left) {\n            closestBadgeEl = badgeEl;\n            return false;\n          }\n        } else if (isLineMatched) {// matched last line last badge\n          closestBadgeEl = badgeEl;\n          return false;\n        }\n      });\n      return closestBadgeEl;\n    };\n\n    // addBadge\n    badge.addBadge = function (val, opts) {\n      opts = opts || {};\n      var speicalData = opts.speicalData;\n      var item;\n\n      /*if (!isString(val) && item && item !== val) {\n        var valCode = val.c || val.code, valName = val.n || val.name;\n        var itemCode = item.c || item.code, itemName = item.n || item.name;\n        if (valCode !== itemCode || valName !== itemName) item = val;\n      }*/\n\n      if (!val) {\n        delete ac.editingItem;\n        return;\n      }\n\n      if (ac.editingItem) {\n        if (val === ac.editingItem.item) item = val;\n        else if (isString(val)) {\n          if (ac.editingItem.text === val) item = ac.editingItem.item;\n        } else {\n          var ei = ac.editingItem.item, eiCode = ei.c || ei.code, eiName = ei.n || ei.name;\n          var valCode = val.c || val.code, valName = val.n || val.name;\n          if (valCode === eiCode && valName === eiName) item = val;\n        }\n      }\n\n      if (!item) {\n        if (isString(val)) {\n          item = ac.searchInData(val, speicalData);\n          if (!item && !ac.params.forceSelect) item = {c: val, n: val};\n        } else if (ac.params.forceSelect) {\n          item = ac.searchInData(val, speicalData);\n        } else {\n          item = val;\n        }\n      }\n\n      if (!item) {\n        delete ac.editingItem;\n        return;\n      }\n\n      delete ac.editingItem;\n\n      if (item.optGroup === true) return false;\n\n      var badgeEl, itemName = item.n || item.name, customNameHtml = item.hn || item.htmlName;\n      if (ac.params.badgeRender) badgeEl = ac.params.badgeRender.call(ac, item);\n      else {\n        badgeEl = $(ac.params.tpls.badgeTpl);\n        var text = badgeEl.find('.badge-text');\n        if (ac.params.itemUseHtml) text.append(ohtml($(customNameHtml || itemName)));\n        else text.text(itemName);\n        text.attr('title', itemName);\n      }\n\n      badgeEl\n        .data('bsAutoCompleteItem', item)\n        .addClass(CLS.badgeCt + ' ' + ac.params.badgeCls);\n\n      var doAdd = false;\n      if (ac.params.filtSame && ac.selectedItems.length > 0 && !ac.isSingleMode()) {\n        var hasSame = ac.findSelectedItem(item) >= 0;\n        if (hasSame) return true;\n        else doAdd = true;\n      } else doAdd = true;\n\n      if (doAdd) {\n        if (ac.isSingleMode()) ac.el.children('.' + CLS.badgeCt).remove();\n        ac.input.el.before(badgeEl);\n        ac.addSelected(item, {fire: !speicalData, itemEl: opts.itemEl});\n        badge.resize(badgeEl);\n        if (ac.isSingleMode()) ac.input.updateTextValue(itemName, false);\n        ac.placeholder.refresh();\n      }\n      return doAdd;\n    };\n\n    if (ac.isSingleMode()) ac.el.addClass('single-badge');\n  };\n\n  // SelectedItemsInfo\n  var SelectedItemsInfo = function (ac) {\n    var selectedItemsInfo = this;\n\n    var selectedItemsInfoEl = ac.el.children('.selected-items-info');\n    var selectedItemsTextEl = selectedItemsInfoEl.children('.selected-items-text');\n\n    // TODO\n    var startDrag = false, isDragging = false;\n    var startX, startScrollLeft, maxScrollLeft, startDragTime;\n    var lastDragStopTime = -1;\n    var dragAnimateInterval = -1;\n\n    var stopDragAnimate = function () {\n      if (dragAnimateInterval >= 0) clearInterval(dragAnimateInterval);\n      dragAnimateInterval = -1;\n    };\n\n    var mouseupFn = function (e) {\n      startDrag = false;\n      if (!isDragging) return;\n\n      lastDragStopTime = new Date().getTime();\n      var timeDelta = new Date().getTime() - startDragTime;\n      if (timeDelta < 200 && timeDelta > 0 && ac.params.disableSelectedItemsInfoDragAnmiate !== true) {\n        var animateScrollLeft = selectedItemsInfoEl.scrollLeft();\n        var stopX = e.pageX, xDelta = Math.abs(stopX - startX);\n        var direction = stopX < startX ? 1 : -1;\n        var speed = 10 * xDelta / (timeDelta / 1000); // 加速度\n        var animateStartTime = lastDragStopTime;\n        var pw = selectedItemsInfoEl.innerWidth(), cw = selectedItemsTextEl.outerWidth();\n\n        dragAnimateInterval = setInterval(function () {\n          if (speed < 1)\n            return stopDragAnimate();\n\n          var now = new Date().getTime();\n          var t = (now - animateStartTime) / 1000;\n          var s = 1 / 2 * speed * t * t; // s = (1/2)at²\n          speed *= -Math.log(t + 1) + 1; // 递减加速度 y=-log(x+1)+1\n          animateScrollLeft += s * direction;\n\n          selectedItemsInfoEl.scrollLeft(animateScrollLeft);\n\n          if (animateScrollLeft <= 0 || cw > pw && animateScrollLeft >= cw - pw)\n            return stopDragAnimate();\n        }, 100);\n      }\n\n      isDragging = false;\n      startX = startScrollLeft = startDragTime = undefined;\n      selectedItemsInfoEl.removeClass(CLS.selectedItemsGrab);\n      stopEvent(e);\n    };\n\n    var mousemoveFn = function (e) {\n      if (!startDrag) return;\n\n      var xDelta = e.pageX - startX;\n      if (Math.abs(xDelta) > 30) {\n        isDragging = true;\n        selectedItemsInfoEl.addClass(CLS.selectedItemsGrab);\n      }\n      if (!isDragging) return;\n\n      var newScrollLeft = startScrollLeft - xDelta;\n      if (newScrollLeft <= 0) newScrollLeft = 0;\n      else if (newScrollLeft >= maxScrollLeft) newScrollLeft = maxScrollLeft;\n      selectedItemsInfoEl.scrollLeft(newScrollLeft);\n      stopEvent(e);\n    };\n\n    $(document).on({\n      mousemove: mousemoveFn,\n      mouseup  : mouseupFn\n    });\n\n    selectedItemsTextEl.on({\n      mousedown : function (e) {\n        var pw = selectedItemsInfoEl.innerWidth(), cw = selectedItemsTextEl.outerWidth();\n        stopDragAnimate();\n\n        if (!startDrag && cw > pw) {\n          startDrag = true;\n          maxScrollLeft = cw - pw;\n          startX = e.pageX;\n          startScrollLeft = selectedItemsInfoEl.scrollLeft();\n          startDragTime = new Date().getTime();\n        }\n      },\n      mousewheel: function (e) {\n        stopEvent(e);\n\n        var pw = selectedItemsInfoEl.innerWidth(), cw = selectedItemsTextEl.outerWidth();\n        var scrollLeft = selectedItemsInfoEl.scrollLeft();\n        var delta = (e.originalEvent.wheelDelta && e.originalEvent.wheelDelta ||\n          e.originalEvent.detail && e.originalEvent.detail) > 0 ? -1 : 1;\n        var newScrollLeft = scrollLeft + Math.floor(delta * pw * 0.8);\n\n        if (newScrollLeft <= 0) newScrollLeft = 0;\n        else if (cw > pw && newScrollLeft >= cw - pw) newScrollLeft = cw - pw;\n\n        selectedItemsInfoEl.scrollLeft(newScrollLeft);\n      },\n    });\n\n    selectedItemsInfo.destroy = function () {\n      $(document).off({\n        mousemove: mousemoveFn,\n        mouseup  : mouseupFn\n      });\n    }\n\n    selectedItemsInfo.isStopDragLately = function () {\n      return new Date().getTime() - lastDragStopTime <= 100;\n    };\n\n    selectedItemsInfo.refreshItems = function () {\n      var selectedItems = ac.selectedItems || [];\n      var itemNames = [];\n      $.each(selectedItems, function (i, item) {\n        itemNames.push(item.n || item.name);\n      });\n\n      var text = itemNames.join(',');\n      var maxW = ac.el.width() - 5;\n      if (maxW > 0) selectedItemsInfoEl.css('max-width', maxW);\n      selectedItemsTextEl.text(text).attr('title', text);\n      ac.placeholder.refresh();\n    };\n\n  }\n\n  // Input\n  var Input = function (ac) {\n    var input = this, inputCt = input.el = $(ac.params.tpls.inputTpl).appendTo(ac.el);\n    var inputSizer = inputCt.children('.input-delegate-sizer');\n\n    var loadTimeout, compositionFlag;\n    var inputEl = inputCt.children(':text');\n\n    var loadDataOnInput = ac.params.debounceFn(ac.params.inputSearchDelay, function () {\n      if (ac.destoried) return;\n\n      if (inputEl.val().length < ac.params.minChar) {\n        ac.close();\n        ac.panel.el.empty();\n        return;\n      }\n\n      ac.loadData({from: 'keydown'}).then(function () {\n        if (!ac.input.isFocused) return;\n        ac.open();\n        ac.panel.render();\n      });\n    }, true);\n\n    inputEl.on({\n      'focus'           : function (e) {\n        if (ac.isReadonly()) {\n          inputEl.blur();\n          stopEvent(e);\n          return;\n        }\n\n        input.isFocused = true;\n        input.updateSizer();\n        if (!ac.isHideBadge()) ac.placeholder.el.hide();\n        ac.el.addClass('focus');\n        if (ac.params.minChar <= 0 || inputEl.val().length >= ac.params.minChar) ac.openOnFocus();\n        if (ac.isSingleMode() && ac.getValue().length > 0) {\n          setCaretPosition(inputEl[0]);\n          ac.editingItem = {item: ac.getValue()[0], text: inputEl.val()};\n        }\n        ac.fireOnFocus();\n      },\n      'blur'            : function (e) {\n        if (!input.isFocused) return;\n        input.isFocused = false;\n        ac.el.removeClass('focus');\n\n        var preventBlur = false;\n        if (ac.isSelectOptionMode()) { // 下拉框模式，阻止点击关闭badge时失去焦点\n          var relatedTarget = e.relatedTarget;\n          if (relatedTarget) {\n            var blurByCloseBadgeEl = $(relatedTarget).closest('.badge-close');\n            if (blurByCloseBadgeEl.length > 0)\n              preventBlur = true;\n          }\n        }\n\n        if (!preventBlur && inputEl.val() && !input.beforeMoveVal || !inputEl.val() && ac.isSingleMode())\n          input.confirmValue(false, {fromBlur: true});\n        ac.placeholder.refresh();\n\n        if (!preventBlur) {\n          ac.close();\n          ac.fireOnBlur();\n        }\n      },\n      'keydown'         : function (e) {\n        if (ac.isReadonly()) return;\n\n        input.updateSizer();\n\n        var specialKey = false;\n        switch (e.keyCode) {\n          case KEY_CODES.ENTER:\n            // 防止用户输入自定义字符串后回车，此时自定义字符串的字典加载请求还在debounce或者异步请求中\n            // 回车操作后应该关闭组件面板，但因为上述异步行为可能导致面板再次展示出来\n            if (loadTimeout) {\n              clearTimeout(loadTimeout);\n              loadTimeout = undefined;\n            }\n\n            var itemEl = ac.panel.getSelectedItemEl();\n            var item = itemEl.data('bsAutoCompleteItem');\n\n            if (item) {\n              // var itemName = item.n || item.name, itemCode = item.c || item.code;\n              // if (ac.isInSearchMode('name') && itemName) inputEl.val(itemName);\n              // else if (itemCode) inputEl.val(itemCode);\n\n              var badgeEl = ac.isSelected(item) && ac.badge.findSelectedBadgeEl(item);\n              if (!!badgeEl) ac.badge.closeBadge(badgeEl, {closePanel: !ac.isSelectOptionMode(), itemEl: itemEl});\n              else ac.badge.addBadge(item, {itemEl: itemEl});\n            }\n\n            if (!ac.isSelectOptionMode()) input.blur();\n            else if (!item && inputEl.val() && !input.beforeMoveVal || !inputEl.val() && ac.isSingleMode()) {\n              input.confirmValue(false, {fromBlur: false});\n            }\n\n            stopEvent(e);\n            specialKey = true;\n            break;\n          case KEY_CODES.ESC:\n            input.confirmValue(true);\n            specialKey = true;\n            break;\n          case KEY_CODES.TAB:\n            var hasVal = !!inputEl.val();\n            input.confirmValue();\n            if (hasVal && !ac.isSingleMode()) {\n              inputEl.focus();\n              stopEvent(e);\n            }\n            specialKey = true;\n            break;\n          case KEY_CODES.LEFT:\n          case KEY_CODES.RIGHT:\n            var caretPos = getCaretPosition(inputEl[0]), textLen = inputEl.val().length;\n            if (e.keyCode === KEY_CODES.LEFT && caretPos === 0) {\n              input.moveToLR(true);\n              stopEvent(e);\n            } else if (e.keyCode === KEY_CODES.RIGHT && caretPos === textLen) {\n              input.moveToLR(false);\n              stopEvent(e);\n            }\n            specialKey = true;\n            break;\n          case KEY_CODES.UP:\n          case KEY_CODES.DOWN:\n            ac.panel.moveSelect(e.keyCode === KEY_CODES.UP);\n            stopEvent(e);\n            specialKey = true;\n            break;\n          case KEY_CODES.BACK:\n            if (!inputEl.val()) {\n              var prevBadge = inputCt.prev('.' + CLS.badgeCt);\n              if (prevBadge.size() > 0) {\n                ac.badge.closeBadge(prevBadge);\n                stopEvent(e);\n                specialKey = true;\n              }\n            }\n            break;\n          case KEY_CODES.DELETE:\n            if (!inputEl.val()) {\n              var nextBadge = inputCt.next('.' + CLS.badgeCt);\n              if (nextBadge.size() > 0) {\n                ac.badge.closeBadge(nextBadge);\n                stopEvent(e);\n                specialKey = true;\n              }\n            }\n            break;\n          default:\n            ac.panel.relocate();\n        }\n\n        if (!specialKey) {\n          if (loadTimeout) clearTimeout(loadTimeout);\n          loadTimeout = setTimeout(function () { // 由于是监听keydown事件，而最后实际输入的字符要keyup之后才能拿到，所以设置个延迟\n            loadTimeout = undefined;\n            if (!compositionFlag) loadDataOnInput();\n          }, 200);\n        }\n      },\n      'keyup'           : function (e) {\n        if (ac.isReadonly()) return;\n        input.updateSizer();\n        var text = inputEl.val();\n        if (!!text) inputCt.addClass(CLS.hasInputVal);\n        else inputCt.removeClass(CLS.hasInputVal);\n      },\n      'compositionstart': function () { // 输入法，录入开始\n        compositionFlag = true;\n      },\n      'compositionend'  : function () { // 输入法，输入结束\n        compositionFlag = false;\n        loadDataOnInput(); //在input之后执行 所以需要手动调用一次\n      },\n    });\n\n    // moveToLR\n    input.moveToLR = function (isLeft) {\n      if (ac.isSingleMode()) return;\n\n      var badge = isLeft ? inputCt.prev('.' + CLS.badgeCt + ' ') : inputCt.next('.' + CLS.badgeCt);\n      if (badge) {\n        input.beforeMoveVal = inputEl.val();\n        isLeft ? badge.before(inputCt) : badge.after(inputCt);\n        inputEl.val(input.beforeMoveVal);\n        input.focus();\n        delete input.beforeMoveVal;\n      }\n    };\n\n    // moveToBadge\n    input.moveToBadge = function (badge) {\n      if (ac.isSingleMode()) return;\n\n      if (badge) badge.before(input.el);\n      else {\n        var lastBadge = ac.badge.getLastBadge();\n        if (lastBadge) lastBadge.after(input.el);\n      }\n    };\n\n    // updateSizer\n    input.updateSizer = function () {\n      inputSizer.text(inputEl.val() + 'WW');\n    };\n\n    // updateTextValue\n    input.updateTextValue = function (text, focus) {\n      inputEl.val(text);\n      if (!input.isFocused && focus !== false) input.focus();\n      input.updateSizer();\n      if (isIE && focus !== false) setCaretPosition(inputEl[0]);\n    };\n\n    // confirmValue\n    input.confirmValue = function (isEsc, opts) {\n      opts = opts || {};\n      var added;\n\n      if (isEsc) {\n        if (ac.editingItem) added = ac.badge.addBadge(ac.editingItem.item);\n      } else added = ac.badge.addBadge(inputEl.val());\n\n      //if (isIE && ac.isSingleMode() && fromBlur) {\n      //  ac.close();\n      //  return;\n      //}\n\n      if (ac.isSingleMode()) {\n        if (!added) {\n          if (ac.selectedItems.length > 0) ac.removeSelected(ac.selectedItems[0]);\n          if (inputEl.val()) input.clear();\n        }\n        if (!opts.fromBlur) inputEl.blur();\n        ac.close();\n      } else if (inputEl.val()) {\n        input.clear();\n      }\n    };\n\n    // blur\n    input.blur = function () {\n      if (!input.isFocused) return;\n      inputEl.blur();\n    };\n\n    // clear\n    input.clear = function (fireBlur) {\n      inputEl.val('');\n      if (fireBlur === false) ac.placeholder.refresh();\n      else inputEl.blur();\n      inputSizer.text('W');\n      inputCt.removeClass(CLS.hasInputVal);\n    };\n\n    // getSearchText\n    input.getSearchText = function () {\n      return inputEl.val();\n    };\n\n    // focus\n    input.focus = function () {\n      if (input.isFocused) return;\n      inputEl.focus();\n    };\n\n    inputSizer.text('WW');\n    input.emptyWidth = getOuterWidth(inputCt);\n    inputSizer.text('W');\n\n    // hideBadge模式下，搜索框清理按钮\n    if (ac.isHideBadge()) {\n      $(ac.params.tpls.clearBtnTpl)\n        .addClass(CLS.inputClearBtnClass)\n        .appendTo(inputCt)\n        .on('mousedown', function (e) {\n          if (ac.isReadonly()) return;\n\n          ac.input.clear(false);\n          ac.loadData().then(function () {\n            ac.panel.render();\n          });\n          stopEvent(e);\n        });\n    }\n  };\n\n  // DropdownPanelMenubar\n  var DropdownPanelMenubar = function (ac, panel) {\n    var menuBar = this;\n    var menuBarEl = menuBar.el = $(ac.params.tpls.dropdownTopBarTpl);\n\n    $(panel.el)\n      .on('mousedown', '.selrev-btn', function (e) {\n        panel.el.children('.' + CLS.dropdownItem).each(function (i, itemEl) {\n          var $itemEl = $(itemEl);\n          var item = $itemEl.data('bsAutoCompleteItem');\n          if (!item) return;\n\n          var badgeEl = ac.isSelected(item) && ac.badge.findSelectedBadgeEl(item);\n          if (!!badgeEl) ac.badge.closeBadge(badgeEl, {closePanel: !ac.isSelectOptionMode(), itemEl: $itemEl});\n          else ac.badge.addBadge(item, {itemEl: $itemEl});\n        });\n        stopEvent(e);\n      })\n      .on('mousedown', '.selall-btn', function (e) {\n        panel.el.children('.' + CLS.dropdownItem).each(function (i, itemEl) {\n          var $itemEl = $(itemEl);\n          var item = $itemEl.data('bsAutoCompleteItem');\n          if (!item) return;\n\n          var badgeEl = ac.isSelected(item) && ac.badge.findSelectedBadgeEl(item);\n          if (!badgeEl) ac.badge.addBadge(item, {itemEl: $itemEl});\n        });\n        stopEvent(e);\n      });\n\n    menuBarEl.find('.selrev-btn').text(ac.params.revselectBtnTxt);\n    menuBarEl.find('.selall-btn').text(ac.params.selectAllBtnTxt);\n  };\n\n  // DropdownPanel\n  var DropdownPanel = function (ac) {\n    var panel = this, panelEl = panel.el = $(ac.params.tpls.dropdownTpl).appendTo(ac.el);\n    var emptyItemEl = $(ac.params.tpls.emptyDropDownItemTpl).text(ac.params.emptyListTip);\n\n    // 从父元素一次性注册事件，提高性能\n    $(panel.el).on('mousedown', '.' + CLS.dropdownItem, function (e) {\n      if (ac.isReadonly()) return;\n\n      var itemEl = $(e.currentTarget);\n      var item = itemEl.data('bsAutoCompleteItem');\n      if (!item) return;\n\n      if (item.optGroup) {\n        stopEvent(e);\n        return;\n      }\n\n      var doAdd = true;\n      if (!ac.isSelectOptionMode()) {\n        if (isIE) ac.input.blur();\n        ac.input.clear();\n      } else {\n        if (ac.editingItem && ac.editingItem.item === item) {\n          delete ac.editingItem;\n          ac.removeSelected(item);\n\n          if (ac.selectedItems.length <= 0) ac.input.blur();\n          ac.placeholder.refresh();\n          ac.fireBadgeRemoved();\n\n          doAdd = false;\n        }\n\n        var badgeEl = ac.badge.findSelectedBadgeEl(item);\n        if (!!badgeEl) {\n          ac.badge.closeBadge(badgeEl, {closePanel: false, itemEl: itemEl});\n          doAdd = false;\n        }\n      }\n\n      if (doAdd) ac.badge.addBadge(item, {itemEl: itemEl});\n\n      stopEvent(e);\n    });\n\n    // TODO\n    var menuBar;\n    if (ac.isSelectOptionMode()) {\n      menuBar = new DropdownPanelMenubar(ac, panel);\n    }\n\n    panelEl.on('mousewheel', function (e) {\n      if (e.currentTarget !== panelEl[0]) return;\n\n      var scrollTop = panelEl.scrollTop();\n      var innerHeight = panelEl.innerHeight();\n      var scrollHeight = panelEl[0].scrollHeight;\n      var delta = (e.originalEvent.wheelDelta && (e.originalEvent.wheelDelta > 0 ? 1 : -1)) ||\n        (e.originalEvent.detail && (e.originalEvent.detail > 0 ? -1 : 1));\n\n      if (scrollTop <= 0 && delta > 0 || // 到达顶部\n        scrollTop + innerHeight >= scrollHeight - 1 && delta < 0) { // 到达底部\n        stopEvent(e);\n      }\n    });\n\n    // findItemEl\n    panel.findItemEl = function (item) {\n      if (!item) return;\n\n      var foundItemEl;\n      var itemName = item.n || item.name, itemCode = item.c || item.code\n      var checkedItemEls = panelEl.children('li.' + CLS.dropdownItem + '.' + CLS.itemChecked);\n      $.each(checkedItemEls, function (i, itemEl) {\n        var $itemEl = $(itemEl);\n        var boundItem = $itemEl.data('bsAutoCompleteItem');\n        if (!boundItem) return;\n\n        if (boundItem === item) {\n          foundItemEl = $itemEl;\n          return false\n        }\n\n        var boundItemName = boundItem.n || boundItem.name, boundItemCode = boundItem.c || boundItem.code;\n        if (boundItemName === itemName && boundItemCode === itemCode) {\n          foundItemEl = $itemEl;\n        }\n      });\n      return foundItemEl;\n    };\n\n    // moveSelect\n    panel.moveSelect = function (isUp) {\n      var selItem = panelEl.children('li.' + CLS.dropdownItem + '.' + CLS.itemSelected), moveToItem,\n        itemCls = '.' + CLS.dropdownItem;\n      var skipMultiSel = !ac.isSingleMode() && ac.params.hideOtherSelected4Multiple;\n      if (skipMultiSel) itemCls += ':not(.' + CLS.multiHideSel + ')';\n      if (selItem.size() > 0) {\n        moveToItem = isUp ? selItem.prev() : selItem.next();\n\n        while (moveToItem.size() > 0) {\n          if (moveToItem.hasClass(CLS.dropdownItem) && (!skipMultiSel || !moveToItem.hasClass(CLS.multiHideSel)))\n            break;\n          moveToItem = isUp ? moveToItem.prev() : moveToItem.next();\n        }\n\n        if (moveToItem.size() <= 0) {\n          var items = panelEl.children(itemCls);\n          if (items.size() > 0) moveToItem = isUp ? $(items[items.size() - 1]) : $(items[0]);\n        }\n      } else {\n        var items = panelEl.children(itemCls);\n        if (items.size() > 0) moveToItem = isUp ? $(items[items.size() - 1]) : $(items[0]);\n      }\n\n      if (moveToItem && moveToItem.length > 0) {\n        selItem.removeClass(CLS.itemSelected);\n        moveToItem.addClass(CLS.itemSelected);\n        panel.scrollToSelected(moveToItem);\n      }\n    };\n\n    // scrollToSelected\n    panel.scrollToSelected = function (selectedItem) {\n      selectedItem = selectedItem || panelEl.children('li.' + CLS.dropdownItem + '.' + CLS.itemSelected);\n      if (selectedItem.size() > 0) {\n        var scrollTop = panelEl.scrollTop(), top = selectedItem.position().top + scrollTop;\n        top = top - (panelEl.height() - selectedItem.height()) / 2;\n        panelEl.scrollTop(top);\n      }\n    };\n\n    // getSelectedItemEl\n    panel.getSelectedItemEl = function () {\n      return panelEl.children('li.' + CLS.dropdownItem + '.' + CLS.itemSelected);\n    };\n\n    // render\n    panel.render = function () {\n      var data = ac.data || [], searchText = ac.input.getSearchText();\n      panelEl.empty();\n      panelEl.scrollTop();\n\n      var ei = ac.editingItem && ac.editingItem.item || {}, eiCode = ei.c || ei.code, eiName = ei.n || ei.name;\n      if (data.length > 0) {\n        var matched = false, hasOptGroup;\n        var isMultiMode = !ac.isSingleMode(), hideOtherSelected4Multiple = ac.params.hideOtherSelected4Multiple;\n        var lastGroupEl, lastGroupChildCount = 0, selectableItemCount = 0;\n\n        panelEl.removeClass(CLS.emptyList);\n        if (ac.isSelectOptionMode()) {\n          panelEl.append(menuBar.el);\n          ac.el.addClass(CLS.modePrefix + MODE.selectOption.toLowerCase());\n        } else {\n          ac.el.removeClass(CLS.modePrefix + MODE.selectOption.toLowerCase());\n        }\n\n        $.each(data, function (i, item) {\n          var itemEl, itemName = item.n || item.name, itemCode = item.c || item.code,\n            customNameHtml = item.hn || item.htmlName, selectable = true;\n          if (ac.params.itemRender) itemEl = ac.params.itemRender.call(ac, item, searchText);\n          else {\n            itemEl = $(ac.params.tpls.dropdownItemTpl);\n            var text = itemEl.find('.text');\n            if (ac.params.itemUseHtml) text.append(ohtml($(customNameHtml || itemName)));\n            else text.text(itemName);\n          }\n\n          var selectedItem = ac.selectedItemMap[itemCode];\n          var itemChecked = selectedItem && (\n            selectedItem === item ||\n            (selectedItem.c || selectedItem.code) === itemCode &&\n            (selectedItem.n || selectedItem.name) === itemName);\n\n          if (itemChecked) {\n            itemEl.addClass(CLS.itemChecked);\n            if (isMultiMode) {\n              itemEl.addClass(CLS.multiSelected);\n              if (hideOtherSelected4Multiple) {\n                selectable = false;\n                itemEl.addClass(CLS.multiHideSel);\n              }\n            }\n          } else {\n            itemEl.removeClass(CLS.itemChecked);\n          }\n\n          if (item.optGroup === true) {\n            selectable = false;\n            itemEl.addClass('bs-autocomplete-group');\n            if (!hasOptGroup) {\n              hasOptGroup = true;\n              panelEl.addClass('bs-autocomplete-grouped');\n            }\n\n            if (lastGroupEl && lastGroupChildCount <= 0)\n              lastGroupEl.addClass('bs-autocomplete-group-hide');\n\n            lastGroupEl = itemEl;\n            lastGroupChildCount = 0;\n          } else {\n            if (lastGroupEl && selectable) lastGroupChildCount++;\n            if (selectable) selectableItemCount++;\n            itemEl.addClass(CLS.dropdownItem);\n          }\n          if (item.cls) itemEl.addClass(item.cls);\n\n          itemEl\n            .appendTo(panelEl)\n            .data('bsAutoCompleteItem', item)\n            .attr('title', itemName);\n\n          if (!matched && searchText) {\n            if (ac.editingItem && ac.editingItem.text == searchText) {\n              if (eiCode == itemCode && eiName == itemName)\n                matched = true;\n            }\n            if (ac.isInSearchMode('name') && searchText == itemName) {\n              matched = true;\n            } else if (ac.isInSearchMode('code') && searchText == itemCode) {\n              matched = true;\n            }\n            if (matched) itemEl.addClass(CLS.itemSelected);\n          }\n        });\n\n        if (lastGroupEl && lastGroupChildCount <= 0)\n          lastGroupEl.addClass('bs-autocomplete-group-hide');\n\n        if (selectableItemCount <= 0) {\n          panelEl.addClass('no-selectable-items');\n        } else {\n          panelEl.removeClass('no-selectable-items');\n        }\n      } else {\n        panelEl.addClass(CLS.emptyList).append(emptyItemEl);\n        if (!ac.isSelectOptionMode()) ac.close();\n      }\n    };\n\n    // resize\n    panel.resize = function () {\n      var width = ac.el.outerWidth();\n      panelEl.css('max-width', width);\n      if (ac.isSelectOptionMode()) panelEl.width(width);\n      if (ac.isHideBadge()) {\n        ac.input.el.width(width).css('max-width', width);\n      }\n      ac.fireOnPanelResize(ac);\n    };\n\n    // relocate\n    panel.relocate = function () {\n      var inputPosLeft = ac.input.el.position().left;\n      if (ac.isSingleMode() || ac.isSelectOptionMode()) inputPosLeft = 0;\n      panelEl.css('left', inputPosLeft + 'px');\n    };\n\n    // close\n    panel.close = function () {\n      panelEl.children('.' + CLS.dropdownItem)\n        .removeClass(CLS.itemSelected)\n        .removeClass(CLS.itemChecked);\n    };\n\n    // destroy\n    panel.destroy = function () {\n      panelEl.children().each(function () {\n        $(this).removeData('bsAutoCompleteItem');\n      });\n      panelEl.remove();\n    };\n  };\n\n  // AutoComplete\n  var AutoComplete = function (params, originEl) {\n    var ac = this;\n    params = $.extend(true, {tpls: TPLS}, params || {});\n    for (var def in DEF_OPTS) if (typeof params[def] === 'undefined') params[def] = DEF_OPTS[def];\n    ac.params = params, ac.initialized = false, ac.selectedItems = [], ac.selectedItemMap = {}, ac.readonly = false;\n\n    // htmlOverHandler\n    var htmlOverHandler = function () {\n      if (!ac.resized4htmlOver) {\n        if (ac.el.is(':visible')) ac.resize();\n        $('html').off('mouseover', htmlOverHandler);\n        ac.resized4htmlOver = true;\n      }\n    };\n\n    // htmlClickHandler\n    var htmlClickHandler = function (e) {\n      if (!ac.el.hasClass('open')) return;\n      if ($(e.target).hasClass('bootstrap-autocomplete')) return;\n\n      var autocomplete = $(e.target).parents('.bootstrap-autocomplete');\n      if (autocomplete.size() == 0) ac.close();\n      else if (autocomplete[0] != ac.el[0]) ac.close();\n    };\n\n    // htmlResizeHandler\n    var resizeTimeout;\n    var htmlResizeHandler = function (e) {\n      if (resizeTimeout) clearTimeout(resizeTimeout);\n      setTimeout(function () {\n        ac.panel.resize();\n      }, 100);\n    };\n\n    // elOverHandler\n    var elOverHandler = function () {\n      if (!ac.resized4elOver) {\n        if (ac.el.is(':visible')) ac.resize();\n        ac.el.off('mouseover', elOverHandler);\n        ac.resized4elOver = true;\n      }\n    };\n\n    // addValue\n    ac.addValue = function (items, opts) {\n      opts = $.extend({onSetFinish: $.noop}, opts || {});\n\n      var oldSelectedItems = ac.getValue(), changeFired;\n      if (opts.clear) ac.clearValue(false);\n      if (!items) {\n        opts.fireInit ? ac.fireOnInit() : changeFired = ac.fireOnChange(oldSelectedItems, ac.getValue());\n        opts.onSetFinish.call(ac, changeFired);\n        return;\n      }\n\n      if (!(items instanceof Array)) {\n        if (isString(items)) items = [{c: items, n: items}];\n        else items = [items];\n      } else if (items.length <= 0) {\n        return;\n      } else {\n        var formatedItems = [];\n        $.each(items, function (i, item) {\n          if (isString(item)) formatedItems.push({c: item, n: item});\n          else formatedItems.push(item);\n        });\n        items = formatedItems;\n      }\n\n      if (ac.params.forceSelect && ac.params.loadDataItems) {\n        ac.loadDataItems(items).then(function (tmpData) {\n          $.each(items, function (i, item) {\n            ac.badge.addBadge(item, {specialData: tmpData});\n          });\n        }).always(function () {\n          opts.fireInit ? ac.fireOnInit() : changeFired = ac.fireOnChange(oldSelectedItems, ac.getValue());\n          opts.onSetFinish.call(ac, changeFired);\n        });\n      } else {\n        var lastSearchData = ac.data, needCheckRemote = ac.params.forceSelect && ac.params.loadData && true;\n        var toCheckCount = items.length, checkedItemCount = 0;\n        if (items.length > 0 && !needCheckRemote) ac.data = (ac.params.data || []).slice();\n        $.each(items, function (i, item) {\n          if (needCheckRemote) {\n            if (ac.searchInData(item, lastSearchData)) {\n              ac.badge.addBadge(item);\n              checkedItemCount++;\n            } else {\n              var itemCode = item.c || item.code, itemName = item.n || item.name;\n              var searchMode = ac.isInSearchMode('name') ? 'name' : 'code';\n              var searchText = searchMode == 'code' ? itemCode : itemName, tmpData = [];\n              ac.loadData({\n                searchText                : searchText,\n                specialData               : tmpData,\n                showAllItemsWhenFirstFocus: false,\n                searchMode                : searchMode,\n                from                      : 'addValue'\n              }).then(function (tmpData) {\n                lastSearchData = tmpData;\n                ac.badge.addBadge(item, {specialData: tmpData});\n              }).always(function () {\n                if (++checkedItemCount == toCheckCount) {\n                  opts.fireInit ? ac.fireOnInit() : changeFired = ac.fireOnChange(oldSelectedItems, ac.getValue());\n                  opts.onSetFinish.call(ac, changeFired);\n                }\n              });\n            }\n          } else ac.badge.addBadge(item);\n        });\n        if (!needCheckRemote) {\n          opts.fireInit ? ac.fireOnInit() : changeFired = ac.fireOnChange(oldSelectedItems, ac.getValue());\n          opts.onSetFinish.call(ac, changeFired);\n        }\n      }\n    };\n\n    // setValue\n    ac.setValue = function (items, opts) {\n      opts = $.extend(opts || {}, {clear: true});\n      ac.addValue(items, opts);\n    };\n\n    // openOnFocus\n    ac.openOnFocus = function () {\n      var showAllItemsWhenFirstFocus = ac.params.showAllWhenSingleForceSelectFocus && ac.params.forceSelect && ac.isSingleMode();\n      ac.loadData({showAllItemsWhenFirstFocus: showAllItemsWhenFirstFocus, from: 'openOnFocus'}).then(function () {\n        ac.open();\n        ac.panel.render();\n      });\n    };\n\n    // isInSearchMode\n    ac.isInSearchMode = function (mode) {\n      return ac.params.searchMode.indexOf(mode) >= 0;\n    };\n\n    // resize\n    ac.resize = function () {\n      ac.badge.resize();\n    };\n\n    // destroy\n    ac.destroy = function () {\n      ac.destoried = true;\n      ac.panel.destroy();\n      $('html').off({'click': htmlClickHandler, 'mouseover': htmlOverHandler});\n      $(window).off('resize', htmlResizeHandler);\n      ac.params.el.removeData(\"bsAutoComplete\");\n      ac.el.remove();\n      if (ac.selectedItemsInfo) ac.selectedItemsInfo.destroy();\n    };\n\n    // fireOnChange\n    ac.fireOnChange = function (oldItems, newItems) {\n      var fire = true;\n      if (oldItems != newItems && oldItems.length == newItems.length) {\n        var allItemsSame = true;\n        $.each(oldItems, function (i, oldItem) {\n          var oldItemCode = oldItem.code || oldItem.c, oldItemName = oldItem.name || oldItem.n;\n          var newItem = newItems[i], newItemCode = newItem.code || newItem.c, newItemName = newItem.name || newItem.n;\n          if (oldItemCode != newItemCode || oldItemName != newItemName) {\n            allItemsSame = false;\n            return false;\n          }\n        });\n        if (allItemsSame) fire = false;\n      }\n      if (fire) {\n        if (ac.params.disableResizeContainer !== false && ac.resizeContainer)\n          setTimeout(function () { ac.containerEl.height(ac.el.outerHeight()); }, 0);\n        ac.params.el.trigger('bs.autocomplete.change', [oldItems, newItems]);\n      }\n      return fire;\n    };\n\n    // fireOnPanelResize\n    ac.fireOnPanelResize = function () {\n      ac.params.el.trigger('bs.autocomplete.panel.resize', [ac]);\n    };\n\n    // fireOnSelect\n    ac.fireOnSelect = function (item, items) {\n      ac.params.el.trigger('bs.autocomplete.select', [item, items]);\n    };\n\n    // fireOnClose\n    ac.fireOnClose = function () {\n      if (ac.inputGroupEl) ac.inputGroupEl.removeClass('open');\n      ac.params.el.trigger('bs.autocomplete.close');\n    };\n\n    // fireOnInit\n    ac.fireOnInit = function () {\n      if (ac.isInitialized) return;\n\n      ac.isInitialized = true;\n      ac.params.el.trigger('bs.autocomplete.inited');\n    };\n\n    // fireOnFocus\n    ac.fireOnFocus = function () {\n      if (ac.inputGroupEl) ac.inputGroupEl.addClass('focus');\n      ac.params.el.trigger('bs.autocomplete.focus');\n    };\n\n    // fireOnPen\n    ac.fireOnPen = function () {\n      if (ac.inputGroupEl) ac.inputGroupEl.addClass('open');\n      ac.params.el.trigger('bs.autocomplete.open');\n    };\n\n    // fireBadgeRemoved\n    ac.fireBadgeRemoved = function () {\n      ac.params.el.trigger('bs.autocomplete.badge.removed');\n    };\n\n    // fireOnBlur\n    ac.fireOnBlur = function () {\n      if (ac.inputGroupEl) ac.inputGroupEl.removeClass('focus');\n      ac.params.el.trigger('bs.autocomplete.blur');\n    };\n\n    // fireOnDeSelect\n    ac.fireOnDeSelect = function (item, items) {\n      ac.params.el.trigger('bs.autocomplete.deselect', [item, items]);\n    };\n\n    // isSingleMode\n    ac.isSingleMode = function () {\n      return !ac.params.multiple;\n    };\n\n    // isHideBadge\n    ac.isHideBadge = function () {\n      return ac.params.hideBadge && ac.isSelectOptionMode();\n    };\n\n    // isSelectOptionMode\n    ac.isSelectOptionMode = function () {\n      return ac.params.mode === MODE.selectOption && !ac.isSingleMode();\n    };\n\n    // close\n    ac.close = function () {\n      ac.el.removeClass('open');\n      ac.panel.close();\n      ac.fireOnClose();\n      ac.closeTime = new Date().getTime();\n    };\n\n    // open\n    ac.open = function () {\n      if (ac.readonly) return;\n      ac.panel.resize();\n      ac.panel.relocate();\n      ac.el.addClass('open');\n      ac.fireOnPen();\n    };\n\n    // isOpen\n    ac.isOpen = function () {\n      return ac.el.hasClass('open');\n    };\n\n    // getValue\n    ac.getValue = function () {\n      return ac.selectedItems.slice();\n    };\n\n    // clearData\n    ac.clearData = function () {\n      ac.data.splice(0, ac.data.length);\n    };\n\n    // clearValue\n    ac.clearValue = function (fire) {\n      if (ac.isSingleMode()) ac.input.clear(fire);\n\n      var oldSelectedItems = ac.getValue();\n      ac.selectedItems.splice(0, ac.selectedItems.length);\n      ac.selectedItemMap = {};\n      ac.el.children('.' + CLS.badgeCt).remove();\n      ac.el.removeClass(CLS.itemSelected);\n      if (ac.selectedItemsInfo) ac.selectedItemsInfo.refreshItems();\n      ac.placeholder.refresh();\n      if (fire !== false) {\n        ac.params.el.trigger('bs.autocomplete.clear');\n        ac.fireOnChange(oldSelectedItems, ac.getValue());\n      }\n    };\n\n    // setReadonly\n    ac.setReadonly = function (readonly) {\n      readonly = readonly !== false;\n      ac.readonly = readonly;\n      if (readonly) ac.el.addClass('readonly');\n      else ac.el.removeClass('readonly');\n    };\n\n    // isReadonly\n    ac.isReadonly = function () {\n      return ac.readonly;\n    };\n\n    // addSelected\n    ac.addSelected = function (item, opts) {\n      opts = opts || {};\n      var oldSelectedItems = ac.selectedItems.slice();\n\n      if (ac.isSingleMode()) {\n        ac.selectedItems.splice(0, ac.selectedItems.length);\n        ac.selectedItemMap = {};\n      }\n\n      ac.selectedItems.push(item);\n      ac.selectedItemMap[item.c || item.code] = item;\n      if (ac.selectedItems.length > 0) ac.el.addClass(CLS.itemSelected);\n\n      if (ac.isOpen()) {\n        var itemEl = opts.itemEl || ac.panel.findItemEl(item);\n        if (itemEl) itemEl.addClass(CLS.itemChecked);\n      }\n\n      if (ac.selectedItemsInfo) ac.selectedItemsInfo.refreshItems();\n\n      if (opts.fire !== false) {\n        ac.fireOnSelect(item, ac.getValue());\n        ac.fireOnChange(oldSelectedItems, ac.getValue());\n      }\n    };\n\n    // isSelected\n    ac.isSelected = function (item) {\n      return item && ac.selectedItemMap[item.c || item.code];\n    };\n\n    // removeSelected\n    ac.removeSelected = function (item) {\n      var findIndex = ac.findSelectedItem(item);\n      if (findIndex >= 0) {\n        var oldSelectedItems = ac.selectedItems.slice();\n        ac.selectedItems.splice(findIndex, 1);\n        delete ac.selectedItemMap[item.c || item.code];\n        if (ac.selectedItems.length <= 0) ac.el.removeClass(CLS.itemSelected);\n\n        if (ac.selectedItemsInfo) ac.selectedItemsInfo.refreshItems();\n\n        ac.fireOnDeSelect(item, ac.getValue());\n        ac.fireOnChange(oldSelectedItems, ac.getValue());\n      }\n    };\n\n    // isItemMatched\n    ac.isItemMatched = function (searchText, item) {\n      var regex = new RegExp(escapeRegex(searchText), ac.params.ignoreCase ? 'i' : undefined);\n      var matched = false;\n      if (ac.isInSearchMode('name')) matched = regex.test(item.n || item.name);\n      if (!matched && ac.isInSearchMode('code')) matched = regex.test(item.c || item.code);\n      return matched;\n    };\n\n    // findSelectedItem\n    ac.findSelectedItem = function (item) {\n      var result = -1, itemCode = item.c || item.code, itemName = item.n || item.name;\n      $.each(ac.selectedItems, function (i, selItem) {\n        var selCode = selItem.c || selItem.code, selName = selItem.n || selItem.name;\n        if (selCode === itemCode && selName === itemName) {\n          result = i;\n          return false;\n        }\n      });\n      return result;\n    };\n\n    // searchInData\n    ac.searchInData = function (item, data) {\n      var isFromStr = isString(item);\n      if (isFromStr) item = {c: item, n: item};\n      var findItem, itemCode = item.c || item.code, itemName = item.n || item.name, data = data || ac.data;\n\n      $.each(data, function (i, dataItem) {\n        var dataCode = dataItem.c || dataItem.code, dataName = dataItem.n || dataItem.name;\n        if (isFromStr) {\n          if (ac.isInSearchMode('name') && dataName == itemName || ac.isInSearchMode('code') && dataCode == itemCode) {\n            findItem = dataItem;\n            return false;\n          }\n        } else {\n          if (dataName == itemName && dataCode == itemCode) {\n            findItem = dataItem;\n            return false;\n          }\n        }\n      });\n      return findItem;\n    };\n\n    // loadDataItems\n    ac.loadDataItems = function (items) {\n      var defered = $.Deferred();\n      var loadedItems = [];\n\n      ac.params.loadDataItems.call(ac, items, function (data) {\n        if (data) {\n          $.each(data, function (i, item) {\n            if (isString(item)) item = {c: item, n: item};\n            loadedItems.push(item);\n          });\n          defered.resolve(loadedItems);\n        } else defered.reject();\n      });\n\n      return defered.promise();\n    };\n\n    // loadData\n    ac.loadDataSeq = 0;\n    ac.loadData = function (opts) {\n      var loadSeq = ac.loadDataSeq++;\n      opts = opts || {};\n      opts.searchText = opts.showAllItemsWhenFirstFocus ? '' : (opts.searchText || ac.input.getSearchText());\n      var defered = $.Deferred();\n\n      opts.specialData = opts.specialData || ac.data;\n      opts.specialData.splice(0, opts.specialData.length);\n      if (ac.params.loadData) {\n        ac.params.loadData.call(ac, opts.searchText, function (data, _loadSeq) {\n          // 通过seq跳过队列前端的异步响应\n          var nLoadSeq = Number(_loadSeq);\n          if (!isNaN(_loadSeq) && (_loadSeq + '' === nLoadSeq + '') && _loadSeq !== ac.loadDataSeq - 1) return;\n\n          if (data) {\n            opts.specialData.splice(0, opts.specialData.length);\n            $.each(data, function (i, item) {\n              if (isString(item)) item = {c: item, n: item};\n              opts.specialData.push(item);\n            });\n            defered.resolve(opts.specialData);\n          } else defered.reject();\n        }, opts.searchMode, opts.from, loadSeq);\n      } else {\n        var data = ac.params.data || [], lastGroupItem;\n        $.each(data, function (i, item) {\n          if (isString(item)) item = {c: item, n: item};\n          if (item.optGroup === true) {\n            lastGroupItem = item;\n            return;\n          }\n          if (opts.searchText && !ac.isItemMatched(opts.searchText, item)) return;\n          if (lastGroupItem) {\n            opts.specialData.push(lastGroupItem);\n            lastGroupItem = undefined;\n          }\n          opts.specialData.push(item);\n        });\n        defered.resolve(opts.specialData);\n      }\n      return defered.promise();\n    };\n\n    ac.data = [], ac.el = $(ac.params.tpls.containerTpl).addClass(ac.params.cls);\n\n    // 解决在 input-group 中的样式问题\n    var inputGroupEl = ac.inputGroupEl = params.el.closest('.input-group'),\n      isUnderInputGroup = ac.isUnderInputGroup = inputGroupEl.size() > 0;\n\n    var isOriginInputEl = params.el.is(':input');\n    if (isOriginInputEl && !ac.params.replace) ac.params.replace = true;\n\n    // 原始元素为 input 时且父元素为 input-group 时放入代理容器\n    var inputDelegateCtEl;\n    if (isOriginInputEl && params.el.parent().hasClass('input-group')) {\n      inputDelegateCtEl = ac.inputDelegateCtEl = $(ac.params.tpls.inputDelegateContainerTpl)\n        .addClass('form-control');\n      inputDelegateCtEl.insertAfter(params.el);\n      params.el.appendTo(inputDelegateCtEl);\n    }\n\n    if (ac.params.fitWdith !== false) ac.el.addClass('fit-width');\n    if (ac.params.dropUp) ac.el.addClass('dropup');\n    if (ac.params.replace) {\n      ac.el.insertAfter(params.el);\n      params.el.hide();\n    } else {\n      if (inputDelegateCtEl) {\n        ac.el.appendTo(inputDelegateCtEl);\n      } else {\n        if (isUnderInputGroup) params.el.addClass('form-control');\n        ac.el.appendTo(params.el);\n      }\n    }\n\n    var bsAcCtEl = ac.containerEl = ac.el.parent(), resizeHeightCls = 'bs-ac-ct-resize';\n    if (isUnderInputGroup && bsAcCtEl.hasClass('form-control')) bsAcCtEl.addClass(resizeHeightCls);\n    ac.resizeContainer = bsAcCtEl.hasClass(resizeHeightCls);\n\n    ac.input = new Input(ac);\n    ac.panel = new DropdownPanel(ac);\n    ac.badge = new Badge(ac);\n    ac.placeholder = new PlaceHolder(ac);\n    if (ac.params.data) {\n      $.each(ac.params.data, function (i, item) {\n        if (isString(item)) ac.data.push({c: item, n: item});\n        else ac.data.push(item);\n      });\n      ac.params.data = ac.data.slice();\n    }\n\n    { // clear btn\n      $(ac.params.tpls.clearBtnTpl)[ac.isHideBadge() ? 'prependTo' : 'appendTo'](ac.el)\n        .addClass(CLS.clearBtnClass)\n        .on('click', function (e) {\n          if (ac.isReadonly()) return;\n\n          ac.clearValue();\n          stopEvent(e);\n        });\n    }\n\n    if (ac.params.readonly) ac.setReadonly(true);\n\n    ac.el.on({\n      mousedown: function (e) {\n        if (ac.isReadonly()) return;\n\n        if (e.target == ac.el[0]) {\n          var badge = ac.badge.getClosestBadge(e.offsetX, e.offsetY);\n          ac.input.moveToBadge(badge);\n          if (ac.input.isFocused) stopEvent(e);\n          //ac.input.focus();\n        }\n      },\n      click    : function (e) {\n        if (ac.isReadonly()) return;\n\n        if (ac.selectedItemsInfo && ac.selectedItemsInfo.isStopDragLately()) return;\n        if (ac.isHideBadge()) ac.el.addClass('focus');\n        ac.input.focus();\n        if (ac.input.isFocused) stopEvent(e);\n      },\n      mouseover: elOverHandler\n    });\n\n    if (ac.isHideBadge()) {\n      ac.el.addClass(CLS.badgeHide);\n      ac.selectedItemsInfo = new SelectedItemsInfo(ac);\n    } else {\n      ac.el.removeClass(CLS.badgeHide);\n    }\n\n    originEl.data(\"bsAutoComplete\", this);\n    if (ac.params.value) ac.setValue(ac.params.value, {fireInit: true});\n    else ac.fireOnInit();\n\n    $('html').on({'click': htmlClickHandler, 'mouseover': htmlOverHandler});\n    $(window).on('resize', htmlResizeHandler);\n  };\n\n  $.fn.bsAutoComplete = function (params) {\n    var args = arguments;\n    return this.each(function () {\n      if (!this) return;\n      var $this = $(this);\n\n      var bsAutoComplete = $this.data(\"bsAutoComplete\");\n      if (!bsAutoComplete && params != 'destroy') {\n        params = $.extend({\n          el: $this, value: $this.val() ? $this.val().split(params.splitChar || ' ') : ''\n        }, params);\n        bsAutoComplete = new AutoComplete(params, $this);\n      }\n      if (bsAutoComplete && isString(params))\n        bsAutoComplete[params].apply(bsAutoComplete, Array.prototype.slice.call(args, 1));\n    });\n  }\n\n})(jQuery);\n"]}