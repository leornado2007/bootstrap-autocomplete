!function(S){"use strict";var m={cls:"",placeHolder:"请选择",searchMode:"code name",ignoreCase:!0,fitWdith:!0,dropUp:!1,filtSame:!1,badgeCls:"",dblclick4Edit:!1,inputSearchDelay:200,forceSelect:!1,minChar:1,multiple:!0,debounceFn:function(t,a,e){if(S.debounce)return S.debounce(t,e,a);var n=-1,l=-1;return function(){var e=+(new Date).getTime();(n<0||t<e-n)&&(n=e,0<l&&(clearTimeout(l),l=-1),l=setTimeout(function(){n=l=-1,a()},t))}}},T=-1<navigator.userAgent.indexOf("Trident"),v=13,b=9,I=37,C=38,x=39,y=40,z=27,M=8,D=46,h={inputDelegateContainerTpl:'<div class="input-delegate-ct"></div>',containerTpl:'<div class="btn-group bootstrap-autocomplete form-control"></div>',inputTpl:'<div class="delegate-input">        <input type="text" class="input-delegate">        <span class="input-delegate-sizer">W</span>      </div>',dropdownTpl:'<ul class="dropdown-menu bs-autocomplete-menu"></ul>',placeholderTpl:'<div class="bs-autocomplete-placeholder"></div>',clearBtnTpl:'<span class="bsautocomplete-icon-cross bsautocomplete-font icon-jiaochacross78"></span>',dropdownItemTpl:'<li>        <a href="javascript:">          <span class="text"></span>        </a>      </li>',badgeTpl:'<span class="label label-primary">        <a href="javascript:" class="badge-text"></a>        <a href="javascript:" class="badge-close">x</a>      </span>'},O="bs-autocomplete-badge",V="bs-autocomplete-item",w="multiple-selected",F="multiple-hide-selected",o=function(e,t){return Number(e.css(t).replace("px",""))},R=function(e){return S("<div></div>").append(e).html()},a=function(e){document.selection?document.selection.createRange().moveStart("character",e.value.length):e.selectionStart=e.value.length},k=function(e){e.preventDefault(),e.stopPropagation()},g=function(e){return"string"==typeof e},W=function(e){var t=this.el=S(e.params.tpls.placeholderTpl).prependTo(e.el);t.text(e.params.placeHolder),this.refresh=function(){0<e.selectedItems.length?t.hide():t.show()}},B=function(m){var h=this;h.resize=function(e){if(e){var t=e.find(".badge-close"),a=o(e,"margin-left"),n=o(e,"margin-right"),l=(i=m.el,s=o(i,"padding-left"),r=o(i,"padding-right"),i.innerWidth()-s-r-m.input.emptyWidth-a-n-t.outerWidth()-2);e.find(".badge-text").css("max-width",l+"px")}else m.el.children("."+O).each(function(){h.resize(S(this))});var i,s,r},h.closeBadge=function(e){e.find(".badge-close").click()},h.getLastBadge=function(){var e=m.el.children("."+O);if(0<e.size())return S(e[e.size()-1])},h.getCloestBadge=function(i,s){var r,o;return m.el.children("."+O).each(function(){var e=S(this),t=e.position(),a=t.left,n=t.top,l=n+e.outerHeight();t.left,e.outerWidth();if(n<=s&&s<=l){if(o=!0,i<=a)return r=e,!1}else if(o)return r=e,!1}),r},h.add=function(e,t){var a=m.panel.getSelectedItem();if(!a){if(!e)return void delete m.editingItem;if(m.editingItem)if(e===m.editingItem.item)a=e;else if(g(e))m.editingItem.text==e&&(a=m.editingItem.item);else{var n=m.editingItem.item,l=n.c||n.code,i=n.n||n.name,s=n.c||n.code,r=n.n||n.name;s==l&&r==i&&(a=e)}var o;if(!a)g(e)?(o=m.searchInData(e,t))||m.params.forceSelect||(a={c:e,n:e}):m.params.forceSelect?(o=m.searchInData(e,t))&&(a=o):a=e;if(!a)return void delete m.editingItem}delete m.editingItem;var c,d=a.n||a.name,u=a.hn||a.htmlName;if(m.params.badgeRender)c=m.params.badgeRender.call(m,a);else{var p=(c=S(m.params.tpls.badgeTpl)).find(".badge-text");m.params.itemUseHtml?p.append(R(S(u||d))):p.text(d),p.attr("title",d)}c.addClass(O+" "+m.params.badgeCls).click(function(e){k(e)}),c.find(".badge-close").click(function(e){m.isReadonly()||(c.remove(),m.removeSelected(a),m.selectedItems.length<=0&&m.input.blur(),m.close(),m.placeholder.refresh(),m.fireBadgeRemoved(),k(e))}),c.find(".badge-text")[m.params.dblclick4Edit?"dblclick":"click"](function(e){if(!m.isReadonly()){c.after(m.input.el).remove(),m.removeSelected(a);var t=m.isInSearchMode("name")?a.n||a.name:a.c||a.code;m.params.getText4BadgeEdit&&(t=m.params.getText4BadgeEdit.call(m,a,t)),m.editingItem={item:a,text:t},m.close(),m.input.updateTextValue(t),k(e)}});var f=!1;if(m.params.filtSame&&0<m.selectedItems.length&&!m.isSingleMode()){if(0<=m.findSelectedItem(a))return!0;f=!0}else f=!0;return f&&(m.isSingleMode()&&m.el.children("."+O).remove(),m.input.el.before(c),m.addSelected(a,!t),h.resize(c),m.isSingleMode()&&m.input.updateTextValue(d,!1),m.placeholder.refresh()),f},m.isSingleMode()&&m.el.addClass("single-badge")},E=function(d){var u,p,e,f=this,m=f.el=S(d.params.tpls.inputTpl).appendTo(d.el),t=m.children(".input-delegate-sizer"),h=m.children(":text"),g=d.params.debounceFn(d.params.inputSearchDelay,function(){if(!d.destoried)return h.val().length<d.params.minChar?(d.close(),void d.panel.el.empty()):void d.loadData({from:"keydown"}).then(function(){d.open(),d.panel.render()})},!0);h.on({focus:function(e){if(d.isReadonly())return h.blur(),void k(e);f.isFocused=!0,f.updateSizer(),d.placeholder.el.hide(),d.el.addClass("focus"),(d.params.minChar<=0||h.val().length>=d.params.minChar)&&d.openOnFocus(),d.isSingleMode()&&0<d.getValue().length&&(a(h[0]),d.editingItem={item:d.getValue()[0],text:h.val()}),d.fireOnFocus()},blur:function(){f.isFocused&&(f.isFocused=!1,d.el.removeClass("focus"),(h.val()&&!f.beforeMoveVal||!h.val()&&d.isSingleMode())&&f.confirmValue(!1,!0),d.placeholder.refresh(),d.close(),d.fireOnBlur())},keydown:function(e){if(!d.isReadonly()){f.updateSizer();var t=!1;switch(e.keyCode){case v:var a=d.panel.getSelectedItem();if(a){var n=a.n||a.name,l=a.c||a.code;d.isInSearchMode("name")&&n?h.val(n):l&&h.val(l)}f.blur(),k(e),t=!0;break;case z:f.confirmValue(!0),t=!0;break;case b:var i=!!h.val();f.confirmValue(),i&&!d.isSingleMode()&&(h.focus(),k(e)),t=!0;break;case I:case x:var s=function(e){var t=0;if(document.selection){var a=document.selection.createRange();a.moveStart("character",0-e.value.length),t=a.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}(h[0]),r=h.val().length;e.keyCode==I&&0==s?(f.moveToLR(!0),k(e)):e.keyCode==x&&s==r&&(f.moveToLR(!1),k(e)),t=!0;break;case C:case y:d.panel.moveSelect(e.keyCode==C),k(e),t=!0;break;case M:if(!h.val()){var o=m.prev("."+O);0<o.size()&&(d.badge.closeBadge(o),k(e),t=!0)}break;case D:if(!h.val()){var c=m.next("."+O);0<c.size()&&(d.badge.closeBadge(c),k(e),t=!0)}break;default:d.panel.relocate()}t||(u&&clearTimeout(u),u=setTimeout(function(){u=undefined,p||g()},200))}},keyup:function(e){d.isReadonly()||f.updateSizer()},compositionstart:function(){p=!0},compositionend:function(){p=!1,g()}}),f.moveToLR=function(e){if(!d.isSingleMode()){var t=e?m.prev("."+O+" "):m.next("."+O);t&&(f.beforeMoveVal=h.val(),e?t.before(m):t.after(m),h.val(f.beforeMoveVal),f.focus(),delete f.beforeMoveVal)}},f.moveToBadge=function(e){if(!d.isSingleMode())if(e)e.before(f.el);else{var t=d.badge.getLastBadge();t&&t.after(f.el)}},f.updateSizer=function(){t.text(h.val()+"WW")},f.updateTextValue=function(e,t){h.val(e),f.isFocused||!1===t||f.focus(),f.updateSizer(),T&&!1!==t&&a(h[0])},f.confirmValue=function(e,t){var a;e?d.editingItem&&(a=d.badge.add(d.editingItem.item)):a=d.badge.add(h.val()),d.isSingleMode()?(a||(0<d.selectedItems.length&&d.removeSelected(d.selectedItems[0]),h.val()&&f.clear()),t||h.blur(),d.close()):h.val()&&f.clear()},f.blur=function(){f.isFocused&&h.blur()},f.clear=function(e){h.val(""),!1===e?d.placeholder.refresh():h.blur(),t.text("W")},f.getSearchText=function(){return h.val()},f.focus=function(){f.isFocused||h.focus()},t.text("WW"),f.emptyWidth=(e=m).outerWidth()+o(e,"margin-left")+o(e,"margin-right"),t.text("W")},A=function(I){var s=this,C=s.el=S(I.params.tpls.dropdownTpl).appendTo(I.el);s.moveSelect=function(e){var t,a=C.children("li.selected"),n="."+V,l=!I.isSingleMode()&&I.params.hideOtherSelected4Multiple;if(l&&(n+=":not(."+F+")"),0<a.size()){for(t=e?a.prev():a.next();0<t.size()&&(!t.hasClass(V)||l&&t.hasClass(F));)t=e?t.prev():t.next();if(t.size()<=0)0<(i=C.children(n)).size()&&(t=S(e?i[i.size()-1]:i[0]))}else{var i;0<(i=C.children(n)).size()&&(t=S(e?i[i.size()-1]:i[0]))}t&&0<t.length&&(a.removeClass("selected"),t.addClass("selected"),s.scrollToSelected(t))},s.scrollToSelected=function(e){if(0<(e=e||C.children("li.selected")).size()){var t=C.scrollTop(),a=e.position().top+t;a-=(C.height()-e.height())/2,C.scrollTop(a)}},s.getSelectedItem=function(){return C.children("li.selected").data("bsAutoCompleteItem")},s.render=function(){var e=I.data||[],c=I.input.getSearchText();C.empty(),C.scrollTop();var t=I.editingItem&&I.editingItem.item||{},d=t.c||t.code,u=t.n||t.name;if(0<e.length){var p,f,m=!1,h=!I.isSingleMode(),g=I.params.hideOtherSelected4Multiple,v=0,b=0;S.each(e,function(e,t){var a,n=t.n||t.name,l=t.c||t.code,i=t.hn||t.htmlName,s=!0;if(I.params.itemRender)a=I.params.itemRender.call(I,t,c);else{var r=(a=S(I.params.tpls.dropdownItemTpl)).find(".text");I.params.itemUseHtml?r.append(R(S(i||n))):r.text(n)}if(h){var o=I.selectedItemMap[l];o&&o===t&&(a.addClass(w),g&&(s=!1,a.addClass(F)))}!0===t.optGroup?(s=!1,a.addClass("bs-autocomplete-group"),p||(p=!0,C.addClass("bs-autocomplete-grouped")),f&&v<=0&&f.addClass("bs-autocomplete-group-hide"),f=a,v=0):(f&&s&&v++,s&&b++,a.addClass(V)),t.cls&&a.addClass(t.cls),a.data("bsAutoCompleteItem",t).appendTo(C).attr("title",n).mousedown(function(e){I.isReadonly()||(t.optGroup||(T&&I.input.blur(),I.input.clear(),I.badge.add(t)),k(e))}),!m&&c&&(I.editingItem&&I.editingItem.text==c&&d==l&&u==n&&(m=!0),I.isInSearchMode("name")&&c==n?m=!0:I.isInSearchMode("code")&&c==l&&(m=!0),m&&a.addClass("selected"))}),f&&v<=0&&f.addClass("bs-autocomplete-group-hide"),b<=0?C.addClass("no-selectable-items"):C.removeClass("no-selectable-items")}else I.close()},s.resize=function(){C.css("max-width",I.el.width()),I.fireOnPanelResize(I)},s.relocate=function(){var e=I.input.el.position().left;I.isSingleMode()&&(e=0),C.css("left",e+"px")},s.close=function(){C.children().removeClass("selected")},s.destroy=function(){C.children().each(function(){S(this).removeData("bsAutoCompleteItem")}),C.remove()}},l=function(e,t){var f=this;for(var a in e=S.extend(!0,{tpls:h},e||{}),m)"undefined"==typeof e[a]&&(e[a]=m[a]);f.params=e,f.initialized=!1,f.selectedItems=[],f.selectedItemMap={},f.readonly=!1;var n=function(){f.resized4htmlOver||(f.el.is(":visible")&&f.resize(),S("html").off("mouseover",n),f.resized4htmlOver=!0)},l=function(e){if(f.el.hasClass("open")&&!S(e.target).hasClass("bootstrap-autocomplete")){var t=S(e.target).parents(".bootstrap-autocomplete");0==t.size()?f.close():t[0]!=f.el[0]&&f.close()}},i=function(e){setTimeout(function(){f.panel.resize()},100)},s=function(){f.resized4elOver||(f.el.is(":visible")&&f.resize(),f.el.off("mouseover",s),f.resized4elOver=!0)};f.addValue=function(e,s){s=S.extend({onSetFinish:S.noop},s||{});var r,o=f.getValue();if(s.clear&&f.clearValue(!1),!e)return s.fireInit?f.fireOnInit():r=f.fireOnChange(o,f.getValue()),void s.onSetFinish.call(f,r);if(e instanceof Array){if(e.length<=0)return;var a=[];S.each(e,function(e,t){g(t)?a.push({c:t,n:t}):a.push(t)}),e=a}else e=g(e)?[{c:e,n:e}]:[e];if(f.params.forceSelect&&f.params.loadDataItems)f.loadDataItems(e).then(function(a){S.each(e,function(e,t){f.badge.add(t,a)})}).always(function(){s.fireInit?f.fireOnInit():r=f.fireOnChange(o,f.getValue()),s.onSetFinish.call(f,r)});else{var c=f.data,d=f.params.forceSelect&&f.params.loadData&&!0,u=e.length,p=0;0<e.length&&!d&&(f.data=(f.params.data||[]).slice()),S.each(e,function(e,t){if(d)if(f.searchInData(t,c))f.badge.add(t),p++;else{var a=t.c||t.code,n=t.n||t.name,l=f.isInSearchMode("name")?"name":"code",i="code"==l?a:n;f.loadData({searchText:i,specialData:[],showAllItemsWhenFirstFocus:!1,searchMode:l,from:"addValue"}).then(function(e){c=e,f.badge.add(t,e)}).always(function(){++p==u&&(s.fireInit?f.fireOnInit():r=f.fireOnChange(o,f.getValue()),s.onSetFinish.call(f,r))})}else f.badge.add(t)}),d||(s.fireInit?f.fireOnInit():r=f.fireOnChange(o,f.getValue()),s.onSetFinish.call(f,r))}},f.setValue=function(e,t){t=S.extend(t||{},{clear:!0}),f.addValue(e,t)},f.openOnFocus=function(){var e=f.params.showAllWhenSingleForceSelectFocus&&f.params.forceSelect&&f.isSingleMode();f.loadData({showAllItemsWhenFirstFocus:e,from:"openOnFocus"}).then(function(){f.open(),f.panel.render()})},f.isInSearchMode=function(e){return 0<=f.params.searchMode.indexOf(e)},f.resize=function(){f.badge.resize()},f.destroy=function(){f.destoried=!0,f.panel.destroy(),S("html").off({click:l,mouseover:n}),S(window).off("resize",i),f.params.el.removeData("bsAutoComplete"),f.el.remove()},f.fireOnChange=function(e,r){var t=!0;if(e!=r&&e.length==r.length){var o=!0;S.each(e,function(e,t){var a=t.code||t.c,n=t.name||t.n,l=r[e],i=l.code||l.c,s=l.name||l.n;if(a!=i||n!=s)return o=!1}),o&&(t=!1)}return t&&(!1!==f.params.disableResizeContainer&&f.resizeContainer&&setTimeout(function(){f.containerEl.height(f.el.outerHeight())},0),f.params.el.trigger("bs.autocomplete.change",[e,r])),t},f.fireOnPanelResize=function(){f.params.el.trigger("bs.autocomplete.panel.resize",[f])},f.fireOnSelect=function(e,t){f.params.el.trigger("bs.autocomplete.select",[e,t])},f.fireOnClose=function(){f.inputGroupEl&&f.inputGroupEl.removeClass("open"),f.params.el.trigger("bs.autocomplete.close")},f.fireOnInit=function(){f.isInitialized||(f.isInitialized=!0,f.params.el.trigger("bs.autocomplete.inited"))},f.fireOnFocus=function(){f.inputGroupEl&&f.inputGroupEl.addClass("focus"),f.params.el.trigger("bs.autocomplete.focus")},f.fireOnPen=function(){f.inputGroupEl&&f.inputGroupEl.addClass("open"),f.params.el.trigger("bs.autocomplete.open")},f.fireBadgeRemoved=function(){f.params.el.trigger("bs.autocomplete.badge.removed")},f.fireOnBlur=function(){f.inputGroupEl&&f.inputGroupEl.removeClass("focus"),f.params.el.trigger("bs.autocomplete.blur")},f.fireOnDeSelect=function(e,t){f.params.el.trigger("bs.autocomplete.deselect",[e,t])},f.isSingleMode=function(){return!f.params.multiple},f.close=function(){f.el.removeClass("open"),f.panel.close(),f.fireOnClose()},f.open=function(){f.readonly||(f.panel.resize(),f.panel.relocate(),f.el.addClass("open"),f.fireOnPen())},f.getValue=function(){return f.selectedItems.slice()},f.clearData=function(){f.data.splice(0,f.data.length)},f.clearValue=function(e){f.isSingleMode()&&f.input.clear(e);var t=f.getValue();f.selectedItems.splice(0,f.selectedItems.length),f.selectedItemMap={},f.el.children("."+O).remove(),f.el.removeClass("selected"),f.placeholder.refresh(),!1!==e&&(f.params.el.trigger("bs.autocomplete.clear"),f.fireOnChange(t,f.getValue()))},f.setReadonly=function(e){e=!1!==e,(f.readonly=e)?f.el.addClass("readonly"):f.el.removeClass("readonly")},f.isReadonly=function(){return f.readonly},f.addSelected=function(e,t){var a=f.selectedItems.slice();f.isSingleMode()&&(f.selectedItems.splice(0,f.selectedItems.length),f.selectedItemMap={}),f.selectedItems.push(e),f.selectedItemMap[e.c||e.code]=e,0<f.selectedItems.length&&f.el.addClass("selected"),!1!==t&&(f.fireOnSelect(e,f.getValue()),f.fireOnChange(a,f.getValue()))},f.removeSelected=function(e){var t=f.findSelectedItem(e);if(0<=t){var a=f.selectedItems.slice();f.selectedItems.splice(t,1),delete f.selectedItemMap[e.c||e.code],f.selectedItems.length<=0&&f.el.removeClass("selected"),f.fireOnDeSelect(e,f.getValue()),f.fireOnChange(a,f.getValue())}},f.isItemMatched=function(e,t){var a=new RegExp(function(e){if("string"!=typeof e)return e;return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}(e),f.params.ignoreCase?"i":undefined),n=!1;return f.isInSearchMode("name")&&(n=a.test(t.n||t.name)),!n&&f.isInSearchMode("code")&&(n=a.test(t.c||t.code)),n},f.findSelectedItem=function(e){var l=-1,i=e.c||e.code,s=e.n||e.name;return S.each(f.selectedItems,function(e,t){var a=t.c||t.code,n=t.n||t.name;if(a==i&&n==s)return l=e,!1}),l},f.searchInData=function(e,t){var l=g(e);l&&(e={c:e,n:e});var i,s=e.c||e.code,r=e.n||e.name;t=t||f.data;return S.each(t,function(e,t){var a=t.c||t.code,n=t.n||t.name;if(l){if(f.isInSearchMode("name")&&n==r||f.isInSearchMode("code")&&a==s)return i=t,!1}else if(n==r&&a==s)return i=t,!1}),i},f.loadDataItems=function(e){var t=S.Deferred(),a=[];return f.params.loadDataItems.call(f,e,function(e){e?(S.each(e,function(e,t){g(t)&&(t={c:t,n:t}),a.push(t)}),t.resolve(a)):t.reject()}),t.promise()},f.loadData=function(a){(a=a||{}).searchText=a.showAllItemsWhenFirstFocus?"":a.searchText||f.input.getSearchText();var t=S.Deferred();if(a.specialData=a.specialData||f.data,a.specialData.splice(0,a.specialData.length),f.params.loadData)f.params.loadData.call(f,a.searchText,function(e){e?(a.specialData.splice(0,a.specialData.length),S.each(e,function(e,t){g(t)&&(t={c:t,n:t}),a.specialData.push(t)}),t.resolve(a.specialData)):t.reject()},a.searchMode,a.from);else{var n,e=f.params.data||[];S.each(e,function(e,t){g(t)&&(t={c:t,n:t}),!0!==t.optGroup?a.searchText&&!f.isItemMatched(a.searchText,t)||(n&&(a.specialData.push(n),n=undefined),a.specialData.push(t)):n=t}),t.resolve(a.specialData)}return t.promise()},f.data=[],f.el=S(f.params.tpls.containerTpl).addClass(f.params.cls);var r,o=f.inputGroupEl=e.el.closest(".input-group"),c=f.isUnderInputGroup=0<o.size(),d=e.el.is(":input");d&&!f.params.replace&&(f.params.replace=!0),d&&e.el.parent().hasClass("input-group")&&((r=f.inputDelegateCtEl=S(f.params.tpls.inputDelegateContainerTpl).addClass("form-control")).insertAfter(e.el),e.el.appendTo(r)),!1!==f.params.fitWdith&&f.el.addClass("fit-width"),f.params.dropUp&&f.el.addClass("dropup"),f.params.replace?(f.el.insertAfter(e.el),e.el.hide()):r?f.el.appendTo(r):(c&&e.el.addClass("form-control"),f.el.appendTo(e.el));var u=f.containerEl=f.el.parent(),p="bs-ac-ct-resize";c&&u.hasClass("form-control")&&u.addClass(p),f.resizeContainer=u.hasClass(p),f.input=new E(f),f.panel=new A(f),f.badge=new B(f),f.placeholder=new W(f),f.params.data&&(S.each(f.params.data,function(e,t){g(t)?f.data.push({c:t,n:t}):f.data.push(t)}),f.params.data=f.data.slice()),S(f.params.tpls.clearBtnTpl).appendTo(f.el).click(function(e){f.isReadonly()||(f.clearValue(),k(e))}),f.params.readonly&&f.setReadonly(!0),f.el.on({mousedown:function(e){if(!f.isReadonly()&&e.target==f.el[0]){var t=f.badge.getCloestBadge(e.offsetX,e.offsetY);f.input.moveToBadge(t),f.input.isFocused&&k(e)}},click:function(e){f.isReadonly()||(f.input.focus(),f.input.isFocused&&k(e))},mouseover:s}),t.data("bsAutoComplete",this),f.params.value?f.setValue(f.params.value,{fireInit:!0}):f.fireOnInit(),S("html").on({click:l,mouseover:n}),S(window).on("resize",i)};S.fn.bsAutoComplete=function(a){var n=arguments;return this.each(function(){if(this){var e=S(this),t=e.data("bsAutoComplete");t||"destroy"==a||(a=S.extend({el:e,value:e.val()?e.val().split(a.splitChar||" "):""},a),t=new l(a,e)),t&&g(a)&&t[a].apply(t,Array.prototype.slice.call(n,1))}})}}(jQuery);
//# sourceMappingURL=bootstrap-autocomplete.min.js.map
