!function(h){"use strict";var s={cls:"",placeHolder:"请选择",searchMode:"code name",ignoreCase:!0,fitWdith:!0,dropUp:!1,filtSame:!1,badgeCls:"",dblclick4Edit:!1,inputSearchDelay:200,forceSelect:!1,minChar:1,multiple:!0},p=-1<navigator.userAgent.indexOf("Trident"),g=13,v=9,b=37,I=38,S=39,C=40,y=27,x=8,z=46,o='<div class="btn-group bootstrap-autocomplete form-control"></div>',a='<div class="delegate-input">        <input type="text" class="input-delegate">        <span class="input-delegate-sizer">W</span>      </div>',e='<ul class="dropdown-menu bs-autocomplete-menu"></ul>',n='<div class="bs-autocomplete-placeholder"></div>',c='<span class="bsautocomplete-icon-cross bsautocomplete-font icon-jiaochacross78"></span>',M='<li>        <a href="javascript:">          <span class="text"></span>        </a>      </li>',V='<span class="label label-primary">        <a href="javascript:" class="badge-text"></a>        <a href="javascript:" class="badge-close">x</a>      </span>',O="bs-autocomplete-badge",T="bs-autocomplete-item",D=function(e,t){return Number(e.css(t).replace("px",""))},k=function(e){return h("<div></div>").append(e).html()},i=function(e){document.selection?document.selection.createRange().moveStart("character",e.value.length):e.selectionStart=e.value.length},R=function(e){e.preventDefault(),e.stopPropagation()},w=function(e){return"string"==typeof e},d=function(e){var t=this.el=h(n).prependTo(e.el);t.text(e.params.placeHolder),this.refresh=function(){0<e.selectedItems.length?t.hide():t.show()}},u=function(p){var g=this;g.resize=function(e){if(e){var t=e.find(".badge-close"),a=D(e,"margin-left"),n=D(e,"margin-right"),i=(l=p.el,r=D(l,"padding-left"),s=D(l,"padding-right"),l.innerWidth()-r-s-p.input.emptyWidth-a-n-t.outerWidth()-2);e.find(".badge-text").css("max-width",i+"px")}else p.el.children("."+O).each(function(){g.resize(h(this))});var l,r,s},g.closeBadge=function(e){e.find(".badge-close").click()},g.getLastBadge=function(){var e=p.el.children("."+O);if(0<e.size())return h(e[e.size()-1])},g.getCloestBadge=function(l,r){var s,o;return p.el.children("."+O).each(function(){var e=h(this),t=e.position(),a=t.left,n=t.top,i=n+e.outerHeight();t.left,e.outerWidth();if(n<=r&&r<=i){if(o=!0,l<=a)return s=e,!1}else if(o)return s=e,!1}),s},g.add=function(e,t){var a=p.panel.getSelectedItem();if(!a){if(!e)return void delete p.editingItem;if(p.editingItem)if(e===p.editingItem.item)a=e;else if(w(e))p.editingItem.text==e&&(a=p.editingItem.item);else{var n=p.editingItem.item,i=n.c||n.code,l=n.n||n.name,r=n.c||n.code,s=n.n||n.name;r==i&&s==l&&(a=e)}var o;if(!a)w(e)?(o=p.searchInData(e,t))||p.params.forceSelect||(a={c:e,n:e}):p.params.forceSelect?(o=p.searchInData(e,t))&&(a=o):a=e;if(!a)return void delete p.editingItem}delete p.editingItem;var c,d=a.n||a.name,u=a.hn||a.htmlName;if(p.params.badgeRender)c=p.params.badgeRender.call(p,a);else{var f=(c=h(V)).find(".badge-text");p.params.itemUseHtml?f.append(k(h(u||d))):f.text(d),f.attr("title",d)}c.addClass(O+" "+p.params.badgeCls).click(function(e){R(e)}),c.find(".badge-close").click(function(e){p.isReadonly()||(c.remove(),p.removeSelected(a),p.selectedItems.length<=0&&p.input.blur(),p.close(),p.placeholder.refresh(),p.fireBadgeRemoved(),R(e))}),c.find(".badge-text")[p.params.dblclick4Edit?"dblclick":"click"](function(e){if(!p.isReadonly()){c.after(p.input.el).remove(),p.removeSelected(a);var t=p.isInSearchMode("name")?a.n||a.name:a.c||a.code;p.params.getText4BadgeEdit&&(t=p.params.getText4BadgeEdit.call(p,a,t)),p.editingItem={item:a,text:t},p.close(),p.input.updateTextValue(t),R(e)}});var m=!1;if(p.params.filtSame&&0<p.selectedItems.length&&!p.isSingleMode()){if(0<=p.findSelectedItem(a))return!0;m=!0}else m=!0;return m&&(p.isSingleMode()&&p.el.children("."+O).remove(),p.input.el.before(c),p.addSelected(a,!t),g.resize(c),p.isSingleMode()&&p.input.updateTextValue(d,!1),p.placeholder.refresh()),m},p.isSingleMode()&&p.el.addClass("single-badge")},f=function(d){var e,u=this,f=u.el=h(a).appendTo(d.el),t=f.children(".input-delegate-sizer"),m=f.children(":text").on({focus:function(e){if(d.isReadonly())return m.blur(),void R(e);u.isFocused=!0,u.updateSizer(),d.placeholder.el.hide(),d.el.addClass("focus"),(d.params.minChar<=0||m.val().length>=d.params.minChar)&&d.openOnFocus(),d.isSingleMode()&&0<d.getValue().length&&(i(m[0]),d.editingItem={item:d.getValue()[0],text:m.val()}),d.fireOnFocus()},blur:function(){u.isFocused&&(u.isFocused=!1,d.el.removeClass("focus"),(m.val()&&!u.beforeMoveVal||!m.val()&&d.isSingleMode())&&u.confirmValue(!1,!0),d.placeholder.refresh(),d.close(),d.fireOnBlur())},keydown:function(e){if(!d.isReadonly()){u.updateSizer();var t=!1;switch(e.keyCode){case g:var a=d.panel.getSelectedItem();if(a){var n=a.n||a.name,i=a.c||a.code;d.isInSearchMode("name")&&n?m.val(n):i&&m.val(i)}u.blur(),R(e),t=!0;break;case y:u.confirmValue(!0),t=!0;break;case v:var l=!!m.val();u.confirmValue(),l&&!d.isSingleMode()&&(m.focus(),R(e)),t=!0;break;case b:case S:var r=function(e){var t=0;if(document.selection){var a=document.selection.createRange();a.moveStart("character",0-e.value.length),t=a.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}(m[0]),s=m.val().length;e.keyCode==b&&0==r?(u.moveToLR(!0),R(e)):e.keyCode==S&&r==s&&(u.moveToLR(!1),R(e)),t=!0;break;case I:case C:d.panel.moveSelect(e.keyCode==I),R(e),t=!0;break;case x:if(!m.val()){var o=f.prev("."+O);0<o.size()&&(d.badge.closeBadge(o),R(e),t=!0)}break;case z:if(!m.val()){var c=f.next("."+O);0<c.size()&&(d.badge.closeBadge(c),R(e),t=!0)}break;default:d.panel.relocate()}t||setTimeout(function(){if(m.val().length<d.params.minChar)return d.close(),void d.panel.el.empty();d.loadData().then(function(){d.open(),d.panel.render()})},d.params.inputSearchDelay)}},keyup:function(e){d.isReadonly()||u.updateSizer()}});u.moveToLR=function(e){if(!d.isSingleMode()){var t=e?f.prev("."+O+" "):f.next("."+O);t&&(u.beforeMoveVal=m.val(),e?t.before(f):t.after(f),m.val(u.beforeMoveVal),u.focus(),delete u.beforeMoveVal)}},u.moveToBadge=function(e){if(!d.isSingleMode())if(e)e.before(u.el);else{var t=d.badge.getLastBadge();t&&t.after(u.el)}},u.updateSizer=function(){t.text(m.val()+"WW")},u.updateTextValue=function(e,t){m.val(e),u.isFocused||!1===t||u.focus(),u.updateSizer(),p&&!1!==t&&i(m[0])},u.confirmValue=function(e,t){var a;e?d.editingItem&&(a=d.badge.add(d.editingItem.item)):a=d.badge.add(m.val()),d.isSingleMode()?(a||(0<d.selectedItems.length&&d.removeSelected(d.selectedItems[0]),m.val()&&u.clear()),t||m.blur(),d.close()):m.val()&&u.clear()},u.blur=function(){u.isFocused&&m.blur()},u.clear=function(e){m.val(""),!1===e?d.placeholder.refresh():m.blur(),t.text("W")},u.getSearchText=function(){return m.val()},u.focus=function(){u.isFocused||m.focus()},t.text("WW"),u.emptyWidth=(e=f).outerWidth()+D(e,"margin-left")+D(e,"margin-right"),t.text("W")},F=function(f){var l=this,m=l.el=h(e).appendTo(f.el);l.moveSelect=function(e){var t,a=m.children("li.selected"),n="."+T;if(0<a.size()){for(t=e?a.prev():a.next();0<t.size()&&!t.hasClass(T);)t=e?t.prev():t.next();if(t.size()<=0){var i=m.children(n);t=h(e?i[i.size()-1]:i[0])}}else{0<(i=m.children(n)).size()&&(t=h(e?i[i.size()-1]:i[0]))}t&&0<t.length&&(a.removeClass("selected"),t.addClass("selected"),l.scrollToSelected(t))},l.scrollToSelected=function(e){if(0<(e=e||m.children("li.selected")).size()){var t=m.scrollTop(),a=e.position().top+t;a-=(m.height()-e.height())/2,m.scrollTop(a)}},l.getSelectedItem=function(){return m.children("li.selected").data("bsAutoCompleteItem")},l.render=function(){var e=f.data||[],s=f.input.getSearchText();m.empty();var t=f.editingItem&&f.editingItem.item||{},o=t.c||t.code,c=t.n||t.name;if(0<e.length){var d,u=!1;h.each(e,function(e,t){var a,n=t.n||t.name,i=t.c||t.code,l=t.hn||t.htmlName;if(f.params.itemRender)f.params.itemRender.call(f,a,t,s);else{var r=(a=h(M)).find(".text");f.params.itemUseHtml?r.append(k(h(l||n))):r.text(n)}!0===t.optGroup?(a.addClass("bs-autocomplete-group"),d||(d=!0,m.addClass("bs-autocomplete-grouped"))):a.addClass(T),t.cls&&a.addClass(t.cls),a.data("bsAutoCompleteItem",t).appendTo(m).attr("title",n).mousedown(function(e){f.isReadonly()||(t.optGroup||(p&&f.input.blur(),f.input.clear(),f.badge.add(t)),R(e))}),!u&&s&&(f.editingItem&&f.editingItem.text==s&&o==i&&c==n&&(u=!0),f.isInSearchMode("name")&&s==n?u=!0:f.isInSearchMode("code")&&s==i&&(u=!0),u&&a.addClass("selected"))})}else f.close()},l.resize=function(){m.css("max-width",f.el.width())},l.relocate=function(){var e=f.input.el.position().left;f.isSingleMode()&&(e=0),m.css("left",e+"px")},l.close=function(){m.children().removeClass("selected")},l.destroy=function(){m.children().each(function(){h(this).removeData("bsAutoCompleteItem")}),m.remove()}},l=function(e,t){var m=this;for(var a in e=e||{},s)"undefined"==typeof e[a]&&(e[a]=s[a]);m.params=e,m.initialized=!1,m.selectedItems=[],m.readonly=!1;var n=function(){m.resized4htmlOver||(m.el.is(":visible")&&m.resize(),h("html").off("mouseover",n),m.resized4htmlOver=!0)},i=function(e){if(m.el.hasClass("open")&&!h(e.target).hasClass("bootstrap-autocomplete")){var t=h(e.target).parents(".bootstrap-autocomplete");0==t.size()?m.close():t[0]!=m.el[0]&&m.close()}},l=function(e){setTimeout(function(){m.panel.resize()},100)},r=function(){m.resized4elOver||(m.el.is(":visible")&&m.resize(),m.el.off("mouseover",r),m.resized4elOver=!0)};m.addValue=function(e,r){r=h.extend({onSetFinish:h.noop},r||{});var s,o=m.getValue();if(r.clear&&m.clearValue(!1),!e)return r.fireInit?m.fireOnInit():s=m.fireOnChange(o,m.getValue()),void r.onSetFinish.call(m,s);if(e instanceof Array){if(e.length<=0)return;var a=[];h.each(e,function(e,t){w(t)?a.push({c:t,n:t}):a.push(t)}),e=a}else e=w(e)?[{c:e,n:e}]:[e];if(m.params.forceSelect&&m.params.loadDataItems)m.loadDataItems(e).then(function(a){h.each(e,function(e,t){m.badge.add(t,a)})}).always(function(){r.fireInit?m.fireOnInit():s=m.fireOnChange(o,m.getValue()),r.onSetFinish.call(m,s)});else{var c=m.data,d=m.params.forceSelect&&m.params.loadData,u=e.length,f=0;0<e.length&&!d&&(m.data=(m.params.data||[]).slice()),h.each(e,function(e,t){if(d)if(m.searchInData(t,c))m.badge.add(t),f++;else{var a=t.c||t.code,n=t.n||t.name,i=m.isInSearchMode("name")?"name":"code",l="code"==i?a:n;m.loadData(l,[],i).then(function(e){c=e,m.badge.add(t,e)}).always(function(){++f==u&&(r.fireInit?m.fireOnInit():s=m.fireOnChange(o,m.getValue()),r.onSetFinish.call(m,s))})}else m.badge.add(t)}),d||(r.fireInit?m.fireOnInit():s=m.fireOnChange(o,m.getValue()),r.onSetFinish.call(m,s))}},m.setValue=function(e,t){t=h.extend(t||{},{clear:!0}),m.addValue(e,t)},m.openOnFocus=function(){var e=m.params.showAllWhenSingleForceSelectFocus&&m.params.forceSelect&&m.isSingleMode();m.loadData(undefined,undefined,e).then(function(){m.open(),m.panel.render()})},m.isInSearchMode=function(e){return 0<=m.params.searchMode.indexOf(e)},m.resize=function(){m.badge.resize()},m.destroy=function(){m.panel.destroy(),h("html").off({click:i,mouseover:n}),h(window).off("resize",l),m.params.el.removeData("bsAutoComplete"),m.el.remove()},m.fireOnChange=function(e,s){var t=!0;if(e!=s&&e.length==s.length){var o=!0;h.each(e,function(e,t){var a=t.code||t.c,n=t.name||t.n,i=s[e],l=i.code||i.c,r=i.name||i.n;if(a!=l||n!=r)return o=!1}),o&&(t=!1)}return t&&m.params.el.trigger("bs.autocomplete.change",[e,s]),t},m.fireOnSelect=function(e,t){m.params.el.trigger("bs.autocomplete.select",[e,t])},m.fireOnInit=function(){m.isInitialized||(m.isInitialized=!0,m.params.el.trigger("bs.autocomplete.inited"))},m.fireOnFocus=function(){m.params.el.trigger("bs.autocomplete.focus")},m.fireBadgeRemoved=function(){m.params.el.trigger("bs.autocomplete.badge.removed")},m.fireOnBlur=function(){m.params.el.trigger("bs.autocomplete.blur")},m.fireOnDeSelect=function(e,t){m.params.el.trigger("bs.autocomplete.deselect",[e,t])},m.isSingleMode=function(){return!m.params.multiple},m.close=function(){m.el.removeClass("open"),m.panel.close()},m.open=function(){m.readonly||(m.panel.resize(),m.panel.relocate(),m.el.addClass("open"))},m.getValue=function(){return m.selectedItems.slice()},m.clearData=function(){m.data.splice(0,m.data.length)},m.clearValue=function(e){m.isSingleMode()&&m.input.clear(e);var t=m.getValue();m.selectedItems.splice(0,m.selectedItems.length),m.el.children("."+O).remove(),m.el.removeClass("selected"),m.placeholder.refresh(),!1!==e&&(m.params.el.trigger("bs.autocomplete.clear"),m.fireOnChange(t,m.getValue()))},m.setReadonly=function(e){e=!1!==e,(m.readonly=e)?m.el.addClass("readonly"):m.el.removeClass("readonly")},m.isReadonly=function(){return m.readonly},m.addSelected=function(e,t){var a=m.selectedItems.slice();m.isSingleMode()&&m.selectedItems.splice(0,m.selectedItems.length),m.selectedItems.push(e),0<m.selectedItems.length&&m.el.addClass("selected"),!1!==t&&(m.fireOnSelect(e,m.getValue()),m.fireOnChange(a,m.getValue()))},m.removeSelected=function(e){var t=m.findSelectedItem(e);if(0<=t){var a=m.selectedItems.slice();m.selectedItems.splice(t,1),m.selectedItems.length<=0&&m.el.removeClass("selected"),m.fireOnDeSelect(e,m.getValue()),m.fireOnChange(a,m.getValue())}},m.isItemMatched=function(e,t){var a=new RegExp(function(e){if("string"!=typeof e)return e;return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}(e),m.params.ignoreCase?"i":undefined),n=!1;return m.isInSearchMode("name")&&(n=a.test(t.n||t.name)),!n&&m.isInSearchMode("code")&&(n=a.test(t.c||t.code)),n},m.findSelectedItem=function(e){var i=-1,l=e.c||e.code,r=e.n||e.name;return h.each(m.selectedItems,function(e,t){var a=t.c||t.code,n=t.n||t.name;if(a==l&&n==r)return i=e,!1}),i},m.searchInData=function(e,t){var i=w(e);i&&(e={c:e,n:e});var l,r=e.c||e.code,s=e.n||e.name;t=t||m.data;return h.each(t,function(e,t){var a=t.c||t.code,n=t.n||t.name;if(i){if(m.isInSearchMode("name")&&n==s||m.isInSearchMode("code")&&a==r)return l=t,!1}else if(n==s&&a==r)return l=t,!1}),l},m.loadDataItems=function(e){var t=h.Deferred(),a=[];return m.params.loadDataItems.call(m,e,function(e){e?(h.each(e,function(e,t){w(t)&&(t={c:t,n:t}),a.push(t)}),t.resolve(a)):t.reject()}),t.promise()},m.loadData=function(a,n,e){a=e?"":a||m.input.getSearchText();var t=h.Deferred();if((n=n||m.data).splice(0,n.length),m.params.loadData)m.params.loadData.call(m,a,function(e){e?(h.each(e,function(e,t){w(t)&&(t={c:t,n:t}),n.push(t)}),t.resolve(n)):t.reject()});else{var i=m.params.data||[];h.each(i,function(e,t){w(t)&&(t={c:t,n:t}),a&&!m.isItemMatched(a,t)||n.push(t)}),t.resolve(n)}return t.promise()},m.data=[],m.el=h(o).addClass(m.params.cls),!1!==m.params.fitWdith&&m.el.addClass("fit-width"),m.params.dropUp&&m.el.addClass("dropup"),m.params.replace?(m.el.insertAfter(e.el),e.el.hide()):m.el.appendTo(e.el),m.input=new f(m),m.panel=new F(m),m.badge=new u(m),m.placeholder=new d(m),m.params.data&&(h.each(m.params.data,function(e,t){w(t)?m.data.push({c:t,n:t}):m.data.push(t)}),m.params.data=m.data.slice()),h(c).appendTo(m.el).click(function(e){m.isReadonly()||(m.clearValue(),R(e))}),m.params.readonly&&m.setReadonly(!0),m.el.on({mousedown:function(e){if(!m.isReadonly()&&e.target==m.el[0]){var t=m.badge.getCloestBadge(e.offsetX,e.offsetY);m.input.moveToBadge(t),m.input.isFocused&&R(e)}},click:function(e){m.isReadonly()||(m.input.focus(),m.input.isFocused&&R(e))},mouseover:r}),t.data("bsAutoComplete",this),m.params.value?m.setValue(m.params.value,{fireInit:!0}):m.fireOnInit(),h("html").on({click:i,mouseover:n}),h(window).on("resize",l)};h.fn.bsAutoComplete=function(a){var n=arguments;return this.each(function(){if(this){var e=h(this),t=e.data("bsAutoComplete");t||"destroy"==a||(a=h.extend({el:e,value:e.val()?e.val().split(a.splitChar||" "):""},a),t=new l(a,e)),t&&w(a)&&t[a].apply(t,Array.prototype.slice.call(n,1))}})}}(jQuery);
//# sourceMappingURL=bootstrap-autocomplete.min.js.map
